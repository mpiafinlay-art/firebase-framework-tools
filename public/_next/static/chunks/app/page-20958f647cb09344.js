(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{89256:function(e,r,t){Promise.resolve().then(t.bind(t,82728))},82728:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return k}});var o=t(57437),n=t(2265),s=t(99376),a=t(63996),i=t(5978),l=t(96471);let c=(0,l.Z)("Clapperboard",[["path",{d:"M20.2 6 3 11l-.9-2.4c-.3-1.1.3-2.2 1.3-2.5l13.5-4c1.1-.3 2.2.3 2.5 1.3Z",key:"1tn4o7"}],["path",{d:"m6.2 5.3 3.1 3.9",key:"iuk76l"}],["path",{d:"m12.4 3.4 3.1 4",key:"6hsd6n"}],["path",{d:"M3 11h18v8a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2Z",key:"ltgou9"}]]);var u=t(53459);let d=(0,l.Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);var p=t(23340),m=t(33931),g=t(12381),f=t(74291),h=t(40279),v=t(75060);function x(e){let{isOpen:r,onOpenChange:t,mode:s,onAuth:a}=e,[i,l]=(0,n.useState)(""),[c,d]=(0,n.useState)(""),[m,x]=(0,n.useState)(""),[b,y]=(0,n.useState)(!1),{toast:w}=(0,p.pm)(),j=async e=>{if(e.preventDefault(),!i||!c){w({variant:"destructive",title:"Error",description:"Por favor completa todos los campos."});return}if("signup"===s&&c!==m){w({variant:"destructive",title:"Error",description:"Las contrase\xf1as no coinciden."});return}if(c.length<6){w({variant:"destructive",title:"Error",description:"La contrase\xf1a debe tener al menos 6 caracteres."});return}y(!0);try{await a(i,c),l(""),d(""),x(""),t(!1)}catch(r){console.error("Error en autenticaci\xf3n:",r);let e="No se pudo completar la operaci\xf3n.";"auth/email-already-in-use"===r.code?e="Este correo electr\xf3nico ya est\xe1 en uso.":"auth/invalid-email"===r.code?e="El correo electr\xf3nico no es v\xe1lido.":"auth/weak-password"===r.code?e="La contrase\xf1a es muy d\xe9bil.":"auth/user-not-found"===r.code?e="No existe una cuenta con este correo electr\xf3nico.":"auth/wrong-password"===r.code?e="La contrase\xf1a es incorrecta.":r.message&&(e=r.message),w({variant:"destructive",title:"Error",description:e})}finally{y(!1)}};return(0,o.jsx)(f.Vq,{open:r,onOpenChange:t,children:(0,o.jsxs)(f.cZ,{className:"sm:max-w-[425px]",children:[(0,o.jsxs)(f.fK,{children:[(0,o.jsx)(f.$N,{children:"login"===s?"Iniciar Sesi\xf3n":"Crear Cuenta"}),(0,o.jsx)(f.Be,{children:"login"===s?"Ingresa tu correo electr\xf3nico y contrase\xf1a para iniciar sesi\xf3n.":"Crea una cuenta nueva con tu correo electr\xf3nico y contrase\xf1a."})]}),(0,o.jsxs)("form",{onSubmit:j,className:"space-y-4",children:[(0,o.jsxs)("div",{className:"space-y-2",children:[(0,o.jsx)(v._,{htmlFor:"email",children:"Correo electr\xf3nico"}),(0,o.jsx)(h.I,{id:"email",type:"email",placeholder:"tu@email.com",value:i,onChange:e=>l(e.target.value),disabled:b,required:!0})]}),(0,o.jsxs)("div",{className:"space-y-2",children:[(0,o.jsx)(v._,{htmlFor:"password",children:"Contrase\xf1a"}),(0,o.jsx)(h.I,{id:"password",type:"password",placeholder:"••••••••",value:c,onChange:e=>d(e.target.value),disabled:b,required:!0,minLength:6})]}),"signup"===s&&(0,o.jsxs)("div",{className:"space-y-2",children:[(0,o.jsx)(v._,{htmlFor:"confirmPassword",children:"Confirmar contrase\xf1a"}),(0,o.jsx)(h.I,{id:"confirmPassword",type:"password",placeholder:"••••••••",value:m,onChange:e=>x(e.target.value),disabled:b,required:!0,minLength:6})]}),(0,o.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,o.jsx)(g.z,{type:"button",variant:"outline",onClick:()=>t(!1),disabled:b,children:"Cancelar"}),(0,o.jsx)(g.z,{type:"submit",disabled:b,children:b?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(u.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"login"===s?"Iniciando sesi\xf3n...":"Creando cuenta..."]}):"login"===s?"Iniciar Sesi\xf3n":"Crear Cuenta"})]})]})]})})}var b=t(90535),y=t(93448);let w=(0,b.j)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),j=n.forwardRef((e,r)=>{let{className:t,variant:n,...s}=e;return(0,o.jsx)("div",{ref:r,role:"alert",className:(0,y.cn)(w({variant:n}),t),...s})});j.displayName="Alert";let C=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,o.jsx)("h5",{ref:r,className:(0,y.cn)("mb-1 font-medium leading-none tracking-tight",t),...n})});C.displayName="AlertTitle";let N=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,o.jsx)("div",{ref:r,className:(0,y.cn)("text-sm [&_p]:leading-relaxed",t),...n})});N.displayName="AlertDescription";var D=t(12032),I=t(44986);function E(e){let{onDismiss:r}=e,[t,s]=(0,n.useState)(!0);return t?(0,o.jsx)(j,{variant:"destructive",className:"fixed bottom-4 left-4 right-4 z-50 max-w-2xl mx-auto shadow-lg border-2",children:(0,o.jsxs)("div",{className:"flex items-start gap-3",children:[(0,o.jsx)(D.Z,{className:"h-5 w-5 mt-0.5 flex-shrink-0"}),(0,o.jsxs)("div",{className:"flex-1",children:[(0,o.jsx)(C,{className:"font-semibold mb-1",children:"Pop-ups bloqueados"}),(0,o.jsxs)(N,{className:"text-sm",children:["Para iniciar sesi\xf3n con Google, necesitas permitir pop-ups en este sitio.",(0,o.jsx)("br",{}),(0,o.jsx)("strong",{className:"mt-2 block",children:"C\xf3mo permitir pop-ups:"}),(0,o.jsxs)("ol",{className:"list-decimal list-inside mt-1 space-y-1 ml-2",children:[(0,o.jsx)("li",{children:"Busca el icono de bloqueo o pop-up en la barra de direcciones"}),(0,o.jsx)("li",{children:'Haz clic y selecciona "Permitir pop-ups y redirecciones"'}),(0,o.jsx)("li",{children:"O ve a Configuraci\xf3n del navegador → Privacidad → Pop-ups"}),(0,o.jsxs)("li",{children:["Agrega ",(0,o.jsx)("code",{className:"bg-red-100 px-1 rounded",children:"app-micerebro.web.app"})," a la lista de sitios permitidos"]})]})]})]}),(0,o.jsx)(g.z,{variant:"ghost",size:"sm",onClick:()=>{s(!1),null==r||r()},className:"h-6 w-6 p-0 flex-shrink-0",children:(0,o.jsx)(I.Z,{className:"h-4 w-4"})})]})}):null}let S=async(e,r)=>{let t=(0,i.JU)(e,"users",r.uid);try{(await (0,i.QT)(t)).exists()||await (0,i.pl)(t,{uid:r.uid,email:r.email,displayName:r.displayName||"Invitado",photoURL:r.photoURL,createdAt:(0,i.Bt)(),updatedAt:(0,i.Bt)()},{merge:!0})}catch(e){console.error("Error ensuring user document:",e)}},A={getItem:e=>{try{return"undefined"!=typeof sessionStorage?sessionStorage.getItem(e):null}catch(r){return console.error("❌ Error accediendo a sessionStorage.getItem(".concat(e,"):"),r),null}},setItem:(e,r)=>{try{"undefined"!=typeof sessionStorage&&sessionStorage.setItem(e,r)}catch(r){console.error("❌ Error accediendo a sessionStorage.setItem(".concat(e,"):"),r)}},clear:()=>{try{"undefined"!=typeof sessionStorage&&sessionStorage.clear()}catch(e){console.error("❌ Error accediendo a sessionStorage.clear():",e)}}};function R(){let e=(0,a.CU)(),r=(0,a.aC)(),{user:t,isUserLoading:l,userError:f}=(0,a.aF)(),h=(0,s.useRouter)(),{toast:v}=(0,p.pm)(),b=(0,n.useRef)(h),y=(0,n.useRef)(v),w=(0,n.useRef)(null);(0,n.useEffect)(()=>{b.current=h,y.current=v},[h,v]);let[j,C]=(0,n.useState)(!1),[N,D]=(0,n.useState)(!1),[I,R]=(0,n.useState)("login"),[k,T]=(0,n.useState)(!0),[U,L]=(0,n.useState)(!1),[z,M]=(0,n.useState)(!1),B=(0,n.useRef)(null),O=(0,n.useRef)(!1),P=(0,n.useRef)(!1),_=(0,n.useRef)(null);(0,n.useRef)(null);let Z=(0,n.useRef)(!1),G=(0,n.useRef)(!1);(0,n.useEffect)(()=>{if(j&&!G.current&&"undefined"!=typeof document)try{var e,t;let o=(null===(e=window.location)||void 0===e?void 0:e.pathname)||"/";if(!("/"===o||""===o))return;let n=document.referrer||"",s=(null===(t=window.location)||void 0===t?void 0:t.search)||"";if(n.includes("accounts.google.com")||n.includes("firebaseapp.com")||n.includes("canvasmind-app.firebaseapp.com")||s.includes("code=")||s.includes("state=")||s.includes("authType=")||"true"===A.getItem("googleRedirectCompleted")){console.log("⏭️ Redirect de Google activo, NO limpiando sesi\xf3n (permitir login)",{referrer:n,search:s,googleRedirectCompleted:A.getItem("googleRedirectCompleted")||"N/A"}),G.current=!0;return}let a="true"===A.getItem("hasRecentLogin"),i="true"===A.getItem("userJustLoggedIn");if(a||i||Z.current){console.log("⏭️ Login en progreso detectado, NO limpiando sesi\xf3n (permitir que se complete)",{hasRecentLoginFromStorage:a,userJustLoggedInFromStorage:i,userJustLoggedInRef:Z.current}),G.current=!0;return}console.log("\uD83D\uDD04 Limpiando sesi\xf3n al cargar p\xe1gina de inicio (p\xe1gina debe estar limpia)..."),B.current=null,O.current=!1,P.current=!1,_.current=null,Z.current=!1,"undefined"!=typeof sessionStorage&&A.clear(),"undefined"!=typeof localStorage&&localStorage.clear(),T(!0),G.current=!0,r&&r.currentUser&&(console.log("\uD83D\uDEAA Haciendo logout autom\xe1tico al visitar p\xe1gina de inicio...",{userId:r.currentUser.uid,isAnonymous:r.currentUser.isAnonymous}),(0,m.w7)(r).catch(e=>{console.error("Error al hacer logout:",e)}))}catch(e){console.error("❌ Error en useEffect de limpieza de sesi\xf3n:",e),G.current=!0}},[j,r]),(0,n.useEffect)(()=>{C(!0)},[]);let F=(0,n.useCallback)(async r=>{if(!j){console.log("⏭️ Componente no montado, saltando processUser...");return}if(O.current||B.current===r.uid){console.log("⏭️ Usuario ya procesado o en proceso, saltando...",{uid:r.uid});return}if(P.current||_.current){console.log("⏭️ Ya se est\xe1 redirigiendo, saltando procesamiento...");return}O.current=!0,B.current=r.uid;try{var t;let o;if(console.log("\uD83D\uDD04 [processUser] Iniciando...",{uid:r.uid}),!e)throw Error("Firestore no disponible");await S(e,r),console.log("✅ [processUser] Documento de usuario asegurado");let n=(0,i.hJ)(e,"users",r.uid,"canvasBoards");console.log("\uD83D\uDD0D [processUser] Buscando tableros en:","users/".concat(r.uid,"/canvasBoards"));try{let e=(0,i.IO)(n,(0,i.Xo)("updatedAt","desc"),(0,i.b9)(1));o=await (0,i.PL)(e),console.log("\uD83D\uDCCA [processUser] Consulta con orderBy exitosa. Tableros encontrados:",o.size)}catch(r){console.warn("⚠️ [processUser] Error con orderBy, intentando sin orden:",r),console.warn("⚠️ [processUser] Detalles del error:",{code:r.code,message:r.message});let e=await (0,i.PL)(n);if(console.log("\uD83D\uDCCA [processUser] Consulta sin orderBy. Tableros encontrados:",e.size),e.size>0){console.log("\uD83D\uDCCB [processUser] Tableros encontrados (sin orden):",e.docs.map(e=>{var r,t,o,n;return{id:e.id,name:e.data().name,updatedAt:(null===(t=e.data().updatedAt)||void 0===t?void 0:null===(r=t.toMillis)||void 0===r?void 0:r.call(t))||(null===(n=e.data().createdAt)||void 0===n?void 0:null===(o=n.toMillis)||void 0===o?void 0:o.call(n))||"sin fecha"}}));let r=e.docs.sort((e,r)=>{var t,o,n,s,a,i,l,c;let u=(null===(o=e.data().updatedAt)||void 0===o?void 0:null===(t=o.toMillis)||void 0===t?void 0:t.call(o))||(null===(s=e.data().createdAt)||void 0===s?void 0:null===(n=s.toMillis)||void 0===n?void 0:n.call(s))||0;return((null===(i=r.data().updatedAt)||void 0===i?void 0:null===(a=i.toMillis)||void 0===a?void 0:a.call(i))||(null===(c=r.data().createdAt)||void 0===c?void 0:null===(l=c.toMillis)||void 0===l?void 0:l.call(c))||0)-u});o={empty:!1,size:r.length,docs:[r[0]],docChanges:()=>[],forEach:e.forEach.bind(e),metadata:e.metadata}}else console.log("\uD83D\uDCED [processUser] No se encontraron tableros para el usuario"),o=e}if(console.log("\uD83D\uDD0D [processUser] Verificando resultados:",{empty:o.empty,size:o.size,hasDocs:!!(null===(t=o.docs)||void 0===t?void 0:t[0])}),!o.empty&&o.docs[0]){let e=o.docs[0].id;console.log("➡️ [processUser] Redirigiendo a tablero existente:",{boardId:e});let t=Date.now().toString();try{"undefined"!=typeof sessionStorage&&(A.setItem("hasRecentLogin","true"),A.setItem("loginTimestamp",t),A.setItem("redirectingToBoard",e))}catch(e){console.error("❌ Error estableciendo flags en sessionStorage:",e)}if(console.log("✅ [processUser] Flags de sessionStorage establecidos antes de redirigir:",{hasRecentLogin:A.getItem("hasRecentLogin")||"N/A",loginTimestamp:A.getItem("loginTimestamp")||"N/A",redirectingToBoard:e}),!j){console.log("⏭️ Componente desmontado durante processUser, cancelando redirecci\xf3n...");return}P.current=!0,_.current=e,O.current=!1,B.current=r.uid,r.isAnonymous&&(A.setItem("anonymousUserId",r.uid),console.log("\uD83D\uDCBE Guardando UID de usuario an\xf3nimo para restaurar despu\xe9s del redirect:",r.uid)),A.setItem("hasRecentLogin","true"),A.setItem("loginTimestamp",Date.now().toString()),A.setItem("redirectingToBoard",e),console.log("\uD83D\uDE80 Redirigiendo a tablero:",e),window.location.href="/board/".concat(e);return}{console.log("➕ [processUser] No se encontraron tableros, creando nuevo tablero..."),console.log("➕ [processUser] Datos del nuevo tablero:",{name:"Mi Primer Tablero",userId:r.uid,collection:"users/".concat(r.uid,"/canvasBoards")});let e=await (0,i.ET)(n,{name:"Mi Primer Tablero",userId:r.uid,createdAt:(0,i.Bt)(),updatedAt:(0,i.Bt)()});console.log("✅ [processUser] Nuevo tablero creado exitosamente:",{boardId:e.id,path:e.path}),y.current({title:"\xa1Bienvenido/a a Mi cerebro!",description:"Hemos creado tu primer tablero para que empieces a crear."});let t=Date.now().toString();if(A.setItem("hasRecentLogin","true"),A.setItem("loginTimestamp",t),A.setItem("redirectingToBoard",e.id),console.log("✅ [processUser] Flags de sessionStorage establecidos antes de redirigir (nuevo tablero):",{hasRecentLogin:A.getItem("hasRecentLogin"),loginTimestamp:A.getItem("loginTimestamp"),redirectingToBoard:e.id}),!j){console.log("⏭️ Componente desmontado durante processUser, cancelando redirecci\xf3n...");return}P.current=!0,_.current=e.id,O.current=!1,B.current=r.uid,r.isAnonymous&&(A.setItem("anonymousUserId",r.uid),console.log("\uD83D\uDCBE Guardando UID de usuario an\xf3nimo para restaurar despu\xe9s del redirect:",r.uid)),A.setItem("hasRecentLogin","true"),A.setItem("loginTimestamp",Date.now().toString()),A.setItem("redirectingToBoard",e.id),console.log("\uD83D\uDE80 Redirigiendo a nuevo tablero:",e.id),window.location.href="/board/".concat(e.id);return}}catch(e){if(console.error("❌ [processUser] ERROR:",e),!j){console.log("⏭️ Componente desmontado durante error en processUser, cancelando actualizaciones...");return}O.current=!1,B.current=null,P.current=!1,_.current=null,P.current||(Z.current=!1),y.current({variant:"destructive",title:"Error al buscar tableros",description:"No se pudieron cargar tus tableros: ".concat(e instanceof Error?e.message:"Error desconocido")}),T(!0)}},[e,j]);(0,n.useEffect)(()=>{w.current=F},[F]),(0,n.useEffect)(()=>{var o,n,s,a,i;if(P.current||_.current){console.log("⏭️ Ya redirigido, ignorando cambios de auth...");return}if(!j)return;if(f){console.error("❌ Error de usuario:",f),T(!0),B.current=null,O.current=!1,P.current=!1,_.current=null;return}if(l||!e||!r)return;try{if((null===(n=window.location)||void 0===n?void 0:null===(o=n.pathname)||void 0===o?void 0:o.startsWith("/board/"))||!((null===(s=window.location)||void 0===s?void 0:s.pathname)==="/"||(null===(a=window.location)||void 0===a?void 0:a.pathname)===""))return}catch(e){console.error("❌ Error verificando ruta:",e);return}if(G.current){let e="true"===A.getItem("hasRecentLogin"),o="true"===A.getItem("userJustLoggedIn");if(t&&t.uid&&!Z.current&&!(e||o)){console.log("\uD83D\uDEAA Usuario residual detectado despu\xe9s de limpieza, haciendo logout inmediato...",{userId:t.uid,isAnonymous:t.isAnonymous,hasCleanedOnMount:G.current,userJustLoggedIn:Z.current,hasRecentLoginFromStorage:e,userJustLoggedInFromStorage:o}),(0,m.w7)(r).catch(console.error),T(!0),B.current=null,O.current=!1,P.current=!1,_.current=null,Z.current=!1;return}if(!t||!t.uid){T(!0);return}}let c=!1;try{c="undefined"!=typeof sessionStorage&&"true"===A.getItem("userJustLoggedIn")}catch(e){console.error("❌ Error accediendo a sessionStorage:",e)}if(t&&t.uid){if(!(Z.current||c)){console.log("\uD83D\uDEAA Usuario detectado en p\xe1gina de inicio sin login expl\xedcito, haciendo logout...",{userJustLoggedInRef:Z.current,userJustLoggedInFromStorage:c,userId:t.uid,isAnonymous:t.isAnonymous,hasCleanedOnMount:G.current}),(0,m.w7)(r).catch(console.error),T(!0),B.current=null,O.current=!1,P.current=!1,_.current=null;return}if(B.current!==t.uid&&!O.current){console.log("✅ [FLUJO] Usuario detectado despu\xe9s de login expl\xedcito, procesando...",{uid:t.uid,email:t.email||"an\xf3nimo",isAnonymous:t.isAnonymous,hasGoogleProvider:null===(i=t.providerData)||void 0===i?void 0:i.some(e=>"google.com"===e.providerId)}),T(!1),Z.current=!0;try{"undefined"!=typeof sessionStorage&&(A.setItem("hasRecentLogin","true"),A.setItem("loginTimestamp",Date.now().toString()),A.setItem("userJustLoggedIn","true"))}catch(e){console.error("❌ Error estableciendo flags en sessionStorage:",e)}w.current&&w.current(t).catch(e=>{console.error("❌ Error en processUser:",e),T(!0)})}}else if(!t&&!l){T(!0),B.current=null,O.current=!1,P.current=!1,_.current=null,Z.current=!1;try{"undefined"!=typeof sessionStorage&&A.clear()}catch(e){console.error("❌ Error limpiando sessionStorage:",e)}}},[j,t,l,f,e,r]);let q=(0,n.useCallback)(async t=>{if(console.log("\uD83D\uDD35 handleLogin llamado con provider:",t),U){console.log("⚠️ Login ya en proceso, ignorando clic adicional");return}if(!r){console.error("❌ Auth no disponible"),v({variant:"destructive",title:"Error",description:"Servicio de autenticaci\xf3n no disponible. Por favor, recarga la p\xe1gina."});return}try{if(L(!0),console.log("\uD83D\uDD04 Iniciando proceso de login..."),Z.current=!0,A.setItem("hasRecentLogin","true"),A.setItem("loginTimestamp",Date.now().toString()),B.current=null,O.current=!1,P.current=!1,_.current=null,"google"===t){console.log("\uD83D\uDD04 Iniciando sesi\xf3n con Google (popup)...");let t=await (0,m.qj)(r);if(!(null==t?void 0:t.user))throw Error("No se pudo obtener informaci\xf3n del usuario despu\xe9s del login");Z.current=!0,A.setItem("userJustLoggedIn","true"),e&&t.user&&await S(e,t.user),L(!1)}else{let t=await (0,m.I2)(r);if(!(null==t?void 0:t.user))throw Error("No se pudo obtener informaci\xf3n del usuario despu\xe9s del login");e&&t.user&&await S(e,t.user),console.log("✅ Login exitoso (invitado), procesando usuario...",{uid:t.user.uid}),e&&t.user&&w.current&&w.current(t.user),L(!1)}}catch(r){console.error("❌ Error en handleLogin:",r),L(!1);let e="No se pudo completar el proceso de login.";"auth/popup-blocked"===r.code?(e="El popup fue bloqueado por el navegador. Por favor, permite popups para este sitio.",M(!0)):"auth/popup-closed-by-user"===r.code?e="El popup fue cerrado antes de completar el login. Por favor, intenta de nuevo.":"auth/redirect-cancelled-by-user"===r.code?e="El proceso de login fue cancelado. Por favor, intenta de nuevo.":r.message&&(e=r.message),v({variant:"destructive",title:"Error de inicio de sesi\xf3n",description:e})}},[r,e,v,U,L]),J=(0,n.useCallback)(async(t,o)=>{if(!r)throw Error("Servicio de autenticaci\xf3n no disponible.");try{let n;if(B.current=null,O.current=!1,P.current=!1,_.current=null,"login"===I?n=await (0,m.Ry)(r,t,o):(n=await (0,m.ol)(r,t,o),v({title:"\xa1Cuenta creada!",description:"Tu cuenta ha sido creada exitosamente."})),!(null==n?void 0:n.user))throw Error("No se pudo obtener informaci\xf3n del usuario despu\xe9s del login");Z.current=!0,A.setItem("hasRecentLogin","true"),A.setItem("loginTimestamp",Date.now().toString()),A.setItem("userJustLoggedIn","true"),console.log("✅ Autenticaci\xf3n con email exitosa, asegurando documento de usuario...",{uid:n.user.uid,email:n.user.email}),e&&n.user&&await S(e,n.user),console.log("✅ Autenticaci\xf3n con email exitosa, procesando usuario...",{uid:n.user.uid}),e&&n.user&&w.current&&w.current(n.user)}catch(e){throw console.error("❌ Error en handleEmailAuth:",e),Z.current=!1,B.current=null,O.current=!1,P.current=!1,_.current=null,v({variant:"destructive",title:"Error de autenticaci\xf3n",description:e.message||"No se pudo completar la autenticaci\xf3n."}),e}},[r,e,I,v]),V="true"===A.getItem("hasRecentLogin"),H=A.getItem("loginTimestamp"),W=V&&H&&Date.now()-parseInt(H)<6e4,X=Z.current||W;return t&&t.uid&&X&&(O.current||P.current||_.current||l)&&!k?(0,o.jsxs)("div",{className:"flex h-screen w-full flex-col items-center justify-center",style:{backgroundColor:"#96e4e6"},children:[(0,o.jsx)(c,{className:"mb-4 h-16 w-16 animate-pulse text-slate-900"}),(0,o.jsx)(u.Z,{className:"h-8 w-8 animate-spin text-slate-900"}),(0,o.jsx)("p",{className:"mt-4 text-lg font-semibold text-slate-900",children:"Cargando tu tablero..."})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"min-h-screen w-full flex flex-col items-center justify-center relative overflow-hidden font-sans text-slate-900",style:{backgroundColor:"#96e4e6"},children:[(0,o.jsx)("div",{className:"absolute inset-0 z-0 opacity-[0.03]",style:{backgroundImage:"radial-gradient(#2c3e50 1px, transparent 1px)",backgroundSize:"20px 20px"}}),(0,o.jsxs)("div",{className:"z-10 w-full max-w-md px-6",children:[(0,o.jsxs)("div",{className:"flex flex-col items-center mb-10 text-center",children:[(0,o.jsx)("div",{className:"h-16 w-16 bg-black rounded-full flex items-center justify-center mb-4 shadow-lg",children:(0,o.jsxs)("svg",{width:"36",height:"36",viewBox:"0 0 36 36",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,o.jsx)("defs",{children:(0,o.jsxs)("linearGradient",{id:"logoGradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[(0,o.jsx)("stop",{offset:"0%",stopColor:"#00ffaa"}),(0,o.jsx)("stop",{offset:"50%",stopColor:"#00d4ff"}),(0,o.jsx)("stop",{offset:"100%",stopColor:"#0066ff"})]})}),(0,o.jsx)("path",{d:"M6 18C6 14, 8 12, 12 12C14 12, 16 13, 18 14C20 15, 22 16, 24 16C26 16, 28 15, 30 14C32 13, 34 14, 34 18C34 22, 32 24, 30 24C28 24, 26 23, 24 22C22 21, 20 20, 18 20C16 20, 14 21, 12 22C10 23, 8 22, 6 18Z",fill:"url(#logoGradient)"}),(0,o.jsx)("path",{d:"M8 16C8 14, 9 12, 12 12C13 12, 14 13, 16 14C18 15, 20 16, 22 16C23 16, 24 15, 26 14C27 13, 28 14, 28 16C28 18, 27 20, 26 20C25 20, 24 19, 22 18C20 17, 18 16, 16 16C14 16, 12 17, 10 18C9 19, 8 18, 8 16Z",fill:"url(#logoGradient)",opacity:"0.85"}),(0,o.jsx)("path",{d:"M10 20C10 18, 11 16, 14 16C15 16, 16 17, 18 18C20 19, 22 20, 24 20C25 20, 26 19, 28 18C29 17, 30 18, 30 20C30 22, 29 24, 28 24C27 24, 26 23, 24 22C22 21, 20 20, 18 20C16 20, 14 21, 12 22C11 23, 10 22, 10 20Z",fill:"url(#logoGradient)",opacity:"0.7"}),(0,o.jsx)("path",{d:"M12 14C12 12, 13 10, 16 10C17 10, 18 11, 20 12C22 13, 24 14, 26 14C27 14, 28 13, 30 12C31 11, 32 12, 32 14C32 16, 31 18, 30 18C29 18, 28 17, 26 16C24 15, 22 14, 20 14C18 14, 16 15, 14 16C13 17, 12 16, 12 14Z",fill:"url(#logoGradient)",opacity:"0.6"})]})}),(0,o.jsx)("h1",{className:"text-4xl font-bold tracking-tight text-slate-900 mb-2",children:"Mi cerebro"}),(0,o.jsx)("p",{className:"text-slate-500 text-lg",children:"Tu lienzo de ideas infinitas."})]}),(0,o.jsxs)("div",{className:"bg-white p-8 rounded-2xl shadow-xl border border-slate-100",children:[(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsxs)(g.z,{onClick:()=>q("google"),disabled:U,size:"lg",className:"w-full",children:[U?(0,o.jsx)(u.Z,{className:"h-5 w-5 animate-spin mr-2"}):(0,o.jsx)("img",{src:"/google-logo.svg",alt:"Google",width:20,height:20,className:"mr-2 inline-block"}),U?"Iniciando sesi\xf3n...":"Iniciar Sesi\xf3n con Google"]}),(0,o.jsxs)("div",{className:"relative",children:[(0,o.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,o.jsx)("span",{className:"w-full border-t border-slate-200"})}),(0,o.jsx)("div",{className:"relative flex justify-center text-xs uppercase",children:(0,o.jsx)("span",{className:"bg-white px-2 text-slate-400",children:"O contin\xfaa como"})})]}),(0,o.jsxs)(g.z,{onClick:()=>q("guest"),disabled:U,size:"lg",variant:"default",className:"w-full bg-[#16b5a8] hover:bg-[#139c91] text-white",children:[U?(0,o.jsx)(u.Z,{className:"h-5 w-5 animate-spin mr-2"}):(0,o.jsx)(d,{className:"h-5 w-5 mr-2"}),U?"Iniciando sesi\xf3n...":"Invitado"]})]}),(0,o.jsxs)("div",{className:"mt-6 text-center space-x-2",children:[(0,o.jsx)("button",{onClick:()=>{R("login"),D(!0)},className:"text-blue-600 italic hover:text-blue-700 underline text-sm",children:"Log in"}),(0,o.jsx)("span",{className:"text-blue-600 italic text-sm",children:"/"}),(0,o.jsx)("button",{onClick:()=>{R("signup"),D(!0)},className:"text-blue-600 italic hover:text-blue-700 underline text-sm",children:"Crear Cuenta"}),(null==r?void 0:r.currentUser)&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:"text-blue-600 italic text-sm mx-2",children:"/"}),(0,o.jsx)("button",{onClick:async()=>{try{await (0,m.w7)(r),A.clear(),B.current=null,O.current=!1,P.current=!1,_.current=null,Z.current=!1,T(!0),v({title:"Sesi\xf3n cerrada",description:"Has cerrado sesi\xf3n correctamente."})}catch(e){console.error("Error al cerrar sesi\xf3n:",e),v({variant:"destructive",title:"Error",description:"No se pudo cerrar la sesi\xf3n."})}},className:"text-red-600 italic hover:text-red-700 underline text-sm",children:"Cerrar Sesi\xf3n"})]})]})]})]})]}),(0,o.jsx)(x,{isOpen:N,onOpenChange:D,mode:I,onAuth:J}),z&&(0,o.jsx)(E,{onDismiss:()=>M(!1)})]})}function k(){return(0,o.jsx)(R,{})}},12381:function(e,r,t){"use strict";t.d(r,{d:function(){return l},z:function(){return c}});var o=t(57437),n=t(2265),s=t(37053),a=t(90535),i=t(93448);let l=(0,a.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=n.forwardRef((e,r)=>{let{className:t,variant:n,size:a,asChild:c=!1,...u}=e,d=c?s.g7:"button";return(0,o.jsx)(d,{className:(0,i.cn)(l({variant:n,size:a,className:t})),ref:r,...u})});c.displayName="Button"},74291:function(e,r,t){"use strict";t.d(r,{$N:function(){return g},Be:function(){return f},Vq:function(){return l},cN:function(){return m},cZ:function(){return d},fK:function(){return p}});var o=t(57437),n=t(2265),s=t(70001),a=t(44986),i=t(93448);let l=s.fC;s.xz;let c=s.h_;s.x8;let u=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,o.jsx)(s.aV,{ref:r,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...n})});u.displayName=s.aV.displayName;let d=n.forwardRef((e,r)=>{let{className:t,children:n,...l}=e;return(0,o.jsxs)(c,{children:[(0,o.jsx)(u,{}),(0,o.jsxs)(s.VY,{ref:r,className:(0,i.cn)("fixed left-[50%] top-[50%] z-[50000] grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...l,children:[n,(0,o.jsxs)(s.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,o.jsx)(a.Z,{className:"h-4 w-4"}),(0,o.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});d.displayName=s.VY.displayName;let p=e=>{let{className:r,...t}=e;return(0,o.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",r),...t})};p.displayName="DialogHeader";let m=e=>{let{className:r,...t}=e;return(0,o.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",r),...t})};m.displayName="DialogFooter";let g=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,o.jsx)(s.Dx,{ref:r,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",t),...n})});g.displayName=s.Dx.displayName;let f=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,o.jsx)(s.dk,{ref:r,className:(0,i.cn)("text-sm text-muted-foreground",t),...n})});f.displayName=s.dk.displayName},40279:function(e,r,t){"use strict";t.d(r,{I:function(){return a}});var o=t(57437),n=t(2265),s=t(93448);let a=n.forwardRef((e,r)=>{let{className:t,type:n,...a}=e;return(0,o.jsx)("input",{type:n,className:(0,s.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...a})});a.displayName="Input"},75060:function(e,r,t){"use strict";t.d(r,{_:function(){return c}});var o=t(57437),n=t(2265),s=t(370),a=t(90535),i=t(93448);let l=(0,a.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,o.jsx)(s.f,{ref:r,className:(0,i.cn)(l(),t),...n})});c.displayName=s.f.displayName},33931:function(e,r,t){"use strict";t.d(r,{I2:function(){return s},Ry:function(){return a},ol:function(){return i},qj:function(){return n},w7:function(){return l}});var o=t(44752);async function n(e){let r=new o.hJ;r.setCustomParameters({prompt:"select_account",client_id:"917199598510-14h0c930cobfvnig8kdfj5i42untd7rg.apps.googleusercontent.com"});try{console.log("\uD83D\uDD04 Iniciando sesi\xf3n con Google (popup)..."),console.log("\uD83D\uDD04 Llamando a signInWithPopup...");let t=await (0,o.rh)(e,r);return console.log("✅ signInWithPopup exitoso:",t.user.email),t}catch(e){if(console.error("❌ Error during Google sign-in popup:",e),console.error("❌ Error code:",e.code),console.error("❌ Error message:",e.message),e.code&&e.code.startsWith("auth/"))throw e;if("auth/popup-blocked"===e.code)throw Error("El popup fue bloqueado. Por favor, permite popups para este sitio e intenta de nuevo.");if("auth/popup-closed-by-user"===e.code)throw Error("El popup fue cerrado antes de completar el login. Por favor, intenta de nuevo.");throw Error(e.message||"No se pudo completar el inicio de sesi\xf3n con Google. Por favor, intenta de nuevo.")}}let s=async e=>{try{return await (0,o.XB)(e)}catch(e){throw console.error("Error signing in as guest:",e),e}},a=async(e,r,t)=>{try{return await (0,o.e5)(e,r,t)}catch(e){throw console.error("Error signing in with email:",e),e}},i=async(e,r,t)=>{try{return await (0,o.Xb)(e,r,t)}catch(e){throw console.error("Error creating user with email:",e),e}},l=async e=>{try{await (0,o.w7)(e)}catch(e){throw console.error("Error signing out:",e),e}}},63996:function(e,r,t){"use strict";t.d(r,{CU:function(){return l},aC:function(){return i},aF:function(){return u},fE:function(){return s},y$:function(){return c}}),t(57437);var o=t(2265);let n={firebaseApp:null,firestore:null,auth:null,storage:null,user:null,isUserLoading:!0,userError:null},s=(0,o.createContext)(n),a=()=>{let e=(0,o.useContext)(s);return void 0===e?(console.error("useFirebaseContext must be used within a FirebaseProvider."),n):e},i=()=>{var e,r;return null!==(r=null===(e=a())||void 0===e?void 0:e.auth)&&void 0!==r?r:null},l=()=>{var e,r;return null!==(r=null===(e=a())||void 0===e?void 0:e.firestore)&&void 0!==r?r:null},c=()=>{var e,r;return null!==(r=null===(e=a())||void 0===e?void 0:e.storage)&&void 0!==r?r:null},u=()=>{let{user:e,isUserLoading:r,userError:t}=a();return{user:e,isUserLoading:r,userError:t}}},23340:function(e,r,t){"use strict";t.d(r,{pm:function(){return p}});var o=t(2265);let n=0,s=new Map,a=e=>{if(s.has(e))return;let r=setTimeout(()=>{s.delete(e),u({type:"REMOVE_TOAST",toastId:e})},1e6);s.set(e,r)},i=(e,r)=>{switch(r.type){case"ADD_TOAST":return{...e,toasts:[r.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===r.toast.id?{...e,...r.toast}:e)};case"DISMISS_TOAST":{let{toastId:t}=r;return t?a(t):e.toasts.forEach(e=>{a(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===t||void 0===t?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===r.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==r.toastId)}}},l=[],c={toasts:[]};function u(e){c=i(c,e),l.forEach(e=>{e(c)})}function d(e){let{...r}=e,t=(n=(n+1)%Number.MAX_SAFE_INTEGER).toString(),o=()=>u({type:"DISMISS_TOAST",toastId:t});return u({type:"ADD_TOAST",toast:{...r,id:t,open:!0,onOpenChange:e=>{e||o()}}}),{id:t,dismiss:o,update:e=>u({type:"UPDATE_TOAST",toast:{...e,id:t}})}}function p(){let[e,r]=o.useState(c);return o.useEffect(()=>(l.push(r),()=>{let e=l.indexOf(r);e>-1&&l.splice(e,1)}),[]),{...e,toast:d,dismiss:e=>u({type:"DISMISS_TOAST",toastId:e})}}},93448:function(e,r,t){"use strict";t.d(r,{cn:function(){return s}});var o=t(61994),n=t(53335);function s(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,n.m6)((0,o.W)(r))}},12032:function(e,r,t){"use strict";t.d(r,{Z:function(){return o}});let o=(0,t(96471).Z)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])}},function(e){e.O(0,[358,637,279,343,656,971,117,744],function(){return e(e.s=89256)}),_N_E=e.O()}]);