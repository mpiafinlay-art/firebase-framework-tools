(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[872],{58781:function(e,t,n){Promise.resolve().then(n.bind(n,21894))},21894:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return nx}});var r=n(57437),a=n(2265),o=n(99376),s=n(53459),l=n(63996),i=n(3011),c=n(5978),d=n(738),u=n(89799);let p=()=>{let e;return e=(0,d.C6)().length?(0,d.Mq)():(0,d.ZF)(u.q),(0,c.ad)(e)},m=(0,i.U)((e,t)=>({elements:[],board:null,selectedElementIds:[],isLoading:!0,error:null,unsubscribeElements:null,loadBoard:async(n,r)=>{let{unsubscribeElements:a}=t();a&&(a(),e({unsubscribeElements:null})),e({isLoading:!0,error:null});try{let a;let o=p(),s=(0,c.JU)(o,"users",r,"canvasBoards",n),l=await (0,c.QT)(s);if(!l.exists())throw Error("El tablero no existe o no tienes permiso para verlo.");let i=l.data(),d={id:l.id,...i,userId:i.userId||i.ownerId||r},u=(0,c.hJ)(o,"users",r,"canvasBoards",n,"canvasElements");try{let n=(0,c.IO)(u,(0,c.Xo)("zIndex","asc"));a=(0,c.cf)(n,n=>{let r=n.docs.map(e=>({id:e.id,...e.data()})),a=t().elements,o=new Set(a.map(e=>e.id)),s=new Set(r.map(e=>e.id));o.size!==s.size||Array.from(o).some(e=>!s.has(e))||Array.from(s).some(e=>!o.has(e))?e({elements:r,isLoading:!1}):a.some(e=>{let t=r.find(t=>t.id===e.id);return!t||JSON.stringify(e.content)!==JSON.stringify(t.content)||JSON.stringify(e.properties)!==JSON.stringify(t.properties)||e.zIndex!==t.zIndex})&&e({elements:r,isLoading:!1})},n=>{console.error("Error en listener de elementos:",n),a&&a();let r=(0,c.cf)(u,n=>{let r=n.docs.map(e=>({id:e.id,...e.data()}));r.sort((e,t)=>{let n=e.zIndex||0,r=t.zIndex||0;return n-r});let a=t().elements,o=new Set(a.map(e=>e.id)),s=new Set(r.map(e=>e.id));o.size!==s.size||Array.from(o).some(e=>!s.has(e))||Array.from(s).some(e=>!o.has(e))?e({elements:r,isLoading:!1}):a.some(e=>{let t=r.find(t=>t.id===e.id);return!t||JSON.stringify(e.content)!==JSON.stringify(t.content)||JSON.stringify(e.properties)!==JSON.stringify(t.properties)||e.zIndex!==t.zIndex})&&e({elements:r,isLoading:!1})},t=>{console.error("Error en listener de elementos (fallback):",t),e({isLoading:!1,error:t.message})});e({unsubscribeElements:r})})}catch(n){console.warn("orderBy fall\xf3, usando sin orden:",n),a=(0,c.cf)(u,n=>{let r=n.docs.map(e=>({id:e.id,...e.data()}));r.sort((e,t)=>{let n=e.zIndex||0,r=t.zIndex||0;return n-r});let a=t().elements,o=new Set(a.map(e=>e.id)),s=new Set(r.map(e=>e.id));o.size!==s.size||Array.from(o).some(e=>!s.has(e))||Array.from(s).some(e=>!o.has(e))?e({elements:r,isLoading:!1}):a.some(e=>{let t=r.find(t=>t.id===e.id);return!t||JSON.stringify(e.content)!==JSON.stringify(t.content)||JSON.stringify(e.properties)!==JSON.stringify(t.properties)||e.zIndex!==t.zIndex})&&e({elements:r,isLoading:!1})},t=>{console.error("Error en listener de elementos:",t),e({isLoading:!1,error:t.message})})}return e({board:d,unsubscribeElements:a,selectedElementIds:[]}),console.log("✅ [boardStore] Tablero cargado exitosamente:",{boardId:n,userId:r,boardName:d.name}),n}catch(t){return console.error("❌ [boardStore] Error al cargar el tablero:",t),e({isLoading:!1,error:t.message,board:null,elements:[]}),null}},cleanup:()=>{let{unsubscribeElements:n}=t();n&&(n(),e({unsubscribeElements:null}))},createBoard:async function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Mi Primer Tablero";e({isLoading:!0});let r={name:n,userId:t,createdAt:new Date,updatedAt:new Date};try{let n=p(),a=await (0,c.ET)((0,c.hJ)(n,"users",t,"canvasBoards"),r);return console.log("Nuevo tablero creado con ID:",a.id),e({isLoading:!1}),a.id}catch(t){return console.error("Error al crear el tablero:",t),e({error:"No se pudo crear el tablero.",isLoading:!1}),""}},addElement:async e=>{let{board:n}=t();if(!n)return;let r=n.userId||n.ownerId;if(!r){console.error("No se pudo obtener userId para a\xf1adir elemento");return}try{let t=p(),a=(0,c.hJ)(t,"users",r,"canvasBoards",n.id,"canvasElements");await (0,c.ET)(a,e)}catch(e){console.error("Error al a\xf1adir el elemento:",e)}},updateElement:async(e,n)=>{let{board:r}=t();if(!r)return;let a=r.userId||r.ownerId;if(!a){console.error("No se pudo obtener userId para actualizar elemento");return}try{let t=p(),o=(0,c.JU)(t,"users",a,"canvasBoards",r.id,"canvasElements",e);await (0,c.r7)(o,n)}catch(e){console.error("Error al actualizar el elemento:",e)}},deleteElement:async e=>{let{board:n}=t();if(!n)return;let r=n.userId||n.ownerId;if(!r){console.error("No se pudo obtener userId para eliminar elemento");return}try{let t=p(),a=(0,c.JU)(t,"users",r,"canvasBoards",n.id,"canvasElements",e);await (0,c.oe)(a)}catch(e){console.error("Error al eliminar el elemento:",e)}},setSelectedElementIds:t=>{e({selectedElementIds:t})}}));var h=n(23340);let g=e=>{let[t,n]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{let t=window.matchMedia(e),r=()=>n(t.matches);return r(),t.addEventListener("change",r),()=>t.removeEventListener("change",r)},[e]),t};var f=n(60062);async function x(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return new Promise((n,r)=>{let a=new FileReader;a.onload=a=>{var o;let s=new Image;s.onload=()=>{let a=document.createElement("canvas"),o=s.width,l=s.height;if((o>1920||l>1920)&&(o>l?(l=l/o*1920,o=1920):(o=o/l*1920,l=1920)),o>720||l>720){let e=o/l;o>l?l=(o=720)/e:o=(l=720)*e}a.width=o,a.height=l;let i=a.getContext("2d");if(!i){r(Error("No se pudo obtener el contexto del canvas"));return}i.imageSmoothingEnabled=!0,i.imageSmoothingQuality="high",i.drawImage(s,0,0,o,l);let c=s=>{a.toBlob(a=>{if(!a){r(Error("Error al comprimir la imagen"));return}let i=a.size/1024;if(i<=t||s<=.1){let r=new File([a],e.name,{type:"image/jpeg",lastModified:Date.now()});i>t&&console.warn("⚠️ Imagen comprimida pero a\xfan excede ".concat(t,"KB: ").concat(i.toFixed(2),"KB")),console.log("✅ Imagen comprimida a 72 DPI efectivo: ".concat((e.size/1024).toFixed(2),"KB → ").concat(i.toFixed(2),"KB (").concat(o,"x").concat(l,"px)")),n(r)}else c(Math.max(.1,s-.1))},"image/jpeg",s)};c(.9)},s.onerror=()=>{r(Error("Error al cargar la imagen"))},(null===(o=a.target)||void 0===o?void 0:o.result)&&(s.src=a.target.result)},a.onerror=()=>{r(Error("Error al leer el archivo"))},a.readAsDataURL(e)})}async function v(e,t,n){if(!["image/jpeg","image/jpg","image/png","image/gif","image/webp","image/svg+xml"].includes(e.type))return{success:!1,url:"",path:"",fileName:"",size:0,type:e.type,error:"Tipo de archivo no permitido. Solo se permiten im\xe1genes (JPEG, PNG, GIF, WebP, SVG)"};if(e.size>10485760)return{success:!1,url:"",path:"",fileName:"",size:e.size,type:e.type,error:"El archivo es demasiado grande. El tama\xf1o m\xe1ximo es 10MB"};if(!n)return{success:!1,url:"",path:"",fileName:"",size:e.size,type:e.type,error:"Firebase Storage no est\xe1 disponible. Verifica tu conexi\xf3n."};try{console.log("\uD83D\uDCE4 uploadFile: Iniciando subida directa a Firebase Storage:",{fileName:e.name,size:e.size,type:e.type,userId:t});let r=e;if(e.type.startsWith("image/")&&!e.type.includes("svg")){console.log("\uD83D\uDCE6 Comprimiendo imagen a m\xe1ximo 200KB y 72 DPI efectivo...");try{let t=(r=await x(e,200)).size/1024;if(t>200){console.error("❌ ERROR: Archivo comprimido excede 200KB: ".concat(t.toFixed(2),"KB"));let n=(r=await x(e,200)).size/1024;if(n>200)return{success:!1,url:"",path:"",fileName:"",size:r.size,type:e.type,error:"No se pudo comprimir la imagen a menos de 200KB. Tama\xf1o final: ".concat(n.toFixed(2),"KB")}}console.log("✅ Imagen comprimida a 72 DPI efectivo: ".concat((e.size/1024).toFixed(2),"KB → ").concat(t.toFixed(2),"KB"))}catch(t){if(console.warn("⚠️ Error al comprimir imagen, subiendo original:",t),e.size>204800)return{success:!1,url:"",path:"",fileName:"",size:e.size,type:e.type,error:"Error al comprimir imagen. El archivo original (".concat((e.size/1024).toFixed(2),"KB) excede el l\xedmite de 200KB.")}}}else if(e.size>204800)return{success:!1,url:"",path:"",fileName:"",size:e.size,type:e.type,error:"El archivo (".concat((e.size/1024).toFixed(2),"KB) excede el l\xedmite m\xe1ximo de 200KB permitido.")};let a=Date.now(),o=Math.random().toString(36).substring(2,15),s=r.name.split(".").pop()||"jpg",l="".concat(a,"_").concat(o,".").concat(s),i="users/".concat(t,"/images/").concat(l),c=(0,f.iH)(n,i),d={contentType:r.type,customMetadata:{originalName:e.name,originalSize:e.size.toString(),compressedSize:r.size.toString(),uploadedBy:t,uploadedAt:new Date().toISOString()}};console.log("\uD83D\uDCE4 uploadFile: Subiendo bytes a Storage...");let u=await (0,f.KV)(c,r,d);console.log("\uD83D\uDCE4 uploadFile: Archivo subido, obteniendo URL de descarga...");let p=await (0,f.Jt)(u.ref);return console.log("✅ uploadFile: Subida exitosa:",{url:p,path:i}),{success:!0,url:p,path:i,fileName:l,size:r.size,type:r.type}}catch(n){console.error("❌ uploadFile: Error al subir:",n);let t="Error al subir el archivo.";return"storage/unauthorized"===n.code?t="No tienes permisos para subir archivos. Verifica que est\xe9s autenticado correctamente.":"storage/quota-exceeded"===n.code?t="Se ha excedido la cuota de almacenamiento.":"storage/unauthenticated"===n.code?t="Debes estar autenticado para subir archivos.":n.message&&(t=n.message),{success:!1,url:"",path:"",fileName:"",size:e.size,type:e.type,error:t}}}var b=n(24457),w=n.n(b),y=n(93448),j=n(12381),N=n(49902),C=n(60895),E=n(56477),k=n(99049),z=n(41936),T=n(3289),S=n(13195),D=n(90759);let I=a.forwardRef((e,t)=>{let{className:n,orientation:a="horizontal",decorative:o=!0,...s}=e;return(0,r.jsx)(D.f,{ref:t,decorative:o,orientation:a,className:(0,y.cn)("shrink-0 bg-border","horizontal"===a?"h-[1px] w-full":"h-full w-[1px]",n),...s})});function P(e){let{zoomIn:t,zoomOut:n,resetZoom:a,scale:o,centerOnElements:s,goToHome:l,selectedElement:i,onBringToFront:c,onSendToBack:d,onMoveBackward:u,isMobile:p}=e,m=(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(j.z,{variant:"ghost",size:"icon",onClick:n,className:"h-8 w-8",children:[(0,r.jsx)(N.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Alejar"})]}),(0,r.jsxs)("button",{onClick:a,className:"flex h-8 w-12 items-center justify-center rounded-sm text-sm font-medium text-muted-foreground transition-colors hover:bg-accent hover:text-accent-foreground",children:[Math.round(100*o),"%"]}),(0,r.jsxs)(j.z,{variant:"ghost",size:"icon",onClick:t,className:"h-8 w-8",children:[(0,r.jsx)(C.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Acercar"})]}),(0,r.jsx)(I,{orientation:"vertical",className:"h-6"}),(0,r.jsxs)(j.z,{variant:"ghost",size:"icon",onClick:s,className:"h-8 w-8",children:[(0,r.jsx)(E.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Centrar en Contenido"})]}),(0,r.jsxs)(j.z,{variant:"ghost",size:"icon",onClick:l,className:"h-8 w-8",children:[(0,r.jsx)(k.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Ir al Inicio"})]}),i&&"frame"!==i.type&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(I,{orientation:"vertical",className:"h-6 mx-1"}),(0,r.jsxs)(j.z,{variant:"ghost",size:"icon",onClick:()=>c(i.id),className:"h-8 w-8",title:"Traer al frente",children:[(0,r.jsx)(z.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Traer al frente"})]}),(0,r.jsxs)(j.z,{variant:"ghost",size:"icon",onClick:()=>u(i.id),className:"h-8 w-8",title:"Enviar hacia atr\xe1s",children:[(0,r.jsx)(T.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Enviar hacia atr\xe1s"})]}),(0,r.jsxs)(j.z,{variant:"ghost",size:"icon",onClick:()=>d(i.id),className:"h-8 w-8",title:"Enviar al fondo",children:[(0,r.jsx)(S.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Enviar al fondo"})]})]})]});return(0,r.jsx)("div",{className:(0,y.cn)("absolute z-[10002] flex items-center gap-1 rounded-lg border bg-background p-1 shadow-md",p?"bottom-4 left-1/2 -translate-x-1/2":"bottom-4 right-4"),children:m})}I.displayName=D.f.displayName;var R=n(43728),M=n(27860),F=n(7880);let A=F.fC,B=F.xz,L=F.h_,Z=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(F.aV,{className:(0,y.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",n),...a,ref:t})});Z.displayName=F.aV.displayName;let O=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsxs)(L,{children:[(0,r.jsx)(Z,{}),(0,r.jsx)(F.VY,{ref:t,className:(0,y.cn)("fixed left-[50%] top-[50%] z-[50001] grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",n),...a})]})});O.displayName=F.VY.displayName;let U=e=>{let{className:t,...n}=e;return(0,r.jsx)("div",{className:(0,y.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...n})};U.displayName="AlertDialogHeader";let H=e=>{let{className:t,...n}=e;return(0,r.jsx)("div",{className:(0,y.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...n})};H.displayName="AlertDialogFooter";let _=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(F.Dx,{ref:t,className:(0,y.cn)("text-lg font-semibold",n),...a})});_.displayName=F.Dx.displayName;let W=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(F.dk,{ref:t,className:(0,y.cn)("text-sm text-muted-foreground",n),...a})});W.displayName=F.dk.displayName;let K=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(F.aU,{ref:t,className:(0,y.cn)((0,j.d)(),n),...a})});K.displayName=F.aU.displayName;let q=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(F.$j,{ref:t,className:(0,y.cn)((0,j.d)({variant:"outline"}),"mt-2 sm:mt-0",n),...a})});function J(e){let{isOpen:t,onOpenChange:n,onConfirm:a}=e;return(0,r.jsx)(A,{open:t,onOpenChange:n,children:(0,r.jsxs)(O,{children:[(0,r.jsxs)(U,{children:[(0,r.jsx)(_,{children:"\xbfEst\xe1s seguro?"}),(0,r.jsx)(W,{children:"Esta acci\xf3n no se puede deshacer. Se eliminar\xe1 permanentemente el elemento."})]}),(0,r.jsxs)(H,{children:[(0,r.jsx)(q,{onClick:()=>n(!1),children:"Cancelar"}),(0,r.jsx)(K,{onClick:a,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"S\xed, eliminar"})]})]})})}q.displayName=F.$j.displayName;let V=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,y.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",n),...a})});V.displayName="Card";let G=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,y.cn)("flex flex-col space-y-1.5 p-6",n),...a})});G.displayName="CardHeader",a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,y.cn)("text-2xl font-semibold leading-none tracking-tight",n),...a})}).displayName="CardTitle",a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,y.cn)("text-sm text-muted-foreground",n),...a})}).displayName="CardDescription";let Y=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,y.cn)("p-6 pt-0",n),...a})});Y.displayName="CardContent";let X=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,y.cn)("flex items-center p-6 pt-0",n),...a})});X.displayName="CardFooter";var Q=n(82521),$=n(76848),ee=n(69626),et=n(24926),en=n(78868),er=n(35465),ea=n(99342),eo=n(96888),es=n(25229),el=n(37287),ei=n(25518),ec=n(14787),ed=n(26254),eu=n(40339),ep=n(95490),em=n(44986),eh=n(28119),eg=n(59559),ef=n(78084);let ex=eh.fC,ev=eh.xz;eh.ZA,eh.Uv;let eb=eh.Tr;eh.Ee;let ew=a.forwardRef((e,t)=>{let{className:n,inset:a,children:o,...s}=e;return(0,r.jsxs)(eh.fF,{ref:t,className:(0,y.cn)("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",a&&"pl-8",n),...s,children:[o,(0,r.jsx)($.Z,{className:"ml-auto"})]})});ew.displayName=eh.fF.displayName;let ey=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(eh.tu,{ref:t,className:(0,y.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n),...a})});ey.displayName=eh.tu.displayName;let ej=a.forwardRef((e,t)=>{let{className:n,sideOffset:a=4,...o}=e;return(0,r.jsx)(eh.Uv,{children:(0,r.jsx)(eh.VY,{ref:t,sideOffset:a,className:(0,y.cn)("z-[50001] min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n),...o})})});ej.displayName=eh.VY.displayName;let eN=a.forwardRef((e,t)=>{let{className:n,inset:a,...o}=e;return(0,r.jsx)(eh.ck,{ref:t,className:(0,y.cn)("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",a&&"pl-8",n),...o})});eN.displayName=eh.ck.displayName,a.forwardRef((e,t)=>{let{className:n,children:a,checked:o,...s}=e;return(0,r.jsxs)(eh.oC,{ref:t,className:(0,y.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),checked:o,...s,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(eh.wU,{children:(0,r.jsx)(eg.Z,{className:"h-4 w-4"})})}),a]})}).displayName=eh.oC.displayName,a.forwardRef((e,t)=>{let{className:n,children:a,...o}=e;return(0,r.jsxs)(eh.Rk,{ref:t,className:(0,y.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),...o,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(eh.wU,{children:(0,r.jsx)(ef.Z,{className:"h-2 w-2 fill-current"})})}),a]})}).displayName=eh.Rk.displayName,a.forwardRef((e,t)=>{let{className:n,inset:a,...o}=e;return(0,r.jsx)(eh.__,{ref:t,className:(0,y.cn)("px-2 py-1.5 text-sm font-semibold",a&&"pl-8",n),...o})}).displayName=eh.__.displayName;let eC=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(eh.Z0,{ref:t,className:(0,y.cn)("-mx-1 my-1 h-px bg-muted",n),...a})});eC.displayName=eh.Z0.displayName;var eE=n(64014);function ek(e){let{isOpen:t,onOpenChange:n,onConfirm:a}=e;return(0,r.jsx)(A,{open:t,onOpenChange:n,children:(0,r.jsxs)(O,{onMouseDown:e=>e.stopPropagation(),children:[(0,r.jsxs)(U,{children:[(0,r.jsx)(_,{children:"\xbfEliminar este cuaderno?"}),(0,r.jsx)(W,{children:"Esta acci\xf3n no se puede deshacer. Se eliminar\xe1 permanentemente el cuaderno y todo su contenido."})]}),(0,r.jsxs)(H,{children:[(0,r.jsx)(q,{onClick:()=>n(!1),children:"Cancelar"}),(0,r.jsx)(K,{onClick:a,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"S\xed, eliminar"})]})]})})}function ez(e){let{getContent:t,onSave:n,debounceMs:r=2e3,disabled:o=!1,compareContent:s}=e,[l,i]=(0,a.useState)("idle"),c=(0,a.useRef)(null),d=(0,a.useRef)(null),u=(0,a.useRef)(!1),p=(0,a.useRef)(null),m=(0,a.useCallback)((e,t)=>e===t,[]);(0,a.useEffect)(()=>()=>{c.current&&clearTimeout(c.current),p.current&&clearTimeout(p.current)},[]);let h=(0,a.useCallback)(async()=>{if(!u.current)try{u.current=!0;let e=t(),r=e=>{if("string"==typeof e)return e.replace(/\s+/g," ").replace(/>\s+</g,"><").trim();if("object"==typeof e&&null!==e)try{return JSON.stringify(e)}catch(e){}return e},a=r(e),o=null!==d.current?r(d.current):null;if(null!==o&&a===o){u.current=!1;return}i("saving"),await n(e),d.current=e,i("saved"),p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{i("idle")},2e3)}catch(e){console.error("Error al guardar:",e),i("error"),p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{i("idle")},3e3)}finally{u.current=!1}},[t,n,s||m]),g=(0,a.useCallback)(()=>{c.current&&(clearTimeout(c.current),c.current=null)},[]);return{saveStatus:l,forceSave:(0,a.useCallback)(async()=>{g(),await h()},[g,h]),handleBlur:(0,a.useCallback)(async()=>{g(),await h()},[g,h]),handleChange:(0,a.useCallback)(()=>{o||(g(),c.current=setTimeout(()=>{h()},r))},[o,g,h,r]),cancelPendingSave:g}}var eT=n(24287),eS=n(25309),eD=n(74587);function eI(e){let{status:t,className:n,size:a="sm"}=e,o={sm:"w-3 h-3",md:"w-4 h-4",lg:"w-5 h-5"}[a],l=()=>{switch(t){case"saving":return"Guardando...";case"saved":return"Guardado";case"error":return"Error";default:return""}};return(0,r.jsxs)("div",{className:(0,y.cn)("flex items-center gap-1 text-xs text-muted-foreground",n),title:l(),children:[(()=>{switch(t){case"saving":return(0,r.jsx)(s.Z,{className:(0,y.cn)(o,"animate-spin text-blue-500")});case"saved":return(0,r.jsx)(eT.Z,{className:(0,y.cn)(o,"text-green-500")});case"error":return(0,r.jsx)(eS.Z,{className:(0,y.cn)(o,"text-red-500")});default:return(0,r.jsx)(eD.Z,{className:(0,y.cn)(o,"text-gray-400")})}})(),"idle"!==t&&(0,r.jsx)("span",{className:"text-[10px] leading-none",children:l()})]})}var eP=n(53375),eR=n(74291),eM=n(9270);let eF=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(eM.fC,{ref:t,className:(0,y.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",n),...a,children:(0,r.jsx)(eM.z$,{className:(0,y.cn)("flex items-center justify-center text-current"),children:(0,r.jsx)(eg.Z,{className:"h-4 w-4"})})})});eF.displayName=eM.fC.displayName;var eA=n(75060);function eB(e){let{isOpen:t,onOpenChange:n,totalPages:o,onExport:s}=e,[l,i]=(0,a.useState)([]);(0,a.useEffect)(()=>{t&&i(Array.from({length:o},(e,t)=>t))},[t,o]);let c=e=>{i(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e].sort((e,t)=>e-t))};return(0,r.jsx)(eR.Vq,{open:t,onOpenChange:n,children:(0,r.jsxs)(eR.cZ,{className:"max-w-md",children:[(0,r.jsx)(eR.fK,{children:(0,r.jsx)(eR.$N,{children:"Exportar P\xe1ginas a PDF"})}),(0,r.jsxs)("div",{className:"py-4",children:[(0,r.jsx)("div",{className:"mb-4",children:(0,r.jsx)(j.z,{variant:"outline",size:"sm",onClick:()=>{l.length===o?i([]):i(Array.from({length:o},(e,t)=>t))},className:"w-full",children:l.length===o?"Deseleccionar Todas":"Seleccionar Todas"})}),(0,r.jsx)("div",{className:"max-h-64 overflow-y-auto space-y-2",children:Array.from({length:o},(e,t)=>(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(eF,{id:"page-".concat(t),checked:l.includes(t),onCheckedChange:()=>c(t)}),(0,r.jsxs)(eA._,{htmlFor:"page-".concat(t),className:"flex-1 cursor-pointer",children:["P\xe1gina ",t+1]})]},t))}),(0,r.jsx)("p",{className:"mt-4 text-sm text-muted-foreground",children:0===l.length?"Selecciona al menos una p\xe1gina para exportar":"Se exportar\xe1n ".concat(l.length," p\xe1gina").concat(l.length>1?"s":"")})]}),(0,r.jsxs)(eR.cN,{children:[(0,r.jsx)(j.z,{variant:"outline",onClick:()=>n(!1),children:"Cancelar"}),(0,r.jsx)(j.z,{onClick:()=>{0!==l.length&&(s(l),n(!1))},disabled:0===l.length,children:"Exportar PDF"})]})]})})}n(55392);var eL=n(36692);function eZ(e){let{elementRef:t,isListening:r,liveTranscript:o,finalTranscript:s="",interimTranscript:l="",isSelected:i=!1,enabled:c=!0}=e,d=(0,a.useRef)({lastInsertedText:"",lastFinalText:""}),u=(0,a.useRef)(""),p=(0,a.useRef)(t.current);(0,a.useEffect)(()=>{p.current=t.current},[t.current]),(0,a.useEffect)(()=>{if(!c||!r||!p.current)return;let e=p.current,t=document.activeElement===e;if((t||i&&e.isContentEditable)&&(o||s||l)&&(o!==u.current||""===o))try{if(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement)(0,eL.insertDictationTextToInput)(e,o||"",s||"",d.current),u.current=o;else if(e.isContentEditable){if(!t&&i)e.focus(),setTimeout(()=>{if(p.current){(0,eL.insertDictationTextToContentEditable)(p.current,o||"",s||"",l||"",d.current);let e=new Event("input",{bubbles:!0});p.current.dispatchEvent(e),u.current=o}},50);else{(0,eL.insertDictationTextToContentEditable)(e,o||"",s||"",l||"",d.current);let t=new Event("input",{bubbles:!0});e.dispatchEvent(t),u.current=o}}}catch(e){console.error("Error insertando dictado:",e)}},[r,o,s,l,i,c]),(0,a.useEffect)(()=>{let e=p.current;if(!r&&e&&e.isContentEditable){let{finalizeInterimText:t}=n(36692);t(e)}if(s&&e&&e.isContentEditable){let{finalizeInterimText:t}=n(36692);t(e)}},[r,s]),(0,a.useEffect)(()=>{r||(d.current={lastInsertedText:"",lastFinalText:""},u.current="")},[r])}let eO=e=>{let{currentPage:t,totalPages:n,onPageChange:a,onAddPage:o}=e;return(0,r.jsxs)("div",{className:"flex items-center justify-center gap-1",children:[(0,r.jsx)(j.z,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>a(t-1),disabled:0===t,children:(0,r.jsx)(Q.Z,{className:"h-4 w-4"})}),(0,r.jsxs)("span",{className:"text-sm font-medium text-muted-foreground",children:[t+1," / ",n]}),(0,r.jsx)(j.z,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>a(t+1),disabled:t>=n-1,children:(0,r.jsx)($.Z,{className:"h-4 w-4"})}),(0,r.jsx)(j.z,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:o,disabled:n>=20,children:(0,r.jsx)(ee.Z,{className:"h-4 w-4"})})]})};var eU=n(51777);let eH=eU.fC,e_=eU.xz,eW=a.forwardRef((e,t)=>{let{className:n,align:a="center",sideOffset:o=4,...s}=e;return(0,r.jsx)(eU.h_,{children:(0,r.jsx)(eU.VY,{ref:t,align:a,sideOffset:o,className:(0,y.cn)("z-[60000] w-auto rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n),...s})})});eW.displayName=eU.VY.displayName;var eK=n(77269),eq=n(81022),eJ=n(25567);let eV=["#FF6900","#FCB900","#7BDCB5","#00D084","#8ED1FC","#0693E3","#ABB8C3","#EB144C","#F78DA7","#9900EF"],eG={yellow:"#fffb8b",pink:"#ffc2d4",blue:"#bce8f1",green:"#d4edda",orange:"#ffeeba",purple:"#e9d5ff",white:"#ffffff"};var eY=n(40279),eX=n(17900),eQ=n(80659),e$=n(45736),e0=n(82762);let e1=[{name:"white",label:"Blanco",value:"#ffffff"},{name:"yellow",label:"Amarillo",value:"#fffb8b"},{name:"pink",label:"Rosa",value:"#ffc2d4"},{name:"blue",label:"Azul",value:"#bce8f1"},{name:"green",label:"Verde",value:"#d4edda"},{name:"orange",label:"Naranja",value:"#ffeeba"},{name:"purple",label:"Morado",value:"#e9d5ff"}];var e2=n(33145),e4=n(93529),e5=n(16859);function e3(e){let{tag:t,isEditing:n,onSave:o,onCancel:s}=e,[l,i]=(0,a.useState)(t),c=(0,a.useRef)(null);return((0,a.useEffect)(()=>{i(t),n&&c.current&&(c.current.focus(),c.current.select())},[t,n]),n)?(0,r.jsx)("div",{className:"absolute -top-10 left-0 z-30",onMouseDown:e=>e.stopPropagation(),children:(0,r.jsx)(eY.I,{ref:c,id:"floating-tag-input",name:"floating-tag-input",type:"text",value:l,onChange:e=>i(e.target.value),onKeyDown:e=>{"Enter"===e.key?o(l):"Escape"===e.key&&s()},onBlur:()=>{o(l)},className:"h-8 w-48 bg-black text-white border-primary placeholder:text-gray-400",placeholder:"A\xf1adir etiqueta..."})}):t?(0,r.jsx)("div",{className:"absolute -top-8 left-0 z-20 bg-black text-white text-xs rounded-md px-2 py-1 cursor-default pointer-events-none",children:(0,r.jsx)("p",{className:"break-words leading-tight",children:t})}):null}var e8=n(76618),e7=n.n(e8),e6=n(5820),e9=n(59022);let te=[{name:"white",label:"Blanco",value:"#ffffff"},{name:"yellow",label:"Amarillo",value:"#fffb8b"},{name:"pink",label:"Rosa",value:"#ffc2d4"},{name:"blue",label:"Azul",value:"#bce8f1"},{name:"green",label:"Verde",value:"#d4edda"},{name:"orange",label:"Naranja",value:"#ffeeba"},{name:"purple",label:"Morado",value:"#e9d5ff"}];var tt=n(98012),tn=n(47677),tr=n(23818),ta=n(13147);function to(e){return"object"==typeof e&&null!==e&&("text"in e||"content"in e)}var ts=n(46087),tl=n(20271);let ti=tl.fC,tc=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(tl.aV,{ref:t,className:(0,y.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",n),...a})});tc.displayName=tl.aV.displayName;let td=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(tl.xz,{ref:t,className:(0,y.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",n),...a})});td.displayName=tl.xz.displayName;let tu=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(tl.VY,{ref:t,className:(0,y.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",n),...a})});tu.displayName=tl.VY.displayName;var tp=n(13134);let tm=tp.fC,th=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(tp.ck,{ref:t,className:(0,y.cn)("border-b",n),...a})});th.displayName="AccordionItem";let tg=a.forwardRef((e,t)=>{let{className:n,children:a,...o}=e;return(0,r.jsx)(tp.h4,{className:"flex",children:(0,r.jsxs)(tp.xz,{ref:t,className:(0,y.cn)("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",n),...o,children:[a,(0,r.jsx)(T.Z,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})})});tg.displayName=tp.xz.displayName;let tf=a.forwardRef((e,t)=>{let{className:n,children:a,...o}=e;return(0,r.jsx)(tp.VY,{ref:t,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...o,children:(0,r.jsx)("div",{className:(0,y.cn)("pb-4 pt-0",n),children:a})})});function tx(e){let{value:t,onChange:n,isListening:o,liveTranscript:s,finalTranscript:l,interimTranscript:i}=e,[c,d]=(0,a.useState)(!1),u=(0,a.useRef)(null);return((0,a.useEffect)(()=>{if(c&&u.current){u.current.focus();let e=u.current.value.length;u.current.setSelectionRange(e,e)}},[c]),eZ({elementRef:u,isListening:o&&c||!1,liveTranscript:s||"",finalTranscript:l||"",interimTranscript:i||"",isSelected:c,enabled:c}),c)?(0,r.jsx)("input",{ref:u,type:"text",value:t,onChange:e=>n(e.target.value),onBlur:()=>d(!1),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),d(!1))},className:"flex-1 bg-transparent border-none outline-none font-medium text-sm",onClick:e=>e.stopPropagation(),onFocus:e=>{let t=e.target.value.length;e.target.setSelectionRange(t,t)}}):(0,r.jsx)("span",{onClick:e=>{e.stopPropagation(),d(!0)},className:"cursor-text text-sm",children:t||"Nuevo Item"})}function tv(e){let{value:t,onChange:o,isListening:s,liveTranscript:l,finalTranscript:i,interimTranscript:c,isSelected:d}=e,u=(0,a.useRef)(null),{handleBlur:p,handleChange:m}=ez({getContent:()=>{var e;return((null===(e=u.current)||void 0===e?void 0:e.innerHTML)||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim()},onSave:async e=>{e!==(t||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim()&&await o(e)},debounceMs:500,compareContent:(e,t)=>(e||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim()===(t||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim()}),h=(0,a.useRef)("");return(0,a.useEffect)(()=>{if(h.current!==t&&(h.current=t,u.current&&t!==u.current.innerHTML)){let e=document.activeElement===u.current,r=s&&(l||i||c);if(e||r)return;let{updateInnerHTMLPreservingCursor:a}=n(5690);a(u.current,t||"")}},[t,s,l,i,c]),eZ({elementRef:u,isListening:s||!1,liveTranscript:l||"",finalTranscript:i||"",interimTranscript:c||"",isSelected:d||!1,enabled:!0}),(0,r.jsx)("div",{ref:u,contentEditable:!0,onBlur:p,onInput:m,className:"min-h-[50px] p-2 border border-slate-200 rounded focus:outline-none focus:ring-2 focus:ring-primary/20 text-sm",dangerouslySetInnerHTML:{__html:t||""}})}tf.displayName=tp.VY.displayName;var tb=n(50471);let tw=e=>{let{currentPage:t,totalPages:n,onPageChange:a,onAddPage:o}=e;return(0,r.jsxs)("div",{className:"flex items-center justify-center gap-1",children:[(0,r.jsx)(j.z,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>a(t-1),disabled:0===t,children:(0,r.jsx)(Q.Z,{className:"h-4 w-4"})}),(0,r.jsxs)("span",{className:"text-sm font-medium text-muted-foreground",children:[t+1," / ",n]}),(0,r.jsx)(j.z,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>a(t+1),disabled:t>=n-1,children:(0,r.jsx)($.Z,{className:"h-4 w-4"})}),(0,r.jsx)(j.z,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:o,disabled:n>=20,children:(0,r.jsx)(ee.Z,{className:"h-4 w-4"})})]})};var ty=n(77101),tj=n(65265);let tN=[5,10,15,20,30,40,60],tC=[{name:"yellow",value:"#fffb8b",label:"Amarillo"},{name:"green",value:"#d4edda",label:"Verde"},{name:"blue",value:"#bce8f1",label:"Azul"},{name:"cyan",value:"#cae3e1",label:"Calipso"},{name:"orange",value:"#ffeeba",label:"Naranjo"},{name:"purple",value:"#e9d5ff",label:"Morado"}],tE={notepad:function(e){var t,o,s;let{id:l,content:i,properties:c,onUpdate:d,deleteElement:u,isPreview:p=!1,onFormatToggle:m,isListening:g,liveTranscript:f,finalTranscript:x,interimTranscript:v,isSelected:b,minimized:N,onChangeNotepadFormat:C,onEditElement:E}=e,k=i||{},z=(0,a.useRef)(null),T=(0,a.useRef)(null),{toast:S}=(0,h.pm)(),[D,I]=(0,a.useState)(!1),[P,M]=(0,a.useState)(!1),[F,A]=(0,a.useState)(!1),[B,L]=(0,a.useState)(!1),[Z,O]=(0,a.useState)(!1),U=null!==(s=k.currentPage)&&void 0!==s?s:0,H=(0,a.useRef)(k),_=(0,a.useRef)(U);(0,a.useEffect)(()=>{H.current=k,_.current=U},[k,U]);let{saveStatus:W,handleBlur:K,handleChange:q,forceSave:J}=ez({getContent:()=>p||!T.current?"":T.current.innerHTML.replace(/\s+/g," ").replace(/>\s+</g,"><").trim(),onSave:async e=>{if(p||!T.current)return;let t=H.current,n=_.current,r=t.pages||[""];if(e!==(r[n]||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim()){let a=[...r];a[n]=e,await d(l,{content:{...t,pages:a}})}},debounceMs:2e3,disabled:p,compareContent:(e,t)=>{let n=H.current,r=_.current,a=((n.pages||[""])[r]||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim(),o=(e||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim();return o===(t||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim()&&o===a}}),G=(0,a.useCallback)(async()=>{await J()},[J]),Q=(0,a.useRef)("");(0,a.useEffect)(()=>{if(T.current){let r=JSON.stringify(k.pages)+U;if(Q.current===r)return;Q.current=r;let a=document.activeElement===T.current;if(!a){var e,t;let r=null!==(t=null===(e=k.pages)||void 0===e?void 0:e[U])&&void 0!==t?t:"",o="<div><br></div>"===r||"<div></div>"===r||""===r.trim()?"":r;if(!a&&T.current.innerHTML!==o){let{updateInnerHTMLPreservingCursor:e}=n(5690);e(T.current,o)}}}},[k.pages,U]),eZ({elementRef:T,isListening:g||!1,liveTranscript:f||"",finalTranscript:x||"",interimTranscript:v||"",isSelected:b||!1,enabled:!0});let $=(0,a.useCallback)(()=>{p||E(l)},[p,E,l]),{handleBlur:ee}=ez({getContent:()=>{var e;return(null===(e=z.current)||void 0===e?void 0:e.innerText)||""},onSave:async e=>{if(p||!z.current)return;let t=H.current;t.title!==e&&d(l,{content:{...t,title:e}})},debounceMs:1e3,disabled:p}),eh=(0,a.useCallback)(async()=>{!p&&z.current&&await ee()},[p,ee]),eg=(0,a.useCallback)(e=>{e.preventDefault();let t=e.clipboardData.getData("text/plain");t&&document.execCommand("insertText",!1,t)},[]),ef=(0,a.useCallback)(e=>{var t;if(p)return;let n=H.current;e>=0&&e<((null===(t=n.pages)||void 0===t?void 0:t.length)||0)&&(G(),d(l,{content:{...n,currentPage:e}}))},[p,d,l,G]),eb=(0,a.useCallback)(()=>{var e;if(p)return;let t=H.current;if(20>((null===(e=t.pages)||void 0===e?void 0:e.length)||0)){G();let e=[...t.pages||[],""];d(l,{content:{...t,pages:e,currentPage:e.length-1}})}},[p,d,l,G]),ew=(0,a.useCallback)(e=>{e.stopPropagation(),e.preventDefault(),p||(G(),setTimeout(()=>{let e=!!N,t=(null==c?void 0:c.size)||{width:794,height:1021},n={width:"number"==typeof t.width?t.width:parseFloat(String(t.width))||794,height:"number"==typeof t.height?t.height:parseFloat(String(t.height))||1021};if(e){let{originalSize:e,...t}=c||{};d(l,{minimized:!1,properties:{...t,size:e||{width:794,height:1021}}})}else{let e="number"==typeof t.width?t.width:parseFloat(String(t.width))||794;d(l,{minimized:!0,properties:{...c,size:{width:e,height:48},originalSize:n}})}},100))},[p,N,c,d,l,G]),ey=(0,a.useCallback)(e=>{e.stopPropagation(),e.preventDefault(),p||(G(),d(l,{hidden:!0}))},[p,G,d,l]),eC=(0,a.useCallback)(async e=>{if(e.stopPropagation(),e.preventDefault(),!p)try{let e=document.querySelector('[data-element-id="'.concat(l,'"]'));if(!e){S({variant:"destructive",title:"Error",description:"No se pudo encontrar el elemento para exportar."});return}I(!0),S({title:"Exportando...",description:"Generando imagen PNG de alta resoluci\xf3n del cuaderno."}),(await w()(e,{backgroundColor:"#ffffff",scale:2.1,useCORS:!0,logging:!1,allowTaint:!1,windowWidth:e.scrollWidth,windowHeight:e.scrollHeight})).toBlob(e=>{if(!e){S({variant:"destructive",title:"Error",description:"No se pudo generar la imagen."}),I(!1);return}let t=URL.createObjectURL(e),n=document.createElement("a");n.href=t;let r=k.title||"cuaderno";n.download="".concat(r,"_").concat(Date.now(),".png"),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t),S({title:"Exportado",description:"El cuaderno se ha exportado como PNG de alta resoluci\xf3n."}),I(!1)},"image/png",1)}catch(e){console.error("Error al exportar cuaderno:",e),S({variant:"destructive",title:"Error",description:e.message||"No se pudo exportar el cuaderno."}),I(!1)}},[S,l,p,k.title]),eT=(0,a.useCallback)(async e=>{if(!p)try{M(!0),S({title:"Exportando...",description:"Generando PDF con ".concat(e.length," p\xe1gina").concat(e.length>1?"s":"",".")});let t=document.querySelector('[data-element-id="'.concat(l,'"]'));if(!t){S({variant:"destructive",title:"Error",description:"No se pudo encontrar el elemento para exportar."}),M(!1);return}let n=new eP.ZP({orientation:"portrait",unit:"px",format:[794,1021]}),r=k.currentPage||0;for(let a=0;a<e.length;a++){let o=e[a];d&&o!==r&&(d(l,{content:{...k,currentPage:o}}),await new Promise(e=>setTimeout(e,100)));let s=await w()(t,{backgroundColor:"#ffffff",scale:2,useCORS:!0,logging:!1,allowTaint:!1,windowWidth:t.scrollWidth,windowHeight:t.scrollHeight}),i=s.toDataURL("image/png");a>0&&n.addPage();let c=n.internal.pageSize.getWidth(),u=n.internal.pageSize.getHeight(),p=s.width,m=s.height,h=Math.min(c/p,u/m),g=p*h,f=m*h,x=(c-g)/2,v=(u-f)/2;n.addImage(i,"PNG",x,v,g,f)}d&&r!==k.currentPage&&d(l,{content:{...k,currentPage:r}});let a=k.title||"cuaderno";n.save("".concat(a,"_").concat(Date.now(),".pdf")),S({title:"Exportado",description:"PDF exportado con ".concat(e.length," p\xe1gina").concat(e.length>1?"s":"",".")}),M(!1)}catch(e){console.error("Error al exportar cuaderno a PDF:",e),S({variant:"destructive",title:"Error",description:e.message||"No se pudo exportar el cuaderno a PDF."}),M(!1)}},[S,l,p,k,d]);(0,a.useEffect)(()=>{let e=z.current;e&&e.innerText!==(k.title||"")&&(e.innerText=k.title||"")},[k.title]);let eS=(0,a.useCallback)((e,t,n)=>{e.preventDefault(),e.stopPropagation(),T.current&&(T.current.focus(),document.execCommand(t,!1,null!=n?n:void 0))},[]),eD=(0,a.useCallback)(e=>eS(e,"removeFormat"),[eS]),eR=(0,a.useCallback)(e=>eS(e,"insertHTML",'<span style="color: #a0a1a6;">-- '.concat((0,eE.WU)(new Date,"dd/MM/yy")," </span>")),[eS]),eM=(0,a.useCallback)(e=>{if(e.preventDefault(),e.stopPropagation(),T.current){T.current.focus();let e=document.createRange();e.selectNodeContents(T.current);let t=window.getSelection();t&&(t.removeAllRanges(),t.addRange(e))}},[]),eF=(0,a.useCallback)(()=>{u(l),O(!1)},[u,l]),eA="object"==typeof c&&null!==c?c:{},eL="10x15"===((null==eA?void 0:eA.format)||"letter");if(N)return(0,r.jsx)(V,{className:"notepad-card w-full h-full flex items-center shadow-lg rounded-lg bg-card border-2 border-primary/50 group","data-element-id":l,children:(0,r.jsxs)("div",{className:"p-2 flex flex-row items-center gap-1 w-full cursor-grab active:cursor-grabbing drag-handle",children:[(0,r.jsx)("div",{className:"p-1",children:(0,r.jsx)(et.Z,{className:"size-5 text-muted-foreground"})}),(0,r.jsx)("p",{className:"font-headline text-sm font-semibold truncate flex-grow",children:k.title||"Sin t\xedtulo"}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7",title:"Maximizar",onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),ew(e)},children:(0,r.jsx)(en.Z,{className:"size-4"})})]})});let eU="oyDN2LIr8z7VyYA5727F"===l||"FdQ656GJ94TePuHpotbY"===l||"Iz0UWQ5gQwXlkX1kGBf1"===l||"kRfKpBDg946Y99668Tih"===l?"#f8f0ad":"#ffffff",eH=(0,a.useCallback)(e=>{if(e.target.closest(".drag-handle"))return;let t=(null==eA?void 0:eA.zIndex)||1;d(l,{properties:{...eA,zIndex:9999}}),setTimeout(()=>{b||d(l,{properties:{...eA,zIndex:t}})},2e3)},[l,eA,d,b]);return(0,r.jsxs)(V,{"data-element-id":l,className:"notepad-card w-full h-full flex flex-col shadow-lg rounded-lg group",style:{backgroundColor:eU},onClick:eH,children:[(0,r.jsxs)("div",{className:"p-2 border-b flex flex-row items-center gap-1 cursor-grab active:cursor-grabbing drag-handle",children:[(0,r.jsx)("div",{className:"p-1",children:(0,r.jsx)(et.Z,{className:"size-5 text-muted-foreground"})}),(0,r.jsx)("div",{ref:z,contentEditable:!p,spellCheck:"true",suppressContentEditableWarning:!0,onFocus:$,onBlur:eh,className:"bg-transparent flex-grow outline-none cursor-text font-headline text-sm font-semibold p-1","data-placeholder":"T\xedtulo",onMouseDown:e=>e.stopPropagation()}),!p&&(0,r.jsxs)("div",{onMouseDown:e=>e.stopPropagation(),className:"flex items-center",children:[(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7",title:"Guardar",onClick:G,children:(0,r.jsx)(er.Z,{className:"size-4"})}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7",title:"Info",onClick:()=>L(!B),children:(0,r.jsx)(ea.Z,{className:"size-4"})}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7",title:"Seleccionar Todo",onClick:eM,children:(0,r.jsx)(eo.Z,{className:"size-4"})}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7",title:"Limpiar Formato",onClick:eD,children:(0,r.jsx)(es.Z,{className:"size-4"})}),m&&(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7",title:"Herramientas de Formato",onClick:m,children:(0,r.jsx)(el.Z,{className:"size-4"})}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7",title:"Insertar Fecha",onClick:eR,children:(0,r.jsx)(ei.Z,{className:"size-4"})}),(0,r.jsxs)(ex,{modal:!1,children:[(0,r.jsx)(ev,{asChild:!0,children:(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7",children:(0,r.jsx)(ec.Z,{className:"size-4"})})}),(0,r.jsxs)(ej,{children:[(0,r.jsxs)(eN,{onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),eC(e)},disabled:D,children:[(0,r.jsx)(ed.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:D?"Exportando...":"Exportar a PNG: alta resoluci\xf3n"})]}),(0,r.jsxs)(eN,{onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),A(!0)},disabled:P,children:[(0,r.jsx)(ed.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:P?"Exportando PDF...":"Exportar p\xe1ginas a PDF"})]}),C&&(0,r.jsxs)(eN,{onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),C(l)},children:[(0,r.jsx)(eu.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:"Cambiar formato..."})]})]})]}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7",title:N?"Maximizar":"Minimizar",onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),ew(e)},children:N?(0,r.jsx)(en.Z,{className:"size-4"}):(0,r.jsx)(ep.Z,{className:"size-4"})}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7 text-destructive hover:text-destructive",title:"Eliminar Cuaderno",onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),O(!0)},children:(0,r.jsx)(R.Z,{className:"size-4"})}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7",title:"Cerrar",onMouseDown:ey,children:(0,r.jsx)(em.Z,{className:"size-4"})})]})]}),!N&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Y,{className:(0,y.cn)("p-0 flex-grow relative font-body","overflow-y-auto"),style:{backgroundColor:"rzBhqCTd8wwZmD8JCNEk"===l?"#fafad7":eU},children:(0,r.jsxs)("div",{className:(0,y.cn)("notepad-content-container",eL&&"small-format",("oyDN2LIr8z7VyYA5727F"===l||"FdQ656GJ94TePuHpotbY"===l||"Iz0UWQ5gQwXlk1kGBf1"===l||"kRfKpBDg946Y99668Tih"===l||"EktERYKT8kyk3JWymwbu"===l||"rzBhqCTd8wwZmD8JCNEk"===l)&&"small-typography"),"data-element-id":l,children:[(0,r.jsx)("div",{className:(0,y.cn)("notepad-lines-background",eL&&"small-format",("oyDN2LIr8z7VyYA5727F"===l||"FdQ656GJ94TePuHpotbY"===l||"Iz0UWQ5gQwXlk1kGBf1"===l||"kRfKpBDg946Y99668Tih"===l||"EktERYKT8kyk3JWymwbu"===l||"rzBhqCTd8wwZmD8JCNEk"===l)&&"small-typography"),"data-element-id":l}),!p&&(0,r.jsx)("div",{className:"absolute w-1 h-1 bg-red-500 rounded-full",style:{left:eL?"18px":"38px",top:eL?"calc(100% - 30px)":"calc(100% - 48px)"},title:"Indicador de fin de p\xe1gina visible"}),B&&(0,r.jsxs)("div",{className:"absolute inset-0 bg-white/95 z-20 p-4 text-xs overflow-y-auto",onClick:()=>L(!1),children:[(0,r.jsx)("h3",{className:"font-bold mb-2 text-base",children:"Comandos de Dictado por Voz"}),(0,r.jsx)("p",{children:"WIP"}),(0,r.jsx)("p",{className:"text-center mt-4 text-gray-500",children:"Haz clic en cualquier lugar para cerrar"})]}),(0,r.jsx)("div",{ref:T,contentEditable:!p,spellCheck:"true",suppressContentEditableWarning:!0,onPaste:eg,onFocus:()=>E(l),onInput:q,onBlur:K,className:(0,y.cn)("notepad-content-editable",eL&&"small-format",("oyDN2LIr8z7VyYA5727F"===l||"FdQ656GJ94TePuHpotbY"===l||"Iz0UWQ5gQwXlk1kGBf1"===l||"kRfKpBDg946Y99668Tih"===l||"EktERYKT8kyk3JWymwbu"===l||"rzBhqCTd8wwZmD8JCNEk"===l)&&"small-typography","kRfKpBDg946Y99668Tih"===l&&"infinite-scroll",!eL&&"p-[32px_24px_16px_0px]",eL&&"p-[16px_12px_8px_0px]"),"data-element-id":l}),!p&&(0,r.jsx)("div",{className:"absolute top-2 right-2 z-20",children:(0,r.jsx)(eI,{status:W,size:"sm"})})]})}),!p&&(0,r.jsx)(X,{className:"p-2 border-t justify-center",onMouseDown:e=>e.stopPropagation(),children:(0,r.jsx)(eO,{currentPage:U,totalPages:(null===(t=k.pages)||void 0===t?void 0:t.length)||1,onPageChange:ef,onAddPage:eb})})]}),(0,r.jsx)(ek,{isOpen:Z,onOpenChange:O,onConfirm:eF}),(0,r.jsx)(eB,{isOpen:F,onOpenChange:A,totalPages:(null===(o=k.pages)||void 0===o?void 0:o.length)||1,onExport:eT})]})},"notepad-simple":function(e){let{id:t,content:n,onUpdate:o,onEditElement:s,deleteElement:l,isListening:i,liveTranscript:c,finalTranscript:d,interimTranscript:u,isSelected:p}=e,m=(0,a.useRef)(null),h=(0,a.useRef)(null),g=(0,a.useRef)(null),[f,x]=(0,a.useState)(""),v="string"==typeof n?n:to(n)&&(n.text||n.content)||"",b=to(n)&&n.title||"Nuevo Notepad",{saveStatus:w,handleBlur:N,handleChange:C}=ez({getContent:()=>{var e;return(null===(e=m.current)||void 0===e?void 0:e.value)||""},onSave:async e=>{e!==v&&o(t,{content:{...to(n)?n:{},text:e,content:e}})},debounceMs:2e3,compareContent:(e,t)=>e===t}),{saveStatus:E,handleBlur:k,handleChange:z}=ez({getContent:()=>{var e;return(null===(e=h.current)||void 0===e?void 0:e.value)||b},onSave:async e=>{e!==b&&o(t,{content:{...to(n)?n:{},title:e}})},debounceMs:1e3,compareContent:(e,t)=>e===t}),T=async()=>{await N()},S=(0,a.useRef)({lastInsertedText:"",lastFinalText:""});(0,a.useEffect)(()=>{if(!i||!p){i||(S.current={lastInsertedText:"",lastFinalText:""});return}(d||u)&&m.current&&document.activeElement===m.current&&((0,eL.insertDictationTextToInput)(m.current,c||"",d||"",S.current),C())},[i,c,d,u,p,C]),(0,a.useEffect)(()=>{let e=m.current;if(!e)return;let t=()=>{let{scrollTop:t,scrollHeight:n,clientHeight:r}=e;n-t-r<100&&(e.style.minHeight="".concat(n+500,"px"))};return e.addEventListener("scroll",t),()=>e.removeEventListener("scroll",t)},[]);let D=()=>{if(m.current){let e=(0,eE.WU)(new Date,"dd/MM/yy"),t=m.current.selectionStart||m.current.value.length,n=m.current.value.substring(0,t),r=m.current.value.substring(t);m.current.value=n+e+" "+r,m.current.setSelectionRange(t+e.length+1,t+e.length+1),C(),m.current.focus()}},I=()=>{l&&l(t)};return(0,r.jsxs)("div",{ref:g,className:(0,y.cn)("w-full h-full flex flex-col rounded-lg shadow-lg overflow-hidden drag-handle","cursor-grab active:cursor-grabbing"),style:{backgroundColor:"#ffff00"},onClick:()=>s(t),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 border-b border-gray-300 bg-white flex-shrink-0",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,r.jsx)("div",{className:"drag-handle cursor-grab active:cursor-grabbing flex-shrink-0",children:(0,r.jsx)("div",{className:"grid grid-cols-3 gap-0.5 w-4 h-4",children:Array.from({length:9}).map((e,t)=>(0,r.jsx)("div",{className:"w-1 h-1 bg-gray-700 rounded-full"},t))})}),(0,r.jsx)("input",{ref:h,type:"text",value:b,onChange:e=>{o(t,{content:{...to(n)?n:{},title:e.target.value}}),z()},onBlur:k,className:"text-sm font-semibold text-gray-800 bg-transparent border-none outline-none flex-1 min-w-0 px-2",placeholder:"Nuevo Notepad",onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),style:{fontFamily:"inherit"}}),(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsx)(eI,{status:E,size:"sm"})})]}),(0,r.jsx)("div",{className:"flex items-center gap-2 mx-4 flex-shrink-0",children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(tr.Z,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-500 pointer-events-none"}),(0,r.jsx)("input",{type:"text",value:f,onChange:e=>x(e.target.value),placeholder:"Buscar...",className:"pl-8 pr-2 py-1 text-xs border border-gray-300 rounded bg-white text-gray-700 placeholder-gray-400 outline-none focus:ring-1 focus:ring-blue-500",onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),style:{width:"120px"}})]})}),(0,r.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0",children:[(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-7 w-7 hover:bg-gray-100",onClick:e=>{e.stopPropagation(),D()},title:"Insertar Fecha",children:(0,r.jsx)(ta.Z,{className:"h-4 w-4 text-gray-700"})}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-7 w-7 hover:bg-red-50 text-red-600 hover:text-red-700",onClick:e=>{e.stopPropagation(),I()},title:"Eliminar",children:(0,r.jsx)(R.Z,{className:"h-4 w-4"})}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-7 w-7 hover:bg-gray-100",onClick:e=>{e.stopPropagation()},title:"Cerrar",children:(0,r.jsx)(em.Z,{className:"h-4 w-4 text-gray-700"})})]})]}),(0,r.jsxs)("div",{className:"flex-1 relative overflow-hidden",style:{backgroundColor:"#ffff00"},children:[(0,r.jsx)("div",{className:"absolute inset-0 pointer-events-none z-0",style:{backgroundImage:"linear-gradient(#3b82f6 1px, transparent 1px)",backgroundSize:"100% 24px",backgroundPosition:"0 60px"}}),(0,r.jsx)("div",{className:"absolute top-0 bottom-0 pointer-events-none z-0",style:{left:"50px",width:"1px",backgroundColor:"#fca5a5",top:"60px"}}),(0,r.jsx)("textarea",{ref:m,value:v,onChange:e=>{C()},onBlur:T,className:"absolute inset-0 w-full h-full bg-transparent text-sm resize-none outline-none z-10 font-mono",style:{paddingLeft:"70px",paddingTop:"60px",paddingRight:"16px",paddingBottom:"16px",lineHeight:"24px",fontSize:"14px",color:"#1e293b",fontFamily:"monospace",whiteSpace:"pre-wrap",wordWrap:"break-word",minHeight:"100%"},placeholder:"Escribe aqu\xed...",onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation()}),(0,r.jsx)("div",{className:"absolute top-2 right-2 z-20",children:(0,r.jsx)(eI,{status:w,size:"sm"})})]})]})},"test-notepad":function(e){var t,n,o;let{id:s,content:l,properties:i,onUpdate:c,deleteElement:d,isPreview:u=!1,onFormatToggle:p,isListening:m,liveTranscript:g,isSelected:f,minimized:x,onChangeNotepadFormat:v,onEditElement:b}=e,N=l||{},C=(0,a.useRef)(null),E=(0,a.useRef)(null),{toast:k}=(0,h.pm)(),[z,T]=(0,a.useState)(!1),[S,D]=(0,a.useState)(!1),[I,P]=(0,a.useState)(!1),[M,F]=(0,a.useState)(!1),[A,B]=(0,a.useState)(!1),L=null!==(o=N.currentPage)&&void 0!==o?o:0,{saveStatus:Z,handleBlur:O,handleChange:U,forceSave:H}=ez({getContent:()=>u||!E.current?"":E.current.innerHTML,onSave:async e=>{if(u||!E.current)return;let t=N.pages||[""];if(e!==(t[L]||"")){let n=[...t];n[L]=e,c(s,{content:{...N,pages:n}})}},debounceMs:2e3,disabled:u,compareContent:(e,t)=>e===((N.pages||[""])[L]||"")}),_=(0,a.useCallback)(async()=>{await H()},[H]);(0,a.useEffect)(()=>{if(E.current&&document.activeElement!==E.current){var e,t;let n=null!==(t=null===(e=N.pages)||void 0===e?void 0:e[L])&&void 0!==t?t:"<div><br></div>";E.current.innerHTML!==n&&(E.current.innerHTML=n)}},[N.pages,L]),(0,a.useEffect)(()=>{m&&f&&E.current&&document.activeElement===E.current&&document.execCommand("insertText",!1,g)},[m,g,f]);let W=(0,a.useCallback)(()=>{u||b(s)},[u,b,s]),{handleBlur:K}=ez({getContent:()=>{var e;return(null===(e=C.current)||void 0===e?void 0:e.innerText)||""},onSave:async e=>{!u&&C.current&&N.title!==e&&c(s,{content:{...N,title:e}})},debounceMs:1e3,disabled:u}),q=(0,a.useCallback)(async()=>{!u&&C.current&&await K()},[u,K]),J=(0,a.useCallback)(e=>{e.preventDefault();let t=e.clipboardData.getData("text/plain");t&&document.execCommand("insertText",!1,t)},[]),G=(0,a.useCallback)(e=>{var t;!u&&e>=0&&e<((null===(t=N.pages)||void 0===t?void 0:t.length)||0)&&(_(),c(s,{content:{...N,currentPage:e}}))},[u,N,c,s,_]),Q=(0,a.useCallback)(()=>{var e;if(!u&&20>((null===(e=N.pages)||void 0===e?void 0:e.length)||0)){_();let e=[...N.pages||[],"<div><br></div>"];c(s,{content:{...N,pages:e,currentPage:e.length-1}})}},[u,N,c,s,_]),$=(0,a.useCallback)(e=>{e.stopPropagation(),e.preventDefault(),u||(_(),setTimeout(()=>{let e=!!x,t=(null==i?void 0:i.size)||{width:794,height:1021},n={width:"number"==typeof t.width?t.width:parseFloat(String(t.width))||794,height:"number"==typeof t.height?t.height:parseFloat(String(t.height))||1021};if(e){let{originalSize:e,...t}=i||{};c(s,{minimized:!1,properties:{...t,size:e||{width:794,height:1021}}})}else{let e="number"==typeof t.width?t.width:parseFloat(String(t.width))||794;c(s,{minimized:!0,properties:{...i,size:{width:e,height:48},originalSize:n}})}},100))},[u,x,i,c,s,_]),ee=(0,a.useCallback)(e=>{e.stopPropagation(),e.preventDefault(),u||(_(),c(s,{hidden:!0}))},[u,_,c,s]),eh=(0,a.useCallback)(async e=>{if(e.stopPropagation(),e.preventDefault(),!u)try{let e=document.querySelector('[data-element-id="'.concat(s,'"]'));if(!e){k({variant:"destructive",title:"Error",description:"No se pudo encontrar el elemento para exportar."});return}T(!0),k({title:"Exportando...",description:"Generando imagen PNG de alta resoluci\xf3n del cuaderno."}),(await w()(e,{backgroundColor:"#ffffff",scale:3,useCORS:!0,logging:!1,allowTaint:!1,windowWidth:e.scrollWidth,windowHeight:e.scrollHeight})).toBlob(e=>{if(!e){k({variant:"destructive",title:"Error",description:"No se pudo generar la imagen."}),T(!1);return}let t=URL.createObjectURL(e),n=document.createElement("a");n.href=t;let r=N.title||"cuaderno-test";n.download="".concat(r,"_").concat(Date.now(),".png"),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t),k({title:"Exportado",description:"El cuaderno se ha exportado como PNG de alta resoluci\xf3n."}),T(!1)},"image/png",1)}catch(e){console.error("Error al exportar cuaderno:",e),k({variant:"destructive",title:"Error",description:e.message||"No se pudo exportar el cuaderno."}),T(!1)}},[k,s,u,N.title]),eg=(0,a.useCallback)(async e=>{if(!u)try{D(!0),k({title:"Exportando...",description:"Generando PDF con ".concat(e.length," p\xe1gina").concat(e.length>1?"s":"",".")});let t=document.querySelector('[data-element-id="'.concat(s,'"]'));if(!t){k({variant:"destructive",title:"Error",description:"No se pudo encontrar el elemento para exportar."}),D(!1);return}let n=new eP.ZP({orientation:"portrait",unit:"px",format:[794,1021]}),r=N.currentPage||0;for(let a=0;a<e.length;a++){let o=e[a];c&&o!==r&&(c(s,{content:{...N,currentPage:o}}),await new Promise(e=>setTimeout(e,100)));let l=await w()(t,{backgroundColor:"#ffffff",scale:2,useCORS:!0,logging:!1,allowTaint:!1,windowWidth:t.scrollWidth,windowHeight:t.scrollHeight}),i=l.toDataURL("image/png");a>0&&n.addPage();let d=n.internal.pageSize.getWidth(),u=n.internal.pageSize.getHeight(),p=l.width,m=l.height,h=Math.min(d/p,u/m),g=p*h,f=m*h,x=(d-g)/2,v=(u-f)/2;n.addImage(i,"PNG",x,v,g,f)}c&&r!==N.currentPage&&c(s,{content:{...N,currentPage:r}});let a=N.title||"cuaderno-test";n.save("".concat(a,"_").concat(Date.now(),".pdf")),k({title:"Exportado",description:"PDF exportado con ".concat(e.length," p\xe1gina").concat(e.length>1?"s":"",".")}),D(!1)}catch(e){console.error("Error al exportar cuaderno a PDF:",e),k({variant:"destructive",title:"Error",description:e.message||"No se pudo exportar el cuaderno a PDF."}),D(!1)}},[k,s,u,N,c]);(0,a.useEffect)(()=>{let e=C.current;e&&e.innerText!==(N.title||"")&&(e.innerText=N.title||"")},[N.title]);let ef=(0,a.useCallback)((e,t,n)=>{e.preventDefault(),e.stopPropagation(),E.current&&(E.current.focus(),document.execCommand(t,!1,null!=n?n:void 0))},[]),eb=(0,a.useCallback)(e=>ef(e,"removeFormat"),[ef]),ew=(0,a.useCallback)(e=>ef(e,"insertHTML",'<span style="color: #a0a1a6;">-- '.concat((0,eE.WU)(new Date,"dd/MM/yy")," </span>")),[ef]),ey=(0,a.useCallback)(e=>{if(e.preventDefault(),e.stopPropagation(),E.current){E.current.focus();let e=document.createRange();e.selectNodeContents(E.current);let t=window.getSelection();t&&(t.removeAllRanges(),t.addRange(e))}},[]),eC=(0,a.useCallback)(()=>{d(s),B(!1)},[d,s]),eT="object"==typeof i&&null!==i?i:{},eS="10x15"===((null==eT?void 0:eT.format)||"letter");return x?(0,r.jsx)(V,{className:"notepad-card w-full h-full flex items-center shadow-lg rounded-lg bg-card border-2 border-primary/50 group","data-element-id":s,children:(0,r.jsxs)("div",{className:"p-2 flex flex-row items-center gap-1 w-full cursor-grab active:cursor-grabbing drag-handle",children:[(0,r.jsx)("div",{className:"p-1",children:(0,r.jsx)(et.Z,{className:"size-5 text-muted-foreground"})}),(0,r.jsx)("p",{className:"font-headline text-sm font-semibold truncate flex-grow",children:N.title||"Cuaderno Test"}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7",title:"Maximizar",onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),$(e)},children:(0,r.jsx)(en.Z,{className:"size-4"})})]})}):(0,r.jsxs)(V,{"data-element-id":s,className:"notepad-card w-full h-full flex flex-col shadow-lg rounded-lg bg-card group",children:[(0,r.jsxs)("div",{className:"p-2 border-b flex flex-row items-center gap-1 cursor-grab active:cursor-grabbing drag-handle",children:[(0,r.jsx)("div",{className:"p-1",children:(0,r.jsx)(et.Z,{className:"size-5 text-muted-foreground"})}),(0,r.jsx)("div",{ref:C,contentEditable:!u,spellCheck:"true",suppressContentEditableWarning:!0,onFocus:W,onBlur:q,className:"bg-transparent flex-grow outline-none cursor-text font-headline text-sm font-semibold p-1","data-placeholder":"Cuaderno Test",onMouseDown:e=>e.stopPropagation()}),!u&&(0,r.jsxs)("div",{onMouseDown:e=>e.stopPropagation(),className:"flex items-center",children:[(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7",title:"Guardar",onClick:_,children:(0,r.jsx)(er.Z,{className:"size-4"})}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7",title:"Info",onClick:()=>F(!M),children:(0,r.jsx)(ea.Z,{className:"size-4"})}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7",title:"Seleccionar Todo",onClick:ey,children:(0,r.jsx)(eo.Z,{className:"size-4"})}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7",title:"Limpiar Formato",onClick:eb,children:(0,r.jsx)(es.Z,{className:"size-4"})}),p&&(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7",title:"Herramientas de Formato",onClick:p,children:(0,r.jsx)(el.Z,{className:"size-4"})}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7",title:"Insertar Fecha",onClick:ew,children:(0,r.jsx)(ei.Z,{className:"size-4"})}),(0,r.jsxs)(ex,{modal:!1,children:[(0,r.jsx)(ev,{asChild:!0,children:(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7",children:(0,r.jsx)(ec.Z,{className:"size-4"})})}),(0,r.jsxs)(ej,{children:[(0,r.jsxs)(eN,{onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),eh(e)},disabled:z,children:[(0,r.jsx)(ed.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:z?"Exportando...":"Exportar a PNG: alta resoluci\xf3n"})]}),(0,r.jsxs)(eN,{onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),P(!0)},disabled:S,children:[(0,r.jsx)(ed.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:S?"Exportando PDF...":"Exportar p\xe1ginas a PDF"})]}),v&&(0,r.jsxs)(eN,{onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),v(s)},children:[(0,r.jsx)(eu.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:"Cambiar formato..."})]})]})]}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7",title:x?"Maximizar":"Minimizar",onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),$(e)},children:x?(0,r.jsx)(en.Z,{className:"size-4"}):(0,r.jsx)(ep.Z,{className:"size-4"})}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7 text-destructive hover:text-destructive",title:"Eliminar Cuaderno",onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),B(!0)},children:(0,r.jsx)(R.Z,{className:"size-4"})}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7",title:"Cerrar",onMouseDown:ee,children:(0,r.jsx)(em.Z,{className:"size-4"})})]})]}),!x&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Y,{className:"p-0 flex-grow relative bg-card font-body overflow-y-auto",children:(0,r.jsxs)("div",{className:(0,y.cn)("notepad-content-container",eS&&"small-format"),children:[(0,r.jsx)("div",{className:(0,y.cn)("notepad-lines-background",eS&&"small-format")}),!u&&(0,r.jsx)("div",{className:"absolute w-1 h-1 bg-red-500 rounded-full",style:{left:eS?"18px":"38px",top:eS?"calc(100% - 30px)":"calc(100% - 48px)"},title:"Indicador de fin de p\xe1gina visible"}),M&&(0,r.jsxs)("div",{className:"absolute inset-0 bg-white/95 z-20 p-4 text-xs overflow-y-auto",onClick:()=>F(!1),children:[(0,r.jsx)("h3",{className:"font-bold mb-2 text-base",children:"Comandos de Dictado por Voz"}),(0,r.jsx)("p",{children:"WIP"}),(0,r.jsx)("p",{className:"text-center mt-4 text-gray-500",children:"Haz clic en cualquier lugar para cerrar"})]}),(0,r.jsx)("div",{ref:E,contentEditable:!u,spellCheck:"true",suppressContentEditableWarning:!0,onPaste:J,onFocus:()=>b(s),onInput:U,onBlur:O,className:(0,y.cn)("notepad-content-editable",eS&&"small-format",!eS&&"p-[32px_24px_16px_0px]",eS&&"p-[16px_12px_8px_0px]")}),!u&&(0,r.jsx)("div",{className:"absolute top-2 right-2 z-20",children:(0,r.jsx)(eI,{status:Z,size:"sm"})})]})}),!u&&(0,r.jsx)(X,{className:"p-2 border-t justify-center",onMouseDown:e=>e.stopPropagation(),children:(0,r.jsx)(tw,{currentPage:L,totalPages:(null===(t=N.pages)||void 0===t?void 0:t.length)||1,onPageChange:G,onAddPage:Q})})]}),(0,r.jsx)(ek,{isOpen:A,onOpenChange:B,onConfirm:eC}),(0,r.jsx)(eB,{isOpen:I,onOpenChange:P,totalPages:(null===(n=N.pages)||void 0===n?void 0:n.length)||1,onExport:eg})]})},sticky:function(e){let{id:t,content:o,properties:s,isSelected:l,onUpdate:i,onEditElement:c,deleteElement:d,isListening:u,liveTranscript:p,finalTranscript:m,interimTranscript:h}=e,g="object"==typeof s&&null!==s?s:{},f=("string"==typeof g.color?g.color:"yellow")||"yellow",x=eG[f]||(f.startsWith("#")?f:"#fffb8b"),v=g.rotation||0,b=(0,a.useRef)(null),w="string"==typeof o?o:"",{saveStatus:N,handleBlur:C,handleChange:E}=ez({getContent:()=>{var e;return((null===(e=b.current)||void 0===e?void 0:e.innerHTML)||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim()},onSave:async e=>{e!==(w||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim()&&await i(t,{content:e})},debounceMs:2e3,compareContent:(e,t)=>(e||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim()===(t||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim()}),k=(0,a.useRef)("");(0,a.useEffect)(()=>{if(b.current){let e=document.activeElement===b.current;if(k.current!==w&&(k.current=w,!e)){let{updateInnerHTMLPreservingCursor:e}=n(5690),t=/<[^>]+>/.test(w);e(b.current,t?w:w||"")}}},[w]),eZ({elementRef:b,isListening:u||!1,liveTranscript:p||"",finalTranscript:m||"",interimTranscript:h||"",isSelected:l||!1,enabled:!0});let z=async()=>{await C()};return(0,r.jsxs)(V,{className:(0,y.cn)("w-full h-full flex flex-col relative group overflow-hidden","min-w-[200px] min-h-[150px] max-w-[400px] max-h-[500px]","rounded-lg shadow-md border-none"),style:{backgroundColor:x},onClick:()=>c(t),children:[(0,r.jsxs)("div",{className:"absolute top-2 right-2 flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity z-10",children:[(0,r.jsx)("div",{className:"drag-handle cursor-grab active:cursor-grabbing p-1 hover:bg-black/10 rounded",children:(0,r.jsx)(et.Z,{className:"h-4 w-4 text-gray-700"})}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-6 w-6 p-1 hover:bg-black/10 rounded",onClick:e=>{if(e.stopPropagation(),b.current){b.current.focus();let e=window.getSelection();if(e&&e.rangeCount>0){let t=e.getRangeAt(0);t.collapse(!1);let n=document.createElement("br");t.insertNode(n),t.setStartAfter(n),t.collapse(!0),e.removeAllRanges(),e.addRange(t)}}},onMouseDown:e=>e.stopPropagation(),children:(0,r.jsx)(ee.Z,{className:"h-4 w-4 text-gray-700"})}),l&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(eH,{children:[(0,r.jsx)(e_,{asChild:!0,children:(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-6 w-6 p-1 hover:bg-black/10 rounded",onClick:e=>e.stopPropagation(),children:(0,r.jsx)(eq.Z,{className:"h-4 w-4 text-gray-700"})})}),(0,r.jsx)(eW,{onClick:e=>e.stopPropagation(),className:"w-auto p-0 border-none",children:(0,r.jsx)(eK.e8,{colors:eV,color:x,onChangeComplete:e=>{i(t,{properties:{...g,color:e.hex}})}})})]}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-6 w-6 p-1 hover:bg-black/10 rounded",onClick:e=>{e.stopPropagation(),i(t,{properties:{...g,rotation:((v||0)+15)%360}})},onMouseDown:e=>e.stopPropagation(),title:"Rotar 15\xb0",children:(0,r.jsx)(eJ.Z,{className:"h-4 w-4 text-gray-700"})})]}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-6 w-6 p-1 hover:bg-black/10 rounded",onClick:e=>{e.stopPropagation(),e.preventDefault(),d&&d(t)},onMouseDown:e=>e.stopPropagation(),children:(0,r.jsx)(em.Z,{className:"h-4 w-4 text-gray-700"})})]}),(0,r.jsxs)("div",{className:"relative flex-grow",children:[(0,r.jsx)("div",{ref:b,contentEditable:!0,suppressContentEditableWarning:!0,onInput:()=>{E()},onBlur:z,className:"text-base font-medium break-words outline-none cursor-text p-4 pt-6",style:{color:"#333",minHeight:"calc(100% - 1rem)"}}),(0,r.jsx)("div",{className:"absolute top-2 right-2 z-10",children:(0,r.jsx)(eI,{status:N,size:"sm"})})]})]})},todo:function(e){let{id:t,content:n,properties:o,onUpdate:s,onEditElement:l,isSelected:i,deleteElement:c,onLocateElement:d,onEditComment:u,isListening:p,liveTranscript:m,finalTranscript:g,interimTranscript:f}=e,{toast:x}=(0,h.pm)(),v=(0,a.useRef)(null),[b,N]=(0,a.useState)(""),[C,E]=(0,a.useState)(!1),k="object"==typeof o&&null!==o?o:{},z=k.backgroundColor||"#ffffff",T="object"==typeof n&&null!==n&&"items"in n?n:{title:"Lista de Tareas",items:[]},{title:S,items:D}=T,{saveStatus:I,handleChange:P}=ez({getContent:()=>T,onSave:async e=>{JSON.stringify(T)!==JSON.stringify(e)&&s(t,{content:e})},debounceMs:2e3,compareContent:(e,t)=>JSON.stringify(e)===JSON.stringify(t)}),M=e=>{let n=[...D];n[e]={...n[e],completed:!n[e].completed},s(t,{content:{...T,items:n}}),P()},F=(e,n)=>{let r=[...D];r[e]={...r[e],text:n},s(t,{content:{...T,items:r}}),P()},A=()=>{if(""!==b.trim()){let e=[...D,{id:"item-".concat(Date.now()),text:b,completed:!1}];s(t,{content:{...T,items:e}}),N(""),P()}},B=e=>{let n=D.filter((t,n)=>n!==e);s(t,{content:{...T,items:n}}),P()},L=e=>{s(t,{properties:{...k,backgroundColor:e}}),E(!1)},Z=async()=>{try{let e="*".concat(S||"Lista de Tareas","*\n\n");D.forEach(t=>{t.completed?e+="✅ ".concat(t.text,"\n"):e+="⬜ ".concat(t.text,"\n")}),await navigator.clipboard.writeText(e),x({title:"Lista copiada",description:"La lista se ha copiado al portapapeles."})}catch(e){console.error("Error al copiar:",e),x({variant:"destructive",title:"Error",description:"No se pudo copiar la lista."})}},O=async()=>{try{if(!v.current){x({variant:"destructive",title:"Error",description:"No se pudo capturar el elemento."});return}x({title:"Exportando...",description:"Generando imagen PNG de la lista."}),(await w()(v.current,{scale:2.1,backgroundColor:z,useCORS:!0,logging:!1,allowTaint:!1})).toBlob(e=>{if(!e){x({variant:"destructive",title:"Error",description:"No se pudo generar la imagen."});return}let t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="".concat(S||"lista",".png"),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t),x({title:"Exportado",description:"La lista se ha exportado como PNG."})},"image/png")}catch(e){console.error("Error al exportar:",e),x({variant:"destructive",title:"Error",description:e.message||"No se pudo exportar la lista."})}},U=(0,a.useRef)({lastInsertedText:"",lastFinalText:""});return(0,a.useEffect)(()=>{if(!p||!i){p||(U.current={lastInsertedText:"",lastFinalText:""});return}if(!g&&!f)return;let e=document.activeElement;e&&("INPUT"===e.tagName||"TEXTAREA"===e.tagName)&&v.current&&v.current.contains(e)&&(0,eL.insertDictationTextToInput)(e,m||"",g||"",U.current)},[p,m,g,f,i]),(0,r.jsxs)(V,{ref:v,className:(0,y.cn)("w-full h-full flex flex-col relative group overflow-hidden","min-w-[200px] min-h-[150px]","rounded-lg shadow-md border-none"),style:{backgroundColor:"#ffffff"},onClick:()=>l(t),children:[(0,r.jsx)("div",{className:"absolute top-2 right-2 z-10",children:(0,r.jsx)(eI,{status:I,size:"sm"})}),(0,r.jsx)(G,{className:"p-2 pb-2 border-b border-gray-200/50",style:{backgroundColor:z},children:(0,r.jsxs)("div",{className:"flex items-center justify-between gap-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1 flex-1 min-w-0",children:[(0,r.jsx)("div",{className:"drag-handle cursor-grab active:cursor-grabbing flex-shrink-0",children:(0,r.jsx)(et.Z,{className:"h-3 w-3 text-gray-400"})}),(0,r.jsx)(eY.I,{type:"text",value:S||"",onChange:e=>{s(t,{content:{...T,title:e.target.value}}),P()},className:"text-sm font-semibold border-none shadow-none focus-visible:ring-0 p-1 bg-transparent flex-1 min-w-0",placeholder:"T\xedtulo...",onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation()})]}),(0,r.jsxs)("div",{className:"flex items-center gap-0.5 flex-shrink-0",children:[(0,r.jsxs)(eH,{open:C,onOpenChange:E,children:[(0,r.jsx)(e_,{asChild:!0,children:(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:e=>{e.stopPropagation(),E(!0)},title:"Cambiar color del header",children:(0,r.jsx)(eX.Z,{className:"h-3 w-3"})})}),(0,r.jsx)(eW,{className:"w-auto p-2",onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),children:(0,r.jsx)("div",{className:"grid grid-cols-4 gap-1.5",children:e1.map(e=>(0,r.jsx)("button",{className:(0,y.cn)("w-6 h-6 rounded-full border-2 transition-all hover:scale-110",z===e.value?"border-gray-800 scale-110":"border-gray-300"),style:{backgroundColor:e.value},onClick:t=>{t.stopPropagation(),L(e.value)},title:"".concat(e.label," - Aplicar al header")},e.name))})})]}),(0,r.jsxs)(ex,{children:[(0,r.jsx)(ev,{asChild:!0,children:(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:e=>e.stopPropagation(),title:"M\xe1s opciones - Copiar, exportar o eliminar lista",children:(0,r.jsx)(ec.Z,{className:"h-3 w-3"})})}),(0,r.jsxs)(ej,{align:"end",onClick:e=>e.stopPropagation(),className:"text-sm",children:[(0,r.jsxs)(eN,{onClick:Z,className:"text-sm",title:"Copia la lista completa al portapapeles en formato texto",children:[(0,r.jsx)(eQ.Z,{className:"mr-2 h-3 w-3"}),(0,r.jsx)("span",{children:"Copiar lista como texto"})]}),(0,r.jsxs)(eN,{onClick:O,className:"text-sm",title:"Exporta la lista como imagen PNG de alta resoluci\xf3n (reducida 30%)",children:[(0,r.jsx)(e$.Z,{className:"mr-2 h-3 w-3"}),(0,r.jsx)("span",{children:"Exportar a PNG: alta resoluci\xf3n"})]}),(0,r.jsx)(eC,{}),(0,r.jsxs)(eN,{onClick:()=>{c&&c(t)},className:"text-sm text-destructive focus:text-destructive",children:[(0,r.jsx)(R.Z,{className:"mr-2 h-3 w-3"}),(0,r.jsx)("span",{children:"Eliminar Lista"})]})]})]})]})]})}),(0,r.jsx)(Y,{className:"flex-grow overflow-y-auto p-2",children:(0,r.jsx)(e0.Z5,{onDragEnd:e=>{if(!e.destination)return;let n=Array.from(D),[r]=n.splice(e.source.index,1);n.splice(e.destination.index,0,r),s(t,{content:{...T,items:n}}),P()},children:(0,r.jsx)(e0.bK,{droppableId:"droppable-".concat(t),children:e=>(0,r.jsxs)("div",{...e.droppableProps,ref:e.innerRef,className:"space-y-0.5",children:[0===D.length?(0,r.jsx)("p",{className:"text-xs text-gray-400 italic py-2 text-center",children:"No hay tareas. Agrega una nueva..."}):D.map((e,t)=>(0,r.jsx)(e0._l,{draggableId:e.id,index:t,children:(n,a)=>(0,r.jsxs)("div",{ref:n.innerRef,...n.draggableProps,className:(0,y.cn)("flex items-center gap-1 p-1 rounded transition-colors group/item",a.isDragging?"bg-gray-100 shadow-md":"hover:bg-gray-50/50",i&&"hover:bg-gray-50"),children:[(0,r.jsx)("div",{...n.dragHandleProps,className:"cursor-grab active:cursor-grabbing p-0.5 opacity-50 hover:opacity-100 flex-shrink-0",children:(0,r.jsx)(et.Z,{className:"h-3 w-3 text-gray-400"})}),(0,r.jsx)(eF,{checked:e.completed,onCheckedChange:()=>M(t),className:"flex-shrink-0 h-3 w-3",onClick:e=>e.stopPropagation()}),(0,r.jsx)("input",{type:"text",value:e.text,onChange:e=>F(t,e.target.value),className:(0,y.cn)("flex-grow text-sm border-none shadow-none focus:outline-none focus:ring-0 p-1 bg-transparent",e.completed?"line-through text-gray-500":"text-gray-900"),placeholder:"Tarea...",onClick:e=>e.stopPropagation()}),i&&(0,r.jsx)(j.z,{variant:"ghost",size:"icon",onClick:e=>{e.stopPropagation(),B(t)},className:"h-5 w-5 opacity-0 group-hover/item:opacity-100 hover:opacity-100 transition-opacity flex-shrink-0",children:(0,r.jsx)(em.Z,{className:"h-2.5 w-2.5 text-gray-400"})})]})},e.id)),e.placeholder]})})})}),(0,r.jsx)(X,{className:"p-2 pt-1.5 border-t border-gray-200/50",children:(0,r.jsxs)("div",{className:"flex items-center gap-1 w-full",children:[(0,r.jsx)("input",{type:"text",value:b,onChange:e=>N(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),A())},placeholder:"Agregar tarea...",className:"flex-grow text-sm border-none shadow-none focus:outline-none focus:ring-0 p-1 bg-transparent",onClick:e=>e.stopPropagation()}),(0,r.jsx)(j.z,{onClick:e=>{e.stopPropagation(),A()},size:"sm",className:"flex-shrink-0 h-6 w-6 p-0",children:(0,r.jsx)(ee.Z,{className:"h-3 w-3"})})]})})]})},image:function(e){let{isSelected:t,properties:n,id:o,onUpdate:s,onEditElement:l,onSelectElement:i,content:c,isListening:d,liveTranscript:u}=e,p=("object"==typeof c&&null!==c&&"url"in c&&"string"==typeof c.url?c:{url:""}).url,m="object"==typeof n&&null!==n?n:{},h=(null==m?void 0:m.rotation)||0,g=(null==m?void 0:m.showFloatingTag)||!1,f=(null==m?void 0:m.floatingTag)||"",x=(null==m?void 0:m.label)||"",v=(0,a.useRef)(null),[b,w]=(0,a.useState)(!1);(0,a.useEffect)(()=>{v.current&&v.current.innerText!==x&&(v.current.innerText=x||"")},[x]),(0,a.useEffect)(()=>{if(b&&v.current){v.current.focus();let e=document.createRange(),t=window.getSelection();e.selectNodeContents(v.current),e.collapse(!1),null==t||t.removeAllRanges(),null==t||t.addRange(e)}},[b]);let{saveStatus:N,handleBlur:C,handleChange:E}=ez({getContent:()=>{var e;return(null===(e=v.current)||void 0===e?void 0:e.innerText)||x},onSave:async e=>{e!==x&&v.current&&s(o,{properties:{...m,label:e}})},debounceMs:2e3,compareContent:(e,t)=>e===t});return(0,a.useEffect)(()=>{d&&t&&b&&v.current&&document.activeElement===v.current&&(document.execCommand("insertText",!1,u||""),E())},[d,u,t,b,E]),(0,r.jsxs)("div",{className:"group/image flex flex-col w-full h-full",onDoubleClick:e=>{e.stopPropagation(),t&&(l(o),w(!0))},onMouseDown:e=>i(o,e.shiftKey||e.ctrlKey||e.metaKey),children:[(0,r.jsxs)("div",{className:"relative w-full flex-grow flex flex-col",children:[(t||g||f)&&(0,r.jsx)(e3,{tag:f||"",isEditing:!!g,onSave:e=>{s(o,{properties:{...m,floatingTag:e,showFloatingTag:!1}})},onCancel:()=>{s(o,{properties:{...m,showFloatingTag:!1}})}}),(0,r.jsx)("div",{onMouseDown:e=>e.stopPropagation(),className:(0,y.cn)("absolute top-1 left-1 z-20 opacity-0 group-hover/image:opacity-100 transition-opacity",t&&"opacity-100"),children:(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:e=>{e.stopPropagation(),l(o),s(o,{properties:{...m,showFloatingTag:!g}})},children:(0,r.jsx)(e4.Z,{className:"h-4 w-4"})})}),(0,r.jsx)("div",{onMouseDown:e=>e.stopPropagation(),className:"absolute bottom-1 left-1 z-20 opacity-0 group-hover/image:opacity-100 transition-opacity",children:(0,r.jsx)(j.z,{variant:"default",size:"icon",className:"h-6 w-6 rounded-full shadow-lg",onClick:e=>{e.stopPropagation(),window.open(p,"_blank","noopener,noreferrer")},title:"Abrir imagen original",children:(0,r.jsx)(e5.Z,{className:"h-3 w-3"})})}),(0,r.jsx)("div",{className:(0,y.cn)("relative flex-grow rounded-lg overflow-hidden drag-handle","cursor-grab active:cursor-grabbing"),style:{transform:"rotate(".concat(h||0,"deg)")},children:(0,r.jsx)("div",{className:"relative w-full h-full bg-card",children:(0,r.jsx)(e2.default,{src:"/api/proxy?url=".concat(encodeURIComponent(p)),alt:x||"Canvas Image",fill:!0,className:"object-cover pointer-events-none"})})})]}),(b||x&&""!==x.trim())&&(0,r.jsx)("div",{className:"w-full pt-2 flex justify-center items-center",onMouseDown:e=>e.stopPropagation(),children:(0,r.jsxs)("div",{className:"relative inline-flex items-center gap-2",children:[(0,r.jsx)("div",{ref:v,contentEditable:b,suppressContentEditableWarning:!0,onBlur:()=>{C(),w(!1)},onInput:E,onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),e.target.blur())},className:(0,y.cn)("text-white text-xs rounded-md px-3 py-1 whitespace-nowrap outline-none max-w-full",b?"ring-1 ring-primary cursor-text":"cursor-pointer"),style:{backgroundColor:"#2eb1ca"}}),b&&(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsx)(eI,{status:N,size:"sm"})})]})})]})},text:function(e){let{id:t,content:o,properties:s,onUpdate:l,onEditElement:i,isSelected:c,isListening:d,liveTranscript:u,finalTranscript:p,interimTranscript:m}=e,h=(0,a.useRef)(null),[g,f]=(0,a.useState)(!1),x="object"==typeof s&&null!==s?s:{},{fontSize:v,fontWeight:b,textAlign:w,fontStyle:j}=x,N="string"==typeof o?o:"",{saveStatus:C,handleBlur:E,handleChange:k}=ez({getContent:()=>{var e;return((null===(e=h.current)||void 0===e?void 0:e.innerHTML)||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim()},onSave:async e=>{var n;let r=((null===(n=h.current)||void 0===n?void 0:n.innerHTML)||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim(),a=(e||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim();a!==r&&await l(t,{content:a})},debounceMs:2e3,compareContent:(e,t)=>(e||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim()===(t||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim()}),z=(0,a.useRef)("");(0,a.useEffect)(()=>{if(h.current){let e=document.activeElement===h.current,t=h.current.innerHTML||"";if(z.current!==N&&(z.current=N,!e)){let e=/<[^>]+>/.test(N);if(e&&t!==N){let{updateInnerHTMLPreservingCursor:e}=n(5690);e(h.current,N)}else if(!e&&t!==N&&!(t.includes("<span")||t.includes("<div"))){let{updateInnerHTMLPreservingCursor:e}=n(5690);e(h.current,N||"")}}}},[N]),eZ({elementRef:h,isListening:d||!1,liveTranscript:u||"",finalTranscript:p||"",interimTranscript:m||"",isSelected:c||!1,enabled:!0});let T=async()=>{f(!1),await E()};return(0,r.jsxs)("div",{className:"relative w-full h-full",children:[(0,r.jsx)(e7(),{innerRef:h,html:N||"",disabled:!g,onChange:e=>{k()},onBlur:T,onDoubleClick:()=>{f(!0),i(t)},className:(0,y.cn)("w-full h-full outline-none break-words",g||c?"cursor-text":"cursor-grab drag-handle active:cursor-grabbing"),style:{fontSize:"".concat(v||24,"px"),fontWeight:b||"normal",textAlign:w||"left",fontStyle:j||"normal",color:x.color||"#000000",backgroundColor:x.backgroundColor||"#ffffff"}}),g&&(0,r.jsx)("div",{className:"absolute top-2 right-2 z-10",children:(0,r.jsx)(eI,{status:C,size:"sm"})})]})},container:function(e){let{id:t,properties:n,isSelected:o,onSelectElement:s,onEditElement:l,content:i,onUpdate:c,deleteElement:d,allElements:u=[],onLocateElement:p,unanchorElement:m}=e,h="object"==typeof n&&null!==n?n:{},g="object"==typeof i&&null!==i&&"elementIds"in i?i:{title:"Nuevo Contenedor",elementIds:[],layout:"single"},f=(null==h?void 0:h.backgroundColor)||"#ffffff",x=g.layout||"single",[v,b]=(0,a.useState)(!1),w=(0,a.useRef)(null),N=(0,a.useRef)(null),C=g.elementIds.map(e=>{let t=u.find(t=>t.id===e);return t?{elementId:e,element:t}:null}).filter(e=>null!==e),{saveStatus:E,handleBlur:k,handleChange:z}=ez({getContent:()=>{var e;return(null===(e=w.current)||void 0===e?void 0:e.value)||g.title||""},onSave:async e=>{e!==g.title&&c(t,{content:{...g,title:e}})},debounceMs:1e3}),T=(0,a.useCallback)(e=>{c(t,{properties:{...h,backgroundColor:e.hex}}),b(!1)},[t,h,c]),S=(0,a.useCallback)(()=>{c(t,{content:{...g,layout:"single"===x?"two-columns":"single"}})},[t,g,x,c]),D=(0,a.useCallback)(()=>{c(t,{hidden:!0})},[t,c]),I=(0,a.useCallback)(e=>{let n=g.elementIds.filter(t=>t!==e);c(t,{content:{...g,elementIds:n}});let r=u.find(e=>e.id===t);if(r&&m){let t="object"==typeof r.properties&&null!==r.properties?r.properties:{},n=t.position||{x:0,y:0},a=t.size||{width:378,height:567},o=u.find(t=>t.id===e);if(o){let t={x:n.x+("number"==typeof a.width?a.width:parseInt(String(a.width)))+20,y:n.y};c(e,{parentId:void 0,hidden:!1,properties:{..."object"==typeof o.properties&&null!==o.properties?o.properties:{},position:t}})}}},[t,g,u,c,m]),P=e=>{if("text"===e.type)return"string"==typeof e.content?e.content.substring(0,30):"Texto";if("sticky"===e.type)return"string"==typeof e.content?e.content.substring(0,30):"Nota";if("notepad"===e.type||"notepad-simple"===e.type){let t=e.content;return(null==t?void 0:t.title)||"Cuaderno"}if("todo"===e.type){let t=e.content;return(null==t?void 0:t.title)||"Lista de Tareas"}return"image"===e.type?"Imagen":e.type.charAt(0).toUpperCase()+e.type.slice(1)},R=e=>{let t="object"==typeof e.properties&&null!==e.properties&&e.properties.size?e.properties.size:{width:e.width||100,height:e.height||100},n=("number"==typeof t.width?t.width:parseInt(String(t.width)))/("number"==typeof t.height?t.height:parseInt(String(t.height))),a=100,o=100;if(n>1?o=100/n:a=100*n,"image"===e.type){let t=e.content;return(0,r.jsx)("div",{className:"relative w-full h-full rounded overflow-hidden bg-gray-100",children:(0,r.jsx)("img",{src:(null==t?void 0:t.url)||"",alt:"Preview",className:"w-full h-full object-cover",style:{width:a,height:o},onError:e=>{e.target.style.display="none"}})})}if("sticky"===e.type){var s;let t=(null===(s=e.properties)||void 0===s?void 0:s.color)||e.color||"yellow",n={yellow:"#fffb8b",pink:"#ffc2d4",blue:"#bce8f1",green:"#d4edda",orange:"#ffeeba",purple:"#e9d5ff"}[t]||(t.startsWith("#")?t:"#fffb8b"),a="string"==typeof e.content?e.content.substring(0,50):"Nota";return(0,r.jsx)("div",{className:"w-full h-full rounded p-2 text-xs overflow-hidden flex items-center justify-center",style:{backgroundColor:n,minHeight:o},children:(0,r.jsx)("p",{className:"line-clamp-3 text-center",children:a})})}if("text"===e.type){let t="string"==typeof e.content?e.content.substring(0,100):"Texto";return(0,r.jsx)("div",{className:"w-full h-full rounded p-2 bg-white border border-gray-200 flex items-center justify-center text-xs text-gray-600",children:(0,r.jsx)("p",{className:"line-clamp-4 text-center",children:t})})}if("notepad"===e.type||"notepad-simple"===e.type||"super-notebook"===e.type){let t=e.content,n=(null==t?void 0:t.title)||"Cuaderno",a=(null==t?void 0:t.content)||(null==t?void 0:t.text)||"";return(0,r.jsxs)("div",{className:"w-full h-full rounded p-2 bg-white border border-gray-200 flex flex-col",children:[(0,r.jsx)("div",{className:"font-semibold text-xs mb-1 truncate",children:n}),(0,r.jsx)("div",{className:"text-xs text-gray-500 line-clamp-2",children:a.substring(0,60)})]})}if("todo"===e.type){let t=e.content,n=(null==t?void 0:t.items)||[],a=n.filter(e=>e.completed).length;return(0,r.jsxs)("div",{className:"w-full h-full rounded p-2 bg-white border border-gray-200 flex flex-col",children:[(0,r.jsx)("div",{className:"font-semibold text-xs mb-1",children:(null==t?void 0:t.title)||"Lista"}),(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:[a,"/",n.length," completadas"]})]})}return(0,r.jsxs)("div",{className:"bg-gradient-to-br from-gray-100 to-gray-200 rounded flex flex-col items-center justify-center text-xs text-gray-500 p-2",style:{minHeight:o},children:[(0,r.jsx)("div",{className:"text-lg mb-1",children:e.type.charAt(0).toUpperCase()}),(0,r.jsx)("div",{className:"text-center capitalize",children:e.type})]})};return(0,r.jsxs)(V,{id:t,"data-element-type":"container","data-element-id":t,ref:N,className:(0,y.cn)("w-full h-full flex flex-col overflow-hidden","min-w-[200px] min-h-[300px]","rounded-lg shadow-lg border border-gray-200/50",o?"ring-2 ring-blue-500 ring-offset-2":"","hover:shadow-xl transition-shadow"),style:{backgroundColor:"transparent"===f?"#ffffff":f,pointerEvents:"auto"},onClick:e=>{if(!e.target.closest(".drag-handle")){if("K85hC8M5spfsgRITnEQR"===t){let e=(null==h?void 0:h.zIndex)||-1;c(t,{properties:{...h,zIndex:9999}}),l(t),setTimeout(()=>{c(t,{properties:{...h,zIndex:e}})},1e3)}else l(t)}},onMouseDown:e=>{if(!e.target.closest(".drag-handle")){if(e.stopPropagation(),"K85hC8M5spfsgRITnEQR"===t){let n=(null==h?void 0:h.zIndex)||-1;c(t,{properties:{...h,zIndex:9999}}),s(t,e.shiftKey||e.ctrlKey||e.metaKey),setTimeout(()=>{o||c(t,{properties:{...h,zIndex:n}})},2e3)}else s(t,e.shiftKey||e.ctrlKey||e.metaKey)}},onDrop:e=>{e.preventDefault(),e.stopPropagation()},onDragOver:e=>{e.preventDefault(),e.stopPropagation(),e.currentTarget&&(e.currentTarget.style.opacity="0.9")},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),e.currentTarget&&(e.currentTarget.style.opacity="1")},children:[(0,r.jsxs)(G,{className:"p-3 border-b border-gray-200 bg-white flex flex-row items-center justify-between group/header",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,r.jsx)("div",{className:"drag-handle cursor-grab active:cursor-grabbing flex-shrink-0",children:(0,r.jsx)(et.Z,{className:"h-4 w-4 text-gray-400"})}),(0,r.jsx)("input",{ref:w,type:"text",value:g.title||"",onChange:e=>{z(),c(t,{content:{...g,title:e.target.value}})},onBlur:k,className:"flex-1 min-w-0 text-sm font-semibold bg-transparent border-none outline-none focus:outline-none focus:ring-0 p-1",placeholder:"T\xedtulo del contenedor...",onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation()})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0",children:[(0,r.jsx)(eI,{status:E,size:"sm"}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-7 w-7",title:"single"===x?"Dividir en dos columnas":"Una sola columna",onClick:e=>{e.stopPropagation(),S()},children:(0,r.jsx)(e6.Z,{className:(0,y.cn)("h-4 w-4","two-columns"===x&&"text-blue-600")})}),(0,r.jsxs)(eH,{open:v,onOpenChange:b,children:[(0,r.jsx)(e_,{asChild:!0,children:(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-7 w-7",title:"Cambiar color de fondo",onClick:e=>e.stopPropagation(),children:(0,r.jsx)(eX.Z,{className:"h-4 w-4"})})}),(0,r.jsx)(eW,{className:"w-auto p-0",onClick:e=>e.stopPropagation(),children:(0,r.jsx)(eK.e8,{colors:te.map(e=>e.value),color:f,onChange:T,triangle:"hide"})})]}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-7 w-7 text-gray-400 hover:text-gray-600",title:"Cerrar contenedor",onClick:e=>{e.stopPropagation(),D()},children:(0,r.jsx)(em.Z,{className:"h-4 w-4"})})]})]}),(0,r.jsx)(Y,{className:"flex-1 p-3 overflow-y-auto",style:{minHeight:0},onDrop:e=>{e.preventDefault(),e.stopPropagation(),console.log("\uD83D\uDCE6 Drop en CardContent del contenedor")},onDragOver:e=>{e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="move"},children:0===C.length?(0,r.jsx)("div",{className:"flex items-center justify-center h-full text-sm text-gray-400",children:"Arrastra elementos aqu\xed para guardarlos"}):(0,r.jsx)("div",{className:(0,y.cn)("grid gap-3","two-columns"===x?"grid-cols-2":"grid-cols-1"),children:C.map(e=>{let{elementId:t,element:n}=e;return(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 flex flex-col gap-2 group/card hover:shadow-md transition-shadow",children:[(0,r.jsx)("div",{className:"flex items-center justify-center bg-gray-50 rounded p-2 min-h-[80px]",children:R(n)}),(0,r.jsx)("div",{className:"text-xs font-medium text-gray-700 truncate",children:P(n)}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-6 w-6 self-end opacity-0 group-hover/card:opacity-100 transition-opacity",title:"Soltar elemento del contenedor",onClick:e=>{e.stopPropagation(),I(t)},children:(0,r.jsx)(e9.Z,{className:"h-3 w-3"})})]},t)})})})]})},comment:function(e){let{content:t,properties:n,onEditComment:o,onUpdate:s,onLocateElement:l,id:i,type:c,x:d,y:u,width:p,height:m,rotation:h,zIndex:g,color:f,backgroundColor:x,hidden:v,parentId:b,isSelected:w,onSelectElement:N,isListening:C,liveTranscript:E,finalTranscript:k,interimTranscript:z}=e,[T,S]=(0,a.useState)(!1),D=(0,a.useRef)(null),I="object"==typeof t&&null!==t?t:"string"==typeof t?{text:t}:{};I.text||I.title||I.label;let P=I.label||I.title||"Localizador",{saveStatus:R,handleBlur:M,handleChange:F}=ez({getContent:()=>{var e;return(null===(e=D.current)||void 0===e?void 0:e.value)||P},onSave:async e=>{e!==P&&s(i,{content:{...I,label:e,title:e}})},debounceMs:1e3}),A=()=>{D.current&&M(),S(!1)};return eZ({elementRef:D,isListening:C||!1,liveTranscript:E||"",finalTranscript:k||"",interimTranscript:z||"",isSelected:w||!1,enabled:T}),(0,r.jsxs)("div",{onClick:e=>{e.stopPropagation(),T||(w&&l?l(i):N(i,!1))},onDoubleClick:e=>{e.stopPropagation(),S(!0),setTimeout(()=>{var e,t;null===(e=D.current)||void 0===e||e.focus(),null===(t=D.current)||void 0===t||t.select()},0)},className:(0,y.cn)("w-full h-full cursor-move relative group","flex flex-col items-center justify-center gap-1",w&&"ring-2 ring-blue-500 ring-offset-2 rounded-lg"),style:{minWidth:"80px",minHeight:"80px"},children:[(0,r.jsxs)("div",{className:(0,y.cn)("relative flex items-center justify-center","transition-transform hover:scale-110"),children:[(0,r.jsx)("div",{className:"absolute inset-0 rounded-full",style:{backgroundColor:"#b7ddda",backgroundImage:"\n              repeating-linear-gradient(45deg, transparent, transparent 4px, rgba(0,0,0,0.05) 4px, rgba(0,0,0,0.05) 8px),\n              repeating-linear-gradient(-45deg, transparent, transparent 4px, rgba(0,0,0,0.05) 4px, rgba(0,0,0,0.05) 8px)\n            ",backgroundSize:"8px 8px",width:"48px",height:"48px"}}),(0,r.jsx)("div",{className:"w-12 h-12 rounded-full flex items-center justify-center relative z-10",style:{backgroundColor:"#4a5568"},children:(0,r.jsx)(tt.Z,{className:"w-6 h-6 text-white",strokeWidth:2.5,style:{filter:"drop-shadow(0 0 1px rgba(0,0,0,0.3))"}})})]}),T?(0,r.jsxs)("div",{className:"flex items-center gap-1 mt-1",onClick:e=>e.stopPropagation(),children:[(0,r.jsx)(eY.I,{ref:D,type:"text",value:P,onChange:e=>{F(),s(i,{content:{...I,label:e.target.value,title:e.target.value}})},onBlur:A,onKeyDown:e=>{"Enter"===e.key?A():"Escape"===e.key&&S(!1)},className:"h-6 text-xs px-2 w-24",onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),autoFocus:!0}),(0,r.jsx)(eI,{status:R,size:"sm"})]}):(0,r.jsx)("div",{className:"mt-1 text-xs font-medium text-gray-700 text-center max-w-[100px] truncate px-1",children:P||"Localizador"}),!T&&(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"absolute top-0 right-0 h-5 w-5 opacity-0 group-hover:opacity-100 transition-opacity z-50",onClick:e=>{e.preventDefault(),e.stopPropagation(),S(!0),setTimeout(()=>{var e,t;null===(e=D.current)||void 0===e||e.focus(),null===(t=D.current)||void 0===t||t.select()},0)},onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},children:(0,r.jsx)(tn.Z,{className:"h-3 w-3"})})]})},moodboard:function(e){let{id:t,properties:n,isSelected:o,onSelectElement:s,onEditElement:l,content:i,onUpdate:c,deleteElement:d,isListening:u,liveTranscript:p}=e,m="object"==typeof n&&null!==n?n:{},h="object"==typeof i&&null!==i&&"images"in i?i:{title:"Nuevo Moodboard",images:[],annotations:[],layout:"grid"},[g,f]=(0,a.useState)(!1),[x,v]=(0,a.useState)(""),[b,w]=(0,a.useState)(null),N=(0,a.useRef)(null),C=(0,a.useRef)(null),{saveStatus:E,handleBlur:k,handleChange:z}=ez({getContent:()=>{var e;return(null===(e=N.current)||void 0===e?void 0:e.value)||h.title||""},onSave:async e=>{e!==h.title&&c(t,{content:{...h,title:e}})},debounceMs:1e3}),T=(0,a.useCallback)(()=>{if(!x.trim())return;let e={id:"img-".concat(Date.now()),url:x.trim()};c(t,{content:{...h,images:[...h.images,e]}}),v(""),f(!1)},[t,h,x,c]),S=(0,a.useCallback)(e=>{c(t,{content:{...h,images:h.images.filter(t=>t.id!==e),annotations:h.annotations.filter(t=>t.imageId!==e)}})},[t,h,c]),D=(0,a.useCallback)((e,n)=>{let r=n.currentTarget.getBoundingClientRect(),a=(n.clientX-r.left)/r.width*100,o=(n.clientY-r.top)/r.height*100,s={id:"ann-".concat(Date.now()),imageId:e,x:Math.max(0,Math.min(100,a)),y:Math.max(0,Math.min(100,o)),text:"Nueva anotaci\xf3n",color:"#fffb8b"};c(t,{content:{...h,annotations:[...h.annotations,s]}}),w(s.id)},[t,h,c]),I=(0,a.useCallback)((e,n)=>{c(t,{content:{...h,annotations:h.annotations.map(t=>t.id===e?{...t,...n}:t)}})},[t,h,c]);(0,a.useCallback)(e=>{c(t,{content:{...h,annotations:h.annotations.filter(t=>t.id!==e)}}),w(null)},[t,h,c]);let P=(0,a.useCallback)(()=>{c(t,{hidden:!0})},[t,c]),R=(null==m?void 0:m.backgroundColor)||"#ffffff";return h.layout,(0,r.jsxs)(V,{id:t,"data-element-type":"moodboard","data-element-id":t,ref:C,className:(0,y.cn)("w-full h-full flex flex-col overflow-hidden","min-w-[400px] min-h-[300px]","rounded-lg shadow-lg border border-gray-200/50",o?"ring-2 ring-blue-500 ring-offset-2":"","hover:shadow-xl transition-shadow"),style:{backgroundColor:"transparent"===R?"#ffffff":R,pointerEvents:"auto"},onClick:e=>{e.target.closest(".drag-handle")||l(t)},onMouseDown:e=>{e.target.closest(".drag-handle")||(e.stopPropagation(),s(t,!1))},children:[(0,r.jsxs)(G,{className:"p-3 border-b border-gray-200 bg-white flex flex-row items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,r.jsx)("div",{className:"drag-handle cursor-grab active:cursor-grabbing flex-shrink-0",children:(0,r.jsx)(et.Z,{className:"h-4 w-4 text-gray-400"})}),(0,r.jsx)("input",{ref:N,type:"text",value:h.title||"",onChange:e=>{z(),c(t,{content:{...h,title:e.target.value}})},onBlur:k,className:"flex-1 min-w-0 text-sm font-semibold bg-transparent border-none outline-none focus:outline-none focus:ring-0 p-1",placeholder:"T\xedtulo del moodboard...",onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation()})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0",children:[(0,r.jsx)(eI,{status:E,size:"sm"}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-7 w-7",title:"Agregar imagen",onClick:e=>{e.stopPropagation(),f(!0)},children:(0,r.jsx)(ts.Z,{className:"h-4 w-4"})}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-7 w-7 text-gray-400 hover:text-gray-600",title:"Cerrar moodboard",onClick:e=>{e.stopPropagation(),P()},children:(0,r.jsx)(em.Z,{className:"h-4 w-4"})})]})]}),(0,r.jsxs)(Y,{className:"flex-1 p-3 overflow-y-auto",style:{minHeight:0},children:[g&&(0,r.jsx)("div",{className:"mb-3 p-3 bg-gray-50 rounded-lg border border-gray-200",children:(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(eY.I,{type:"url",placeholder:"URL de la imagen...",value:x,onChange:e=>v(e.target.value),onKeyDown:e=>{"Enter"===e.key?T():"Escape"===e.key&&(f(!1),v(""))},className:"flex-1",onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation()}),(0,r.jsx)(j.z,{size:"sm",onClick:e=>{e.stopPropagation(),T()},children:"Agregar"}),(0,r.jsx)(j.z,{size:"sm",variant:"ghost",onClick:e=>{e.stopPropagation(),f(!1),v("")},children:"Cancelar"})]})}),0===h.images.length?(0,r.jsx)("div",{className:"flex items-center justify-center h-full text-sm text-gray-400",children:"Haz clic en el bot\xf3n de imagen para agregar im\xe1genes al moodboard"}):(0,r.jsx)("div",{className:(0,y.cn)("grid gap-4","grid-cols-2"),children:h.images.map(e=>{let t=h.annotations.filter(t=>t.imageId===e.id);return(0,r.jsxs)("div",{className:"relative group rounded-lg overflow-hidden border border-gray-200 bg-gray-50",children:[(0,r.jsxs)("div",{className:"relative w-full aspect-square cursor-crosshair",onClick:t=>{t.target.closest(".annotation")||D(e.id,t)},children:[(0,r.jsx)("img",{src:e.url,alt:"Moodboard image",className:"w-full h-full object-cover",onError:e=>{e.target.style.display="none"}}),t.map(e=>(0,r.jsx)("div",{className:(0,y.cn)("annotation absolute p-2 rounded shadow-lg cursor-move min-w-[80px]",b===e.id?"z-10 ring-2 ring-blue-500":""),style:{left:"".concat(e.x,"%"),top:"".concat(e.y,"%"),backgroundColor:e.color||"#fffb8b",transform:"translate(-50%, -50%)"},onClick:t=>{t.stopPropagation(),w(e.id)},onMouseDown:e=>e.stopPropagation(),children:b===e.id?(0,r.jsx)(eY.I,{type:"text",value:e.text,onChange:t=>{I(e.id,{text:t.target.value})},onBlur:()=>w(null),className:"text-xs h-6 px-1",onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),"data-annotation-id":e.id,autoFocus:!0}):(0,r.jsx)("div",{className:"text-xs font-medium",children:e.text})},e.id))]}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity bg-red-500 hover:bg-red-600 text-white",onClick:t=>{t.stopPropagation(),S(e.id)},children:(0,r.jsx)(em.Z,{className:"h-3 w-3"})})]},e.id)})})]})]})},"tabbed-notepad":function(e){var t;let{id:n,properties:o,isSelected:s,onSelectElement:l,onEditElement:i,content:c,onUpdate:d,deleteElement:u,isListening:p,liveTranscript:m,finalTranscript:g,interimTranscript:f}=e,{toast:x}=(0,h.pm)(),v="object"==typeof o&&null!==o?o:{},b="object"==typeof c&&null!==c&&"tabs"in c?c:{title:"Bloc de Notas",tabs:[{id:"tab-1",title:"Pesta\xf1a 1",content:""}],activeTabId:"tab-1"},[N,C]=(0,a.useState)(!1),E=(0,a.useRef)(null),k=(0,a.useRef)(null),z=(0,a.useRef)({}),[T,S]=(0,a.useState)({}),D=b.activeTabId||(null===(t=b.tabs[0])||void 0===t?void 0:t.id)||"tab-1",I=b.tabs.find(e=>e.id===D)||b.tabs[0],{saveStatus:P,handleBlur:R,handleChange:M}=ez({getContent:()=>{var e;return(null===(e=E.current)||void 0===e?void 0:e.value)||b.title||""},onSave:async e=>{e!==b.title&&d(n,{content:{...b,title:e}})},debounceMs:1e3}),F=(0,a.useCallback)(()=>{let e={id:"tab-".concat(Date.now()),title:"Pesta\xf1a ".concat(b.tabs.length+1),content:""};d(n,{content:{...b,tabs:[...b.tabs,e],activeTabId:e.id}})},[n,b,d]),A=(0,a.useCallback)(e=>{var t;if(b.tabs.length<=1){x({variant:"destructive",title:"Error",description:"Debe haber al menos una pesta\xf1a."});return}let r=b.tabs.filter(t=>t.id!==e),a=e===D?(null===(t=r[0])||void 0===t?void 0:t.id)||"tab-1":D;d(n,{content:{...b,tabs:r,activeTabId:a}})},[n,b,D,d,x]),B=(0,a.useCallback)(e=>{d(n,{content:{...b,activeTabId:e}})},[n,b,d]),L=(0,a.useCallback)((e,t)=>{d(n,{content:{...b,tabs:b.tabs.map(n=>n.id===e?{...n,title:t}:n)}})},[n,b,d]),Z=(0,a.useRef)(b);(0,a.useEffect)(()=>{Z.current=b},[b]);let O=(0,a.useCallback)((e,t)=>{S(n=>({...n,[e]:t}));let r=Z.current;d(n,{content:{...r,tabs:r.tabs.map(n=>n.id===e?{...n,content:t}:n)}})},[n,d]),U=(0,a.useRef)(""),H=(0,a.useRef)({});(0,a.useEffect)(()=>{H.current=T},[T]),(0,a.useEffect)(()=>{let e=b.tabs.map(e=>"".concat(e.id,"|").concat(e.content)).join("||");if(U.current===e&&Object.keys(H.current).length>0)return;U.current=e;let t={};b.tabs.forEach(e=>{let n=z.current[e.id];if(n&&document.activeElement!==n){let n=H.current[e.id];n!==e.content?t[e.id]=e.content:t[e.id]=null!=n?n:e.content}else{var r;t[e.id]=null!==(r=H.current[e.id])&&void 0!==r?r:e.content}}),(Object.keys(t).some(e=>t[e]!==H.current[e])||0===Object.keys(H.current).length)&&S(t)},[b.tabs]);let _=(0,a.useCallback)(async()=>{if(!k.current){x({variant:"destructive",title:"Error",description:"No se pudo encontrar el elemento para exportar."});return}C(!0),x({title:"Exportando...",description:"Generando imagen PNG de alta resoluci\xf3n."});try{(await w()(k.current,{backgroundColor:"#ffffff",scale:3,useCORS:!0,logging:!1,allowTaint:!1,windowWidth:k.current.scrollWidth,windowHeight:k.current.scrollHeight})).toBlob(e=>{if(!e){x({variant:"destructive",title:"Error",description:"No se pudo generar la imagen."}),C(!1);return}let t=URL.createObjectURL(e),n=document.createElement("a");n.href=t;let r=b.title||"bloc-notas";n.download="".concat(r,"_").concat(Date.now(),".png"),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t),x({title:"Exportado",description:"El bloc de notas se ha exportado como PNG de alta resoluci\xf3n."}),C(!1)},"image/png",1)}catch(e){console.error("Error al exportar:",e),x({variant:"destructive",title:"Error",description:e.message||"Ocurri\xf3 un error al exportar."}),C(!1)}},[b.title,x]),W=(0,a.useCallback)(()=>{d(n,{hidden:!0})},[n,d]),K=(0,a.useRef)(null);(0,a.useEffect)(()=>{let e=document.activeElement;e&&"TEXTAREA"===e.tagName&&k.current&&k.current.contains(e)&&(K.current=e)},[I]),eZ({elementRef:K,isListening:p||!1,liveTranscript:m||"",finalTranscript:g||"",interimTranscript:f||"",isSelected:s||!1,enabled:!0});let q=(0,a.useRef)(O);(0,a.useEffect)(()=>{q.current=O},[O]),(0,a.useEffect)(()=>{if(K.current&&I){let e=K.current,t=()=>{q.current(I.id,e.value)};return e.addEventListener("input",t),()=>e.removeEventListener("input",t)}},[null==I?void 0:I.id]);let J=(null==v?void 0:v.backgroundColor)||"#ffffff";return(0,r.jsxs)(V,{id:n,"data-element-type":"tabbed-notepad","data-element-id":n,ref:k,className:(0,y.cn)("w-full h-full flex flex-col overflow-hidden","min-w-[400px] min-h-[300px]","rounded-lg shadow-lg border border-gray-200/50",s?"ring-2 ring-blue-500 ring-offset-2":"","hover:shadow-xl transition-shadow"),style:{backgroundColor:"transparent"===J?"#ffffff":J,pointerEvents:"auto"},onClick:e=>{e.target.closest(".drag-handle")||i(n)},onMouseDown:e=>{e.target.closest(".drag-handle")||(e.stopPropagation(),l(n,!1))},children:[(0,r.jsxs)(G,{className:"p-3 border-b border-gray-200 bg-white flex flex-row items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,r.jsx)("div",{className:"drag-handle cursor-grab active:cursor-grabbing flex-shrink-0",children:(0,r.jsx)(et.Z,{className:"h-4 w-4 text-gray-400"})}),(0,r.jsx)("input",{ref:E,type:"text",value:b.title||"",onChange:e=>{M(),d(n,{content:{...b,title:e.target.value}})},onBlur:R,className:"flex-1 min-w-0 text-sm font-semibold bg-transparent border-none outline-none focus:outline-none focus:ring-0 p-1",placeholder:"T\xedtulo del bloc...",onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation()})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0",children:[(0,r.jsx)(eI,{status:P,size:"sm"}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-7 w-7",title:"Exportar a PNG",onClick:e=>{e.stopPropagation(),_()},disabled:N,children:(0,r.jsx)(e$.Z,{className:"h-4 w-4"})}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-7 w-7 text-gray-400 hover:text-gray-600",title:"Cerrar bloc",onClick:e=>{e.stopPropagation(),W()},children:(0,r.jsx)(em.Z,{className:"h-4 w-4"})})]})]}),(0,r.jsx)(Y,{className:"flex-1 p-3 overflow-hidden flex flex-col",style:{minHeight:0},children:(0,r.jsxs)(ti,{value:D,onValueChange:B,className:"flex-1 flex flex-col overflow-hidden",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsx)(tc,{className:"flex-1 justify-start overflow-x-auto",children:b.tabs.map(e=>(0,r.jsxs)(td,{value:e.id,className:"relative group/tab",onClick:e=>e.stopPropagation(),children:[(0,r.jsx)("input",{type:"text",value:e.title,onChange:t=>{t.stopPropagation(),L(e.id,t.target.value)},onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),className:"bg-transparent border-none outline-none text-xs px-1 min-w-[60px] max-w-[120px]"}),b.tabs.length>1&&(0,r.jsx)("span",{className:"inline-flex items-center justify-center h-4 w-4 ml-1 opacity-0 group-hover/tab:opacity-100 transition-opacity cursor-pointer hover:bg-gray-100 rounded",onClick:t=>{t.stopPropagation(),t.preventDefault(),A(e.id)},onMouseDown:e=>{e.stopPropagation(),e.preventDefault()},role:"button",tabIndex:0,onKeyDown:t=>{("Enter"===t.key||" "===t.key)&&(t.preventDefault(),t.stopPropagation(),A(e.id))},children:(0,r.jsx)(em.Z,{className:"h-3 w-3"})})]},e.id))}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-7 w-7 ml-2",title:"Agregar pesta\xf1a",onClick:e=>{e.stopPropagation(),F()},children:(0,r.jsx)(ee.Z,{className:"h-4 w-4"})})]}),b.tabs.map(e=>{let t=void 0!==T[e.id]?T[e.id]:e.content;return(0,r.jsx)(tu,{value:e.id,className:"flex-1 overflow-hidden mt-0",children:(0,r.jsx)("textarea",{ref:t=>{z.current[e.id]=t,t&&void 0===T[e.id]&&S(t=>({...t,[e.id]:e.content}))},value:t,onChange:t=>{O(e.id,t.target.value)},className:"w-full h-full resize-none border-none outline-none bg-transparent p-2 text-sm",placeholder:"Escribe aqu\xed...",onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),style:{minHeight:"200px"}})},e.id)})]})})]})},accordion:function(e){let{id:t,content:n,properties:o,isSelected:s,onUpdate:l,isListening:i,liveTranscript:c,finalTranscript:d,interimTranscript:u}=e,p="object"==typeof o&&null!==o?o:{},m="object"==typeof n&&null!==n&&"items"in n?n:{items:[{id:"1",title:"Nuevo Item",content:""}]},[h,g]=(0,a.useState)(m.items||[]),[f,x]=(0,a.useState)(h.filter(e=>e.isOpen).map(e=>e.id)),v=(0,a.useRef)("");(0,a.useEffect)(()=>{let e=JSON.stringify(n);v.current!==e&&(v.current=e,"object"==typeof n&&null!==n&&"items"in n&&(g(n.items||[]),x(n.items.filter(e=>e.isOpen).map(e=>e.id))))},[n]);let b=e=>{let n=h.filter(t=>t.id!==e);g(n),x(f.filter(t=>t!==e)),l(t,{content:{items:n}})},w=(e,n)=>{let r=h.map(t=>t.id===e?{...t,...n}:t);g(r),l(t,{content:{items:r}})},N=p.size||{width:320,height:240},C="number"==typeof N.width?N.width:320,E="number"==typeof N.height?N.height:240;return(0,r.jsxs)(V,{className:(0,y.cn)("w-full h-full p-3 bg-white shadow-sm drag-handle",s&&"ring-2 ring-primary"),style:{width:"".concat(C,"px"),height:"".concat(E,"px"),backgroundColor:p.backgroundColor||"#ffffff"},children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2 drag-handle",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 drag-handle",children:[(0,r.jsx)(et.Z,{className:"h-4 w-4 text-slate-400 cursor-move drag-handle"}),(0,r.jsx)("h3",{className:"font-semibold text-slate-800 text-sm drag-handle",children:"Acorde\xf3n"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[s&&(0,r.jsxs)(eH,{children:[(0,r.jsx)(e_,{asChild:!0,children:(0,r.jsx)(j.z,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0",onClick:e=>e.stopPropagation(),children:(0,r.jsx)(eX.Z,{className:"h-4 w-4"})})}),(0,r.jsx)(eW,{className:"w-auto p-0",onClick:e=>e.stopPropagation(),children:(0,r.jsx)(eK.e8,{color:p.backgroundColor||"#ffffff",onChange:e=>l(t,{properties:{...p,backgroundColor:e.hex}})})})]}),(0,r.jsx)(j.z,{size:"sm",variant:"ghost",onClick:()=>{let e=[...h,{id:Date.now().toString(),title:"Nuevo Item",content:"",isOpen:!1}];g(e),l(t,{content:{items:e}})},className:"h-7 w-7 p-0",children:(0,r.jsx)(ee.Z,{className:"h-4 w-4"})})]})]}),(0,r.jsx)(tm,{type:"multiple",value:f,onValueChange:e=>{let n=Array.isArray(e)?e:e?[e]:[];x(n),l(t,{content:{items:h.map(e=>({...e,isOpen:n.includes(e.id)}))}})},className:"w-full",children:h.map(e=>(0,r.jsxs)(th,{value:e.id,children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(tg,{className:"flex-1 text-left",onClick:e=>e.stopPropagation(),children:(0,r.jsx)(tx,{value:e.title,onChange:t=>w(e.id,{title:t}),isListening:i,liveTranscript:c,finalTranscript:d})}),s&&(0,r.jsx)(j.z,{size:"sm",variant:"ghost",onClick:t=>{t.stopPropagation(),b(e.id)},className:"h-7 w-7 p-0 text-destructive hover:text-destructive",children:(0,r.jsx)(em.Z,{className:"h-4 w-4"})})]}),(0,r.jsx)(tf,{children:(0,r.jsx)(tv,{value:e.content,onChange:t=>w(e.id,{content:t}),isListening:i,liveTranscript:c,finalTranscript:d,interimTranscript:u,isSelected:s})})]},e.id))}),0===h.length&&(0,r.jsx)("div",{className:"text-center text-slate-400 py-8",children:(0,r.jsx)("p",{children:"No hay items. Haz clic en + para agregar uno."})})]})},"yellow-notepad":function(e){let{id:t,content:n,properties:o,onUpdate:s,deleteElement:l,isSelected:i,isListening:c,liveTranscript:d,finalTranscript:u,interimTranscript:p}=e,{toast:m}=(0,h.pm)(),g=(0,a.useRef)(null),[f,x]=(0,a.useState)(!1),[v,b]=(0,a.useState)(!1),N=n||{},C=N.text||"",E=N.searchQuery||"",k=(0,a.useRef)(N),z=(0,a.useRef)(C);(0,a.useEffect)(()=>{k.current=N,z.current=C},[N,C]);let[T,S]=(0,a.useState)(E),D=(0,a.useRef)(void 0);(0,a.useEffect)(()=>{let e=N.searchQuery;void 0!==e&&e!==D.current&&(D.current=e,e!==T&&S(e))},[N.searchQuery,T]);let{saveStatus:I,handleBlur:P,handleChange:M}=ez({getContent:()=>{var e;return(null===(e=g.current)||void 0===e?void 0:e.innerText)||""},onSave:async e=>{e!==(z.current||"").trim()&&await s(t,{content:{text:e,searchQuery:T}})},debounceMs:2e3,compareContent:(e,t)=>(e||"").trim()===(t||"").trim()}),F=(0,a.useRef)("");(0,a.useEffect)(()=>{F.current!==C&&(F.current=C,g.current&&C!==g.current.innerText&&document.activeElement!==g.current&&(g.current.innerText=C||""))},[C]),eZ({elementRef:g,isListening:c||!1,liveTranscript:d||"",finalTranscript:u||"",interimTranscript:p||"",isSelected:i||!1,enabled:!0});let A=(0,a.useCallback)(async e=>{e.stopPropagation(),e.preventDefault();try{let e=document.querySelector('[data-element-id="'.concat(t,'"]'));if(!e){m({variant:"destructive",title:"Error",description:"No se pudo encontrar el elemento para exportar."});return}b(!0),m({title:"Exportando...",description:"Generando imagen PNG de alta resoluci\xf3n."}),(await w()(e,{backgroundColor:"#FFFFE0",scale:2.1,useCORS:!0,logging:!1,allowTaint:!1,windowWidth:e.scrollWidth,windowHeight:e.scrollHeight})).toBlob(e=>{if(!e){m({variant:"destructive",title:"Error",description:"No se pudo generar la imagen."}),b(!1);return}let t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="yellow-notepad_".concat(Date.now(),".png"),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t),m({title:"Exportado",description:"El cuaderno se ha exportado como PNG de alta resoluci\xf3n."}),b(!1)},"image/png",1)}catch(e){console.error("Error al exportar:",e),m({variant:"destructive",title:"Error",description:e.message||"No se pudo exportar."}),b(!1)}},[m,t]),B=(0,a.useCallback)(()=>{M()},[M]),L=(0,a.useCallback)(async()=>{await P()},[P]),Z=(0,a.useCallback)(e=>{let n=e.target.value;S(n),s(t,{content:{...k.current,searchQuery:n}})},[t,s]),O=(0,a.useCallback)(()=>{f||(x(!0),l(t))},[t,l,f]),U=(0,a.useCallback)(()=>{O()},[O]);return(0,r.jsxs)("div",{"data-element-id":t,className:(0,y.cn)("relative w-full h-full flex flex-col overflow-hidden"),style:{backgroundColor:"#FFFFE0",borderRadius:"4px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},onMouseDown:e=>{var t;let n=e.target;n===g.current||(null===(t=g.current)||void 0===t?void 0:t.contains(n))?e.currentTarget.classList.remove("drag-handle"):e.currentTarget.classList.add("drag-handle")},children:[(0,r.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 drag-handle",style:{backgroundColor:"#e9e490",color:"#000000"},children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-6 w-6 hover:bg-black/10 p-0",style:{color:"#000000"},children:(0,r.jsx)(tb.Z,{className:"h-4 w-4"})}),(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("span",{className:"text-sm font-bold leading-tight",style:{color:"#000000"},children:"Nuevo"}),(0,r.jsx)("span",{className:"text-sm font-bold leading-tight",style:{color:"#000000"},children:"Notepad"})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 flex-1 max-w-xs mx-4",children:[(0,r.jsx)(tr.Z,{className:"h-4 w-4",style:{color:"#000000"}}),(0,r.jsx)(eY.I,{type:"text",placeholder:"Buscar...",value:T,onChange:Z,className:"h-7 text-sm bg-transparent border-none text-black placeholder:text-gray-600 focus-visible:ring-0 focus-visible:ring-offset-0",style:{color:"#000000"}})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)(ex,{children:[(0,r.jsx)(ev,{asChild:!0,children:(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-6 w-6 hover:bg-black/10 p-0",style:{color:"#000000"},children:(0,r.jsx)(ec.Z,{className:"h-4 w-4"})})}),(0,r.jsx)(ej,{children:(0,r.jsxs)(eN,{onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),A(e)},disabled:v,children:[(0,r.jsx)(ed.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:v?"Exportando...":"Exportar a PNG: alta resoluci\xf3n"})]})})]}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-6 w-6 hover:bg-black/10 p-0",onClick:O,style:{color:"#000000"},children:(0,r.jsx)(R.Z,{className:"h-4 w-4"})}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-6 w-6 hover:bg-black/10 p-0",onClick:U,style:{color:"#000000"},children:(0,r.jsx)(em.Z,{className:"h-4 w-4"})})]})]}),(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto relative",style:{backgroundColor:"#FFFFE0",position:"relative"},children:[(0,r.jsx)("div",{className:"absolute left-0 top-0 bottom-0",style:{width:"15px",borderLeft:"1px solid #ADD8E6"}}),(0,r.jsx)("div",{className:"absolute inset-0 pointer-events-none",style:{backgroundImage:"repeating-linear-gradient(to bottom, transparent, transparent 24px, #ADD8E6 24px, #ADD8E6 25px)",backgroundPosition:"15px 0",backgroundSize:"100% 25px"}}),(0,r.jsx)("div",{ref:g,contentEditable:!0,onInput:B,onBlur:L,onMouseDown:e=>{(e.target===e.currentTarget||e.target.isContentEditable)&&e.stopPropagation()},className:(0,y.cn)("relative z-10 w-full min-h-full","outline-none","text-black","whitespace-pre-wrap","break-words","select-text"),style:{paddingLeft:"20px",paddingRight:"15px",paddingTop:"12px",paddingBottom:"12px",fontFamily:"system-ui, -apple-system, sans-serif",fontSize:"14px",lineHeight:"25px",color:"#000000",minHeight:"100%",userSelect:"text",WebkitUserSelect:"text"}}),i&&(0,r.jsx)("div",{className:"absolute top-2 right-2 z-20",children:(0,r.jsx)(eI,{status:I,size:"sm"})})]})]})},stopwatch:function(e){let{id:t,onUpdate:n,onSelectElement:o,isSelected:s}=e,[l,i]=(0,a.useState)(0),[c,d]=(0,a.useState)(!1),u=(0,a.useRef)(null);(0,a.useEffect)(()=>(c?u.current=setInterval(()=>{i(e=>e+10)},10):u.current&&(clearInterval(u.current),u.current=null),()=>{u.current&&clearInterval(u.current)}),[c]);let p=(0,a.useCallback)(()=>{d(!0)},[]),m=(0,a.useCallback)(()=>{d(!1)},[]),h=(0,a.useCallback)(()=>{n(t,{hidden:!0})},[t,n]);return(0,r.jsxs)("div",{className:"bg-black text-white rounded-lg p-4 flex flex-col items-center justify-center gap-2 shadow-lg relative",style:{width:"100%",height:"100%"},onClick:()=>o(t,!1),children:[(0,r.jsx)(j.z,{size:"icon",variant:"ghost",className:"absolute top-2 right-2 h-6 w-6 text-white hover:bg-gray-800 hover:text-white p-0",onClick:e=>{e.stopPropagation(),h()},children:(0,r.jsx)(em.Z,{className:"h-4 w-4"})}),(0,r.jsx)("div",{className:"text-3xl font-mono font-bold",children:(e=>{let t=Math.floor(e/1e3);return"".concat(Math.floor(t/60).toString().padStart(2,"0"),":").concat((t%60).toString().padStart(2,"0"),".").concat(Math.floor(e%1e3/10).toString().padStart(2,"0"))})(l)}),(0,r.jsx)("div",{className:"flex gap-2",children:c?(0,r.jsx)(j.z,{size:"icon",variant:"outline",className:"bg-white text-black hover:bg-gray-200 h-7 w-7",onClick:e=>{e.stopPropagation(),m()},children:(0,r.jsx)(tj.Z,{className:"h-3 w-3"})}):(0,r.jsx)(j.z,{size:"icon",variant:"outline",className:"bg-white text-black hover:bg-gray-200 h-7 w-7",onClick:e=>{e.stopPropagation(),p()},children:(0,r.jsx)(ty.Z,{className:"h-3 w-3"})})})]})},countdown:function(e){let{id:t,onUpdate:n,onSelectElement:o,isSelected:s}=e,[l,i]=(0,a.useState)(0),[c,d]=(0,a.useState)(!1),[u,p]=(0,a.useState)(5),[m,h]=(0,a.useState)(!1),g=(0,a.useRef)(null);(0,a.useEffect)(()=>(c&&l>0?g.current=setInterval(()=>{i(e=>e<=1e3?(d(!1),h(!0),setTimeout(()=>h(!1),5e3),0):e-1e3)},1e3):g.current&&(clearInterval(g.current),g.current=null),()=>{g.current&&clearInterval(g.current)}),[c,l]);let f=(0,a.useCallback)(()=>{0===l&&i(6e4*u),d(!0)},[l,u]),x=(0,a.useCallback)(()=>{d(!1)},[]),v=(0,a.useCallback)(()=>{n(t,{hidden:!0})},[t,n]);return(0,r.jsxs)("div",{className:"bg-black text-white rounded-lg p-4 flex flex-col items-center justify-center gap-2 shadow-lg relative ".concat(m?"animate-pulse":""),style:{width:"100%",height:"100%"},onClick:()=>o(t,!1),children:[(0,r.jsx)(j.z,{size:"icon",variant:"ghost",className:"absolute top-2 right-2 h-6 w-6 text-white hover:bg-gray-800 hover:text-white p-0",onClick:e=>{e.stopPropagation(),v()},children:(0,r.jsx)(em.Z,{className:"h-4 w-4"})}),0!==l||c?(0,r.jsx)("div",{className:"text-3xl font-mono font-bold",children:(e=>{let t=Math.floor(e/1e3);return"".concat(Math.floor(t/60).toString().padStart(2,"0"),":").concat((t%60).toString().padStart(2,"0"))})(l)}):(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)("div",{className:"text-sm mb-2",children:"Seleccionar tiempo:"}),(0,r.jsx)("div",{className:"grid grid-cols-3 gap-1",children:tN.map(e=>(0,r.jsxs)(j.z,{size:"sm",variant:u===e?"default":"outline",className:u===e?"bg-white text-black":"bg-gray-800 text-white",onClick:t=>{t.stopPropagation(),p(e)},children:[e,"m"]},e))})]}),(0,r.jsx)("div",{className:"flex gap-2",children:c?(0,r.jsx)(j.z,{size:"icon",variant:"outline",className:"bg-white text-black hover:bg-gray-200 h-7 w-7",onClick:e=>{e.stopPropagation(),x()},children:(0,r.jsx)(tj.Z,{className:"h-3 w-3"})}):(0,r.jsx)(j.z,{size:"icon",variant:"outline",className:"bg-white text-black hover:bg-gray-200 h-7 w-7",onClick:e=>{e.stopPropagation(),f()},children:(0,r.jsx)(ty.Z,{className:"h-3 w-3"})})})]})},"highlight-text":function(e){let{id:t,content:n,properties:o,onUpdate:s,onSelectElement:l,isSelected:i,isListening:c,liveTranscript:d,finalTranscript:u,interimTranscript:p}=e,[m,h]=(0,a.useState)((null==n?void 0:n.text)||""),[g,f]=(0,a.useState)((null==o?void 0:o.backgroundColor)||tC[0].value);(0,a.useRef)(null);let x=(0,a.useRef)(null);eZ({elementRef:x,isListening:c||!1,liveTranscript:d||"",finalTranscript:u||"",interimTranscript:p||"",isSelected:i||!1,enabled:!0}),(0,a.useEffect)(()=>{(null==n?void 0:n.text)!==m&&h((null==n?void 0:n.text)||""),(null==o?void 0:o.backgroundColor)!==g&&f((null==o?void 0:o.backgroundColor)||tC[0].value)},[n,null==o?void 0:o.backgroundColor]);let v=(0,a.useCallback)(e=>{let r=e.currentTarget.textContent||"";h(r),s(t,{content:{...n,text:r}})},[t,n,s]),b=(0,a.useCallback)(e=>{f(e),s(t,{properties:{...o,backgroundColor:e}})},[t,o,s]);return(0,r.jsxs)("div",{className:"rounded-lg p-4 shadow-lg",style:{width:"100%",height:"100%",backgroundColor:g,border:i?"2px solid #3b82f6":"1px solid #e5e7eb"},onClick:()=>l(t,!1),children:[i&&(0,r.jsx)("div",{className:"mb-2 flex gap-1 flex-wrap",children:tC.map(e=>(0,r.jsx)("button",{className:"w-6 h-6 rounded border border-gray-300 hover:scale-110 transition-transform",style:{backgroundColor:e.value},onClick:t=>{t.stopPropagation(),b(e.value)},title:e.label},e.name))}),(0,r.jsx)(e7(),{innerRef:x,html:m,onChange:v,className:"outline-none min-h-[100px] w-full",style:{backgroundColor:"transparent"}})]})}},tk=e=>{var t,n;if("object"==typeof e.properties&&null!==e.properties&&"position"in e.properties&&"size"in e.properties&&"zIndex"in e.properties)return e;let r="object"==typeof e.properties&&null!==e.properties?e.properties:{},a="x"in e?e.x:void 0,o="y"in e?e.y:void 0,s="width"in e?e.width:void 0,l="height"in e?e.height:void 0,i="zIndex"in e?e.zIndex:void 0;return{...e,properties:{position:r.position||{x:a||100,y:o||100},size:r.size||{width:s||200,height:l||150},zIndex:null!==(n=null!==(t=r.zIndex)&&void 0!==t?t:i)&&void 0!==n?n:1,rotation:r.rotation||0,...r}}};function tz(e){var t,n,o,s;let{element:l,allElements:i,scale:c,offset:d={x:0,y:0},isSelected:u,updateElement:p,unanchorElement:m,deleteElement:h,onFormatToggle:g,onChangeNotepadFormat:f,onLocateElement:x,onSelectElement:v,onBringToFront:b,onSendToBack:w,onMoveBackward:N,onEditElement:C,onGroupElements:E,addElement:k,activatedElementId:z,onActivateDrag:T,onEditComment:S,onDuplicateElement:D,onUngroup:I,setIsDirty:P,boardId:F,isListening:A,liveTranscript:B,finalTranscript:L="",interimTranscript:Z=""}=e,O=tk(l),[U,H]=(0,a.useState)(!1),_="object"==typeof O.properties&&null!==O.properties?O.properties:{},W=O.parentId&&_.relativePosition?_.relativePosition:_.position||{x:O.x||0,y:O.y||0},K=_.size||{width:O.width||200,height:O.height||150},q=null!==(n=null!==(t=_.rotation)&&void 0!==t?t:O.rotation)&&void 0!==n?n:0,V=null!==(s=null!==(o=_.zIndex)&&void 0!==o?o:O.zIndex)&&void 0!==s?s:1,G={width:"number"==typeof K.width&&K.width>0?K.width:200,height:"number"==typeof K.height&&K.height>0?K.height:150},Y=(0,a.useCallback)((e,t)=>{var n,r,a,o,s,l;let c={x:t.x,y:t.y},d="object"==typeof O.properties&&null!==O.properties?O.properties:{};if("container"!==O.type){let t=e.clientX||(null===(r=e.touches)||void 0===r?void 0:null===(n=r[0])||void 0===n?void 0:n.clientX)||0,l=e.clientY||(null===(o=e.touches)||void 0===o?void 0:null===(a=o[0])||void 0===a?void 0:a.clientY)||0,u=t,m=l;if(!u||!m){let e=document.querySelector('[data-element-id="'.concat(O.id,'"]'));if(e){let t=e.getBoundingClientRect();u=t.left+t.width/2,m=t.top+t.height/2}}for(let e of[{x:u,y:m},{x:u-10,y:m},{x:u+10,y:m},{x:u,y:m-10},{x:u,y:m+10}]){let t=document.elementFromPoint(e.x,e.y);if(t){let n=t.closest('[data-element-type="container"]');if(n){let t=n.getAttribute("data-element-id");if(t&&t!==O.id){let r=i.find(e=>e.id===t&&"container"===e.type);if(r){let a=r.content,o=n.getBoundingClientRect(),l=e.x,i=e.y;if(l>=o.left&&l<=o.right&&i>=o.top&&i<=o.bottom&&a&&!(null===(s=a.elementIds)||void 0===s?void 0:s.includes(O.id))){let e=[...a.elementIds||[],O.id];p(r.id,{content:{...a,elementIds:e}}),p(O.id,{parentId:r.id,hidden:!0,properties:{...d,position:c}}),console.log("✅ Elemento guardado en contenedor:",{elementId:O.id,containerId:t,dropX:l,dropY:i,containerRect:o});return}}}}}}}if(O.parentId){let e=i.find(e=>e.id===O.parentId);if(e&&"container"===e.type){let t=e.content;if(t&&(null===(l=t.elementIds)||void 0===l?void 0:l.includes(O.id))){let n=t.elementIds.filter(e=>e!==O.id);p(e.id,{content:{...t,elementIds:n}})}}p(O.id,{parentId:void 0,hidden:!1,properties:{...d,position:c}})}else p(O.id,{properties:{...d,position:c}})},[O,i,p,G]),X=(0,a.useCallback)((e,t,n,r,a)=>{let o="object"==typeof O.properties&&null!==O.properties?O.properties:{},s={width:parseFloat(n.style.width),height:parseFloat(n.style.height)},l=O.parentId?a:{x:a.x,y:a.y},i={properties:{...o,size:s,...O.parentId?{relativePosition:l}:{position:l}}};p(O.id,i)},[O,p]),Q=(0,a.useCallback)(e=>{e.stopPropagation(),e.preventDefault(),H(!0)},[]),$=(0,a.useCallback)(()=>{h&&h(O.id),H(!1)},[h,O.id]),ee=tE[O.type];if(!ee)return console.warn("ElementComponent no encontrado para tipo: ".concat(O.type)),null;if(!G||"number"!=typeof G.width||"number"!=typeof G.height)return console.warn("Tama\xf1o inv\xe1lido para elemento ".concat(O.id,":"),G),null;let et={style:{zIndex:V,border:u?"2px solid hsl(var(--primary))":"none",boxSizing:"border-box",transform:"rotate(".concat(q,"deg)"),transformOrigin:"center center"},size:{width:G.width,height:G.height},position:W,onDragStop:Y,onResizeStop:X,minWidth:50,minHeight:50,dragHandleClassName:"drag-handle",className:(0,y.cn)("focus:outline-none"),onMouseDown:e=>{v(O.id,e.altKey||e.shiftKey||e.metaKey||e.ctrlKey)},enableResizing:!0,scale:c,bounds:O.parentId&&"container"!==O.type?'[data-element-id="'.concat(O.parentId,'"]'):void 0};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(M.s,{...et,children:(0,r.jsxs)("div",{"data-element-id":O.id,"data-element-type":O.type,className:"w-full h-full relative group",children:[u&&(0,r.jsx)(j.z,{variant:"destructive",size:"icon",className:"absolute -top-3 -right-3 z-50 h-8 w-8 rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-opacity",onClick:Q,onMouseDown:e=>e.stopPropagation(),children:(0,r.jsx)(R.Z,{className:"h-4 w-4"})}),(0,r.jsx)(ee,{id:O.id,type:O.type,x:W.x,y:W.y,width:K.width,height:K.height,rotation:q,zIndex:V,content:O.content,properties:O.properties,color:O.color,backgroundColor:O.backgroundColor,hidden:O.hidden,minimized:"notepad"===O.type?O.minimized:void 0,tags:"sticky"===O.type?O.tags:void 0,parentId:O.parentId,isSelected:u,onUpdate:p,deleteElement:h,onSelectElement:v,onEditElement:C,onFormatToggle:g,onChangeNotepadFormat:f,onLocateElement:x,allElements:i,onBringToFront:b,onSendToBack:w,onMoveBackward:N,onGroupElements:E,addElement:k,activatedElementId:z,onActivateDrag:T,onEditComment:S,onDuplicateElement:D,onUngroup:()=>I(O.id),setIsDirty:()=>{},scale:c,offset:d,boardId:F,isListening:A,liveTranscript:B,finalTranscript:L,interimTranscript:Z,..."container"===O.type&&{unanchorElement:m}})]})}),(0,r.jsx)(J,{isOpen:U,onOpenChange:H,onConfirm:$})]})}function tT(e){return"number"!=typeof e.x||"number"!=typeof e.y||"number"!=typeof e.width||"number"!=typeof e.height?null:{x:e.x+e.width/2,y:e.y+e.height/2}}function tS(e){let{allElements:t,isSelected:n,content:a,scale:o,offset:s,onSelectElement:l,id:i}=e,{fromElementId:c,toElementId:d,label:u,color:p}=a;if(!c||!d||!t)return null;let m=t.find(e=>e.id===c),h=t.find(e=>e.id===d);if(!m||!h)return null;let g=tT(m),f=tT(h);if(!g||!f)return null;let x=g.x*o+((null==s?void 0:s.x)||0),v=g.y*o+((null==s?void 0:s.y)||0),b=f.x*o+((null==s?void 0:s.x)||0),w=f.y*o+((null==s?void 0:s.y)||0);return(0,r.jsxs)("g",{className:(0,y.cn)("connector",{selected:n}),onMouseDown:e=>l(i,e.shiftKey||e.ctrlKey||e.metaKey),children:[(0,r.jsx)("line",{x1:x,y1:v,x2:b,y2:w,stroke:p||"hsl(var(--foreground))",strokeWidth:2,markerEnd:"url(#arrowhead)"}),u&&(0,r.jsx)("text",{x:(x+b)/2,y:(v+w)/2,fill:p||"hsl(var(--foreground))",textAnchor:"middle",dominantBaseline:"middle",fontSize:"12",className:"pointer-events-none",children:u})]})}let tD=(0,a.forwardRef)((e,t)=>{let{elements:n,board:o,selectedElementIds:s,onSelectElement:l,updateElement:i,unanchorElement:c,deleteElement:d,onBringToFront:u,onSendToBack:p,onMoveBackward:m,onFormatToggle:h,onChangeNotepadFormat:g,onLocateElement:f,onGoToHome:x,onCenterView:v,onEditElement:b,onGroupElements:w,addElement:j,saveLastView:N,selectedElement:C,activatedElementId:E,onActivateDrag:k,onEditComment:z,onDuplicateElement:T,onUngroup:S,setIsDirty:D,isMobile:I,isListening:R,liveTranscript:M,finalTranscript:F,interimTranscript:A}=e,[B,L]=(0,a.useState)(1),[Z,O]=(0,a.useState)(null),[U,H]=(0,a.useState)(!1),_=(0,a.useRef)(null),W=(0,a.useRef)(null),K=(0,a.useMemo)(()=>{if(0===n.length)return{width:window.innerWidth+2e3,height:window.innerHeight+2e3};let e=0,t=0;return n.forEach(n=>{let r="number"==typeof n.width?n.width:parseFloat(n.width||"0"),a="number"==typeof n.height?n.height:parseFloat(n.height||"0");isFinite(r)&&isFinite(a)&&(e=Math.max(e,n.x+r),t=Math.max(t,n.y+a))}),{width:Math.max(e+2e3,window.innerWidth),height:Math.max(t+2e3,window.innerHeight)}},[n]),q=(0,a.useRef)(Z),J=(0,a.useRef)(N),V=(0,a.useRef)(_.current);(0,a.useEffect)(()=>{q.current=Z,J.current=N,V.current=_.current},[Z,N]);let G=(0,a.useCallback)(e=>{let t=q.current,n=V.current;if(t&&n&&(e.preventDefault(),t.isPanning)){let r=e.clientX-t.startPoint.x,a=e.clientY-t.startPoint.y;n.scrollLeft=t.initialScroll.x-.7*r,n.scrollTop=t.initialScroll.y-.7*a}},[]),Y=(0,a.useCallback)(()=>{q.current&&J.current(),O(null)},[]);(0,a.useEffect)(()=>(Z?(window.addEventListener("mousemove",G),window.addEventListener("mouseup",Y)):(window.removeEventListener("mousemove",G),window.removeEventListener("mouseup",Y)),()=>{window.removeEventListener("mousemove",G),window.removeEventListener("mouseup",Y)}),[Z,G,Y]);let X=(0,a.useCallback)(e=>{e.scrollLeft=0,e.scrollTop=0,(0!==e.scrollLeft||0!==e.scrollTop)&&e.scrollTo(0,0)},[]),Q=(0,a.useCallback)(()=>{let e=_.current;e&&(L(I?.3:1),requestAnimationFrame(()=>{e&&X(e)}))},[I,X]);(0,a.useEffect)(()=>{let e=_.current;if(!e)return;L(I?.3:1),X(e),requestAnimationFrame(()=>{e&&X(e)});let t=setTimeout(()=>{e&&(0!==e.scrollLeft||0!==e.scrollTop)&&(console.warn("⚠️ Scroll no est\xe1 en (0,0), forzando correcci\xf3n..."),X(e))},100),n=setTimeout(()=>{e&&(0!==e.scrollLeft||0!==e.scrollTop)&&(console.warn("⚠️ Scroll a\xfan no est\xe1 en (0,0) despu\xe9s de 500ms, forzando correcci\xf3n final..."),X(e))},500);return()=>{clearTimeout(t),clearTimeout(n)}},[o.id,I,X]);let $=(0,a.useCallback)(()=>{if(!_.current)return{x:window.innerWidth/2,y:window.innerHeight/2};let{scrollLeft:e,scrollTop:t,clientWidth:n,clientHeight:r}=_.current,a=(e+n/2)/B,o=(t+r/2)/B;return{x:Math.max(n/(2*B),a),y:Math.max(r/(2*B),o)}},[B]),ee=(0,a.useCallback)((e,t)=>{let n=_.current;if(!n)return;e=Math.max(.1,Math.min(e,5));let{clientWidth:r,clientHeight:a,scrollLeft:o,scrollTop:s}=n,l=t||{x:r/2,y:a/2},i=o+l.x,c=s+l.y,d=i*e/B-l.x,u=c*e/B-l.y;L(e),requestAnimationFrame(()=>{n.scrollLeft=d,n.scrollTop=u})},[B]),et=(0,a.useCallback)((e,t)=>{let n=_.current;if(!n)return;let r=t?Math.max(.1,Math.min(t,5)):B,{clientWidth:a,clientHeight:o}=n,s=e.x*r-a/2,l=e.y*r-o/2;t&&L(r),requestAnimationFrame(()=>{n.scrollTo({left:s,top:l,behavior:"smooth"})})},[B]),en=(0,a.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(!e)return;let n="number"==typeof e.width?e.width:parseFloat(e.width||"0"),r="number"==typeof e.height?e.height:parseFloat(e.height||"0");et({x:e.x+n/2,y:e.y+r/2},t)},[et]),er=(0,a.useCallback)(e=>{if(!n||0===n.length){Q();return}let t=1/0,r=1/0,a=-1/0,o=-1/0;n.forEach(e=>{let n="number"==typeof e.width?e.width:parseFloat(e.width||"0"),s="number"==typeof e.height?e.height:parseFloat(e.height||"0");t=Math.min(t,e.x),r=Math.min(r,e.y),a=Math.max(a,e.x+n),o=Math.max(o,e.y+s)});let s=a-t,l=o-r;if(0===s||0===l){et({x:t,y:r},1);return}_.current&&et({x:t+s/2,y:r+l/2},e?.3:.4)},[n,Q,et]),ea=()=>ee(1);(0,a.useImperativeHandle)(t,()=>({getCanvasContainer:()=>_.current,getCanvasContent:()=>W.current,getTransform:()=>{var e,t;return{scale:B,x:(null===(e=_.current)||void 0===e?void 0:e.scrollLeft)||0,y:(null===(t=_.current)||void 0===t?void 0:t.scrollTop)||0}},getViewportCenter:$,centerOnElement:en,centerOnPoint:et,centerOnElements:er,resetZoom:ea,goToHome:Q,activatePanMode:()=>(H(e=>!e),U)}),[U]),(0,a.useEffect)(()=>{let e=_.current;if(!e)return;let t=t=>{t.ctrlKey||t.metaKey?(t.preventDefault(),ee(B+(t.deltaY>0?-.1:.1),{x:t.clientX,y:t.clientY})):t.altKey&&(t.preventDefault(),e.scrollLeft-=t.deltaX,e.scrollTop-=t.deltaY)},n=t=>{1===t.button&&(t.preventDefault(),O({isPanning:!0,startPoint:{x:t.clientX,y:t.clientY},initialScroll:{x:e.scrollLeft,y:e.scrollTop}}))},r=e=>{var t,n,r;"Space"!==e.code||e.repeat||(null===(t=document.activeElement)||void 0===t?void 0:t.tagName)==="INPUT"||(null===(n=document.activeElement)||void 0===n?void 0:n.tagName)==="TEXTAREA"||(null===(r=document.activeElement)||void 0===r?void 0:r.isContentEditable)||(e.preventDefault(),H(!0))},a=e=>{"Space"===e.code&&(e.preventDefault(),H(!1))};return e.addEventListener("wheel",t,{passive:!1}),e.addEventListener("mousedown",n),window.addEventListener("keydown",r),window.addEventListener("keyup",a),()=>{e.removeEventListener("wheel",t),e.removeEventListener("mousedown",n),window.removeEventListener("keydown",r),window.removeEventListener("keyup",a)}},[B,ee]);let eo=(0,a.useMemo)(()=>n.filter(e=>"connector"!==e.type),[n]),es=(0,a.useMemo)(()=>n.filter(e=>"connector"===e.type),[n]),el=(0,a.useMemo)(()=>n,[n]),ei=(0,a.useRef)({x:0,y:0}),[ec,ed]=(0,a.useState)({x:0,y:0}),eu=(0,a.useRef)(null);return(0,a.useEffect)(()=>{let e=_.current;if(!e)return;let t=()=>{eu.current&&clearTimeout(eu.current),eu.current=setTimeout(()=>{let t={x:e.scrollLeft||0,y:e.scrollTop||0},n=Math.abs(t.x-ei.current.x),r=Math.abs(t.y-ei.current.y);(n>10||r>10)&&(ei.current=t,ed(t))},50)};return e.addEventListener("scroll",t,{passive:!0}),()=>{e.removeEventListener("scroll",t),eu.current&&clearTimeout(eu.current)}},[]),(0,r.jsxs)("div",{className:"relative w-full h-screen",children:[(0,r.jsx)("div",{ref:_,className:(0,y.cn)("relative w-full h-screen overflow-auto bg-canvas-teal",U&&"cursor-grab",(null==Z?void 0:Z.isPanning)&&"cursor-grabbing"),style:{backgroundColor:"#96e4e6",backgroundImage:"radial-gradient(#ffffff 1px, transparent 0)",backgroundSize:"".concat(20*B,"px ").concat(20*B,"px")},onMouseDown:e=>{if((1===e.button||0===e.button&&e.altKey)&&_.current){e.preventDefault(),O({isPanning:!0,startPoint:{x:e.clientX,y:e.clientY},initialScroll:{x:_.current.scrollLeft,y:_.current.scrollTop}});return}if(0===e.button){let t=e.target;(t===W.current||t===_.current)&&l(null,!1)}U&&_.current&&0===e.button&&(e.preventDefault(),O({isPanning:!0,startPoint:{x:e.clientX,y:e.clientY},initialScroll:{x:_.current.scrollLeft,y:_.current.scrollTop}}))},children:(0,r.jsxs)("div",{ref:W,className:"relative canvas-content",style:{width:"".concat(K.width,"px"),height:"".concat(K.height,"px"),transform:"scale(".concat(B,")"),transformOrigin:"top left"},children:[(0,r.jsxs)("svg",{className:"absolute top-0 left-0 w-full h-full pointer-events-none",style:{width:K.width,height:K.height},children:[(0,r.jsx)("defs",{children:(0,r.jsx)("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"0",refY:"3.5",orient:"auto",children:(0,r.jsx)("polygon",{points:"0 0, 10 3.5, 0 7",fill:"hsl(var(--foreground))"})})}),es.map(e=>(0,r.jsx)(tS,{...e,scale:B,offset:ec,allElements:el,onUpdate:i,deleteElement:d,onSelectElement:l,onEditElement:b,onLocateElement:f,onEditComment:z},e.id))]}),eo.filter(e=>!e.hidden).map(e=>{let t=null==s?void 0:s.includes(e.id);return(0,r.jsx)(tz,{element:e,allElements:el,scale:B,offset:ec,isSelected:t,updateElement:i,unanchorElement:c,deleteElement:d,onFormatToggle:h,onChangeNotepadFormat:g,onLocateElement:f,onSelectElement:l,onBringToFront:u,onSendToBack:p,onMoveBackward:m,onEditElement:b,onGroupElements:w,addElement:j,activatedElementId:E,onActivateDrag:k,onEditComment:z,onDuplicateElement:T,onUngroup:S,setIsDirty:D,boardId:o.id,isListening:R,liveTranscript:M,finalTranscript:F,interimTranscript:A},e.id)})]})}),(0,r.jsx)(P,{zoomIn:()=>ee(B+.1),zoomOut:()=>ee(B-.1),resetZoom:ea,scale:B,centerOnElements:er,goToHome:Q,selectedElement:C,onBringToFront:u,onSendToBack:p,onMoveBackward:m,isMobile:I})]})});tD.displayName="Canvas";var tI=n(43335),tP=n(39702),tR=n(157),tM=n(85291),tF=n(9172),tA=n(73254),tB=n(53927),tL=n(47054),tZ=n(87928),tO=n(24739),tU=n(81475),tH=n(17789),t_=n(55672),tW=n(3683),tK=n(33931),tq=n(71077);class tJ extends Error{withUser(e){return new tJ(this.context,e)}constructor(e,t=null){super("Firestore Permission Denied: The following request was denied by Firestore Security Rules:\n".concat(JSON.stringify({auth:t?function(e){var t;let n=e.providerData||[];return{uid:e.uid,token:{name:e.displayName,picture:e.photoURL,email:e.email,email_verified:e.emailVerified,phone_number:e.phoneNumber,firebase:{identities:n.reduce((e,t)=>(t.providerId&&(e[t.providerId]=[t.uid]),e),{}),sign_in_provider:e.isAnonymous?"anonymous":(null===(t=n[0])||void 0===t?void 0:t.providerId)||"custom"}}}}(t):null,method:e.operation,path:"/databases/(default)/documents/".concat(e.path),request:e.requestResourceData?{data:e.requestResourceData}:void 0},null,2))),this.name="FirestorePermissionError",this.context=e,this.user=t,Object.setPrototypeOf(this,tJ.prototype)}}function tV(e){let{isOpen:t,onOpenChange:n}=e,[s,i]=(0,a.useState)(""),[d,u]=(0,a.useState)(!1),p=(0,l.CU)(),{user:m}=(0,l.aF)();(0,o.useRouter)();let{toast:g}=(0,h.pm)(),f=async()=>{if(!p||!m||!s.trim()){g({variant:"destructive",title:"Error",description:"El nombre del tablero no puede estar vac\xedo."});return}u(!0);let e=(0,c.hJ)(p,"users",m.uid,"canvasBoards"),t={name:s,userId:m.uid,createdAt:(0,c.Bt)(),updatedAt:(0,c.Bt)()};try{await (0,c.ET)(e,t),g({title:"Tablero Creado",description:'Se ha creado el tablero "'.concat(s,'".')}),n(!1),i("")}catch(n){console.error("Error creating new board:",n),m&&tq.s.emit("permission-error",new tJ({path:e.path,operation:"create",requestResourceData:t},m))}finally{u(!1)}};return(0,r.jsx)(eR.Vq,{open:t,onOpenChange:n,children:(0,r.jsxs)(eR.cZ,{children:[(0,r.jsxs)(eR.fK,{children:[(0,r.jsx)(eR.$N,{children:"Crear Nuevo Tablero"}),(0,r.jsx)(eR.Be,{children:"Dale un nombre a tu nuevo lienzo de ideas."})]}),(0,r.jsx)("div",{className:"grid gap-4 py-4",children:(0,r.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,r.jsx)(eA._,{htmlFor:"boardName",className:"text-right",children:"Nombre"}),(0,r.jsx)(eY.I,{id:"boardName",name:"boardName",value:s,onChange:e=>i(e.target.value),className:"col-span-3",placeholder:"Ej: Ideas para mi proyecto",onKeyDown:e=>"Enter"===e.key&&f()})]})}),(0,r.jsxs)(eR.cN,{children:[(0,r.jsx)(j.z,{variant:"ghost",onClick:()=>n(!1),children:"Cancelar"}),(0,r.jsx)(j.z,{onClick:f,disabled:!s.trim()||d,children:d?"Creando...":"Crear Tablero"})]})]})})}let tG=[{name:"yellow",label:"Amarillo",className:"bg-yellow-200"},{name:"pink",label:"Rosa",className:"bg-pink-200"},{name:"blue",label:"Azul",className:"bg-blue-200"},{name:"green",label:"Verde",className:"bg-green-200"},{name:"orange",label:"Naranja",className:"bg-orange-200"},{name:"purple",label:"Morado",className:"bg-purple-200"}],tY=(0,a.forwardRef)((e,t)=>{let{label:n,icon:a,className:o,isActive:s,children:l,...i}=e,c=null==o?void 0:o.includes("bg-red-500");return(0,r.jsxs)(j.z,{ref:t,variant:"ghost",className:(0,y.cn)("flex flex-col items-center justify-center h-auto py-2 px-2 w-full text-[11px] gap-1","hover:bg-white/20 focus-visible:bg-white/20","text-white border border-white",s&&"bg-white/30 text-white hover:bg-white/40",!c&&"text-white",o),style:{backgroundColor:c?void 0:s?"rgba(255, 255, 255, 0.3)":"transparent",color:c?void 0:"#FFFFFF",border:"1px solid #FFFFFF"},...i,children:[l||a&&(0,r.jsx)(a,{className:(0,y.cn)("size-[18px]","text-white"),style:c?void 0:{color:"#FFFFFF"}}),(0,r.jsx)("span",{className:(0,y.cn)("mt-0.5 text-center leading-tight text-[9px]","text-white"),style:c?void 0:{color:"#FFFFFF",fontSize:"9px"},children:n})]})});tY.displayName="SidebarButton";let tX=e=>{let{comments:t,onLocateElement:n}=e,[o,s]=(0,a.useState)(""),l=(0,a.useMemo)(()=>o?t.filter(e=>{let t=e.content;return((null==t?void 0:t.label)||(null==t?void 0:t.title)||(null==t?void 0:t.text)||"").toLowerCase().includes(o.toLowerCase())}):t,[t,o]);return(0,r.jsxs)(ex,{children:[(0,r.jsx)(ev,{asChild:!0,children:(0,r.jsx)(tY,{icon:e4.Z,label:"Localizadores"})}),(0,r.jsx)(ej,{side:"right",align:"start",sideOffset:5,className:"w-64",children:t.length>0?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"px-2 py-1.5 border-b",children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(tr.Z,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,r.jsx)("input",{type:"text",placeholder:"Buscar localizador...",value:o,onChange:e=>s(e.target.value),className:"w-full pl-8 pr-2 py-1.5 text-sm border rounded focus:outline-none focus:ring-2 focus:ring-primary",onClick:e=>e.stopPropagation()})]})}),(0,r.jsx)("div",{className:"max-h-64 overflow-y-auto",children:l.length>0?l.map(e=>{let t=e.content,a=(null==t?void 0:t.label)||(null==t?void 0:t.title)||(null==t?void 0:t.text)||"Sin nombre";return(0,r.jsxs)(eN,{onClick:()=>n(e.id),className:"cursor-pointer",children:[(0,r.jsx)(tt.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{className:"truncate",children:a})]},e.id)}):(0,r.jsx)(eN,{disabled:!0,children:(0,r.jsx)("span",{className:"text-muted-foreground",children:"No se encontraron localizadores"})})})]}):(0,r.jsx)(eN,{disabled:!0,children:(0,r.jsx)("span",{className:"text-muted-foreground",children:"No hay localizadores"})})})]})};function tQ(e){let{elements:t,boards:n,onUploadImage:s,onAddImageFromUrl:i,onPanToggle:c,isListening:d=!1,onToggleDictation:u,onRenameBoard:p,onDeleteBoard:m,onOpenNotepad:f,onLocateElement:x,addElement:v,clearCanvas:b,onExportBoardToPng:w,onFormatToggle:j,isFormatToolbarOpen:N,isPanningActive:C=!1}=e,E=(0,l.aC)(),{toast:k}=(0,h.pm)(),z=(0,o.useRouter)();g("(max-width: 768px)");let[S,D]=(0,a.useState)(!1),[I,P]=(0,a.useState)({x:20,y:80});(0,a.useEffect)(()=>{try{let e=localStorage.getItem("toolsSidebarPosition");e&&P(JSON.parse(e))}catch(e){console.error("Failed to load sidebar position from localStorage",e)}},[]);let F=(0,a.useMemo)(()=>(Array.isArray(t)?t:[]).filter(e=>"notepad"===e.type||"notepad-simple"===e.type||"test-notepad"===e.type),[t]),L=(0,a.useMemo)(()=>(Array.isArray(F)?F:[]).filter(e=>!0!==e.hidden),[F]),Z=(0,a.useMemo)(()=>(Array.isArray(F)?F:[]).filter(e=>!0===e.hidden),[F]),J=(0,a.useMemo)(()=>(Array.isArray(t)?t:[]).filter(e=>{if("comment"!==e.type)return!1;let t=e.content;return!!t&&(!!t.title||!!t.label||!!t.text)}),[t]),V=async(e,t)=>{try{await v(e,t),k({title:"Elemento creado",description:"Se ha creado un nuevo ".concat(e,".")})}catch(t){console.error("Error al crear elemento ".concat(e,":"),t),k({variant:"destructive",title:"Error",description:t.message||"No se pudo crear el elemento ".concat(e,".")})}},G=async()=>{if(E)try{await (0,tK.w7)(E),k({title:"Sesi\xf3n Cerrada",description:"Has cerrado sesi\xf3n correctamente."}),z.push("/?logout=true")}catch(e){console.error("Error al cerrar sesi\xf3n:",e),k({variant:"destructive",title:"Error",description:"No se pudo cerrar la sesi\xf3n."})}};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(tV,{isOpen:S,onOpenChange:D}),(0,r.jsx)(M.s,{default:{x:I.x,y:I.y,width:144,height:"auto"},minWidth:144,maxWidth:144,bounds:"window",dragHandleClassName:"drag-handle",onDragStop:(e,t)=>{let n={x:t.x,y:t.y};P(n);try{localStorage.setItem("toolsSidebarPosition",JSON.stringify(n))}catch(e){console.error("Failed to save sidebar position to localStorage",e)}},className:"z-[10001]",children:(0,r.jsxs)("div",{className:"rounded-lg shadow-lg border border-white/30 p-2 flex flex-col gap-1",style:{backgroundColor:"#0b8384"},children:[(0,r.jsx)("div",{className:"drag-handle cursor-grab active:cursor-grabbing py-1 flex justify-center",children:(0,r.jsx)(et.Z,{className:"size-5",style:{color:"#FFFFFF"}})}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-1",children:[(0,r.jsxs)(ex,{children:[(0,r.jsx)(ev,{asChild:!0,children:(0,r.jsx)(tY,{icon:tI.Z,label:"Tableros"})}),(0,r.jsxs)(ej,{side:"right",align:"start",sideOffset:5,children:[(0,r.jsxs)(eN,{onClick:()=>D(!0),children:[(0,r.jsx)(ee.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:"Nuevo Tablero"})]}),(0,r.jsxs)(eN,{onClick:m,className:"text-destructive",children:[(0,r.jsx)(R.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:"Eliminar Tablero"})]}),(0,r.jsx)(eC,{}),n.length>0&&(0,r.jsxs)(eb,{children:[(0,r.jsx)(ew,{children:(0,r.jsx)("span",{children:"Abrir Tablero..."})}),(0,r.jsx)(ey,{children:n.map(e=>(0,r.jsx)(eN,{onClick:()=>z.push("/board/".concat(e.id)),children:(0,r.jsx)("span",{children:e.name||"Sin nombre"})},e.id))})]})]})]}),(0,r.jsx)(tY,{icon:tP.Z,label:d?"Detener":"Dictar",onClick:u,onMouseDown:e=>e.preventDefault(),className:(0,y.cn)(d&&"bg-red-500 text-white hover:bg-red-600 animate-pulse")}),(0,r.jsxs)(ex,{children:[(0,r.jsx)(ev,{asChild:!0,children:(0,r.jsx)(tY,{icon:tR.Z,label:"Cuadernos"})}),(0,r.jsxs)(ej,{side:"right",align:"start",sideOffset:5,children:[(0,r.jsxs)(eN,{onClick:()=>V("notepad"),children:[(0,r.jsx)(ee.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:"Agregar notepad"})]}),(0,r.jsxs)(eN,{onClick:()=>V("yellow-notepad"),children:[(0,r.jsx)(ee.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:"Nuevo Notepad Yellow"})]}),(0,r.jsxs)(eN,{onClick:()=>x("rzBhqCTd8wwZmD8JCNEk"),children:[(0,r.jsx)(ee.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:"Nuevo Block de Notas"})]}),L.length>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eC,{}),(0,r.jsxs)(eb,{children:[(0,r.jsx)(ew,{children:(0,r.jsxs)("span",{children:["Cuadernos Abiertos (",L.length,")"]})}),(0,r.jsx)(ey,{children:L.map(e=>{let t=e.content,n=(null==t?void 0:t.title)||"Sin t\xedtulo";return(0,r.jsx)(eN,{onClick:()=>x(e.id),children:(0,r.jsx)("span",{children:n})},e.id)})})]})]}),Z.length>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eC,{}),(0,r.jsxs)(eb,{children:[(0,r.jsx)(ew,{children:(0,r.jsxs)("span",{children:["Cerrados (",Z.length,")"]})}),(0,r.jsx)(ey,{children:Z.map(e=>{let t=e.content,n=(null==t?void 0:t.title)||"Sin t\xedtulo";return(0,r.jsxs)(eN,{onClick:()=>f(e.id),children:[(0,r.jsx)(tM.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:n})]},e.id)})})]})]})]})]}),(0,r.jsxs)(ex,{children:[(0,r.jsx)(ev,{asChild:!0,children:(0,r.jsx)(tY,{icon:tF.Z,label:"Notas"})}),(0,r.jsx)(ej,{side:"right",align:"start",sideOffset:5,children:tG.map(e=>(0,r.jsxs)(eN,{onClick:()=>V("sticky",{color:e.name}),children:[(0,r.jsx)("div",{className:(0,y.cn)("w-4 h-4 rounded-sm mr-2 border border-slate-300",e.className)}),(0,r.jsx)("span",{className:"capitalize",children:e.label})]},e.name))})]}),(0,r.jsx)(tY,{icon:tA.Z,label:"To-do",onClick:()=>V("todo")}),(0,r.jsx)(tY,{icon:el.Z,label:"Tools",onClick:j,isActive:N}),(0,r.jsxs)(ex,{children:[(0,r.jsx)(ev,{asChild:!0,children:(0,r.jsx)(tY,{icon:ts.Z,label:"Imagen"})}),(0,r.jsxs)(ej,{side:"right",align:"start",sideOffset:5,children:[(0,r.jsxs)(eN,{onClick:i,children:[(0,r.jsx)(e9.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:"Desde URL"})]}),(0,r.jsxs)(eN,{onClick:s,children:[(0,r.jsx)(tB.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:"Subir"})]})]})]}),(0,r.jsx)(tY,{icon:tL.Z,label:"Moodboard",onClick:()=>V("moodboard")}),(0,r.jsx)(tY,{icon:tZ.Z,label:"Bloc Tabs",onClick:()=>V("tabbed-notepad")}),(0,r.jsxs)(eH,{children:[(0,r.jsx)(e_,{asChild:!0,children:(0,r.jsx)(tY,{icon:tZ.Z,label:"Texto"})}),(0,r.jsxs)(eW,{className:"w-auto p-2",children:[(0,r.jsx)("div",{className:"text-xs text-gray-600 mb-2",children:"Color de fondo"}),(0,r.jsx)("div",{className:"grid grid-cols-4 gap-2",children:[{name:"white",value:"#ffffff",label:"Blanco"},{name:"yellow",value:"#fffb8b",label:"Amarillo"},{name:"pink",value:"#ffc2d4",label:"Rosa"},{name:"blue",value:"#bce8f1",label:"Azul"},{name:"green",value:"#d4edda",label:"Verde"},{name:"orange",value:"#ffeeba",label:"Naranja"},{name:"purple",value:"#e9d5ff",label:"Morado"}].map(e=>(0,r.jsx)("button",{className:"w-8 h-8 rounded border border-gray-300 hover:scale-110 transition-transform",style:{backgroundColor:e.value},onClick:()=>V("text",{properties:{backgroundColor:e.value}}),title:e.label},e.name))})]})]}),(0,r.jsx)(tY,{icon:T.Z,label:"Acorde\xf3n",onClick:()=>V("accordion",{content:{items:[{id:"1",title:"Nuevo Item",content:""}]},properties:{position:{x:200,y:100},size:{width:320,height:240}}})}),(0,r.jsx)(tX,{comments:J,onLocateElement:x}),(0,r.jsx)(tY,{icon:tO.Z,label:"Cron\xf3metro",onClick:()=>V("stopwatch")}),(0,r.jsx)(tY,{icon:tU.Z,label:"Temporizador",onClick:()=>V("countdown")}),(0,r.jsx)(tY,{icon:tH.Z,label:"Destacador",onClick:()=>V("highlight-text")}),(0,r.jsx)(tY,{icon:ed.Z,label:"Exportar Tablero",onClick:w}),(0,r.jsxs)(ex,{children:[(0,r.jsx)(ev,{asChild:!0,children:(0,r.jsx)(tY,{icon:t_.Z,label:"M\xe1s"})}),(0,r.jsxs)(ej,{side:"right",align:"start",sideOffset:5,children:[(0,r.jsxs)(eN,{onClick:j,children:[(0,r.jsx)(el.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:"Formato de Texto"})]}),(0,r.jsxs)(eN,{onClick:w,children:[(0,r.jsx)(ed.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:"Exportar a PNG: alta resoluci\xf3n"})]}),(0,r.jsx)(eC,{}),(0,r.jsxs)(A,{children:[(0,r.jsx)(B,{asChild:!0,children:(0,r.jsxs)(eN,{onSelect:e=>e.preventDefault(),children:[(0,r.jsx)(R.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:"Eliminar Tablero"})]})}),(0,r.jsxs)(O,{children:[(0,r.jsxs)(U,{children:[(0,r.jsx)(_,{children:"\xbfEst\xe1s seguro?"}),(0,r.jsx)(W,{children:"Esta acci\xf3n eliminar\xe1 permanentemente este tablero y todo su contenido. Esta acci\xf3n no se puede deshacer."})]}),(0,r.jsxs)(H,{children:[(0,r.jsx)(q,{children:"Cancelar"}),(0,r.jsx)(K,{onClick:m,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"S\xed, eliminar tablero"})]})]})]}),(0,r.jsxs)(A,{children:[(0,r.jsx)(B,{asChild:!0,children:(0,r.jsxs)(eN,{onSelect:e=>e.preventDefault(),children:[(0,r.jsx)(R.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:"Limpiar Tablero"})]})}),(0,r.jsxs)(O,{children:[(0,r.jsxs)(U,{children:[(0,r.jsx)(_,{children:"\xbfEst\xe1s seguro?"}),(0,r.jsx)(W,{children:"Esta acci\xf3n eliminar\xe1 todos los elementos del tablero. Esta acci\xf3n no se puede deshacer."})]}),(0,r.jsxs)(H,{children:[(0,r.jsx)(q,{children:"Cancelar"}),(0,r.jsx)(K,{onClick:b,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"S\xed, limpiar tablero"})]})]})]}),(0,r.jsx)(eC,{}),(0,r.jsxs)(eN,{onClick:G,children:[(0,r.jsx)(tW.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:"Cerrar Sesi\xf3n"})]})]})]})]})]})})]})}var t$=n(17290),t0=n(40769),t1=n(53622),t2=n(63382),t4=n(81952),t5=n(42229),t3=n(32157),t8=n(94594),t7=n(38755),t6=n(80422),t9=n(77497),ne=e=>{var t;let{isOpen:n,onClose:o,onAddComment:s,onEditComment:l,isMobileSheet:i,elements:c,onLocateElement:d,onPanToggle:u,addElement:p,isPanningActive:m=!1}=e,[h,g]=(0,a.useState)(null),[f,x]=(0,a.useState)("18px"),[v,b]=(0,a.useState)({x:0,y:0}),[w,j]=(0,a.useState)(!1),[N,C]=(0,a.useState)("");(0,a.useEffect)(()=>{if(n&&!i){let e=localStorage.getItem("formattingToolbarPosition");if(e)try{b(JSON.parse(e))}catch(e){console.error("Failed to load formatting toolbar position",e)}else b({x:(window.innerWidth-600)/2,y:20})}},[n,i]);let E=async()=>{if(p)try{await p("container",{content:{title:"Lienzo",elementIds:[]},properties:{position:{x:100,y:100},size:{width:794,height:1021},backgroundColor:"white"}})}catch(e){console.error("Error creating lienzo:",e)}},k=(e,t,n)=>{e.preventDefault();let r=window.getSelection();if(!r||0===r.rangeCount){let e=document.activeElement;e&&(e.isContentEditable||"DIV"===e.tagName)&&(e.focus(),n?document.execCommand(t,!1,n):document.execCommand(t,!1));return}n?document.execCommand(t,!1,n):document.execCommand(t,!1),g(null)},z=(e,t)=>{e.preventDefault();let n=window.getSelection();if(!n||0===n.rangeCount||n.isCollapsed)return;let r=n.getRangeAt(0),a=document.createElement("span");a.style.textDecoration="underline",a.style.textDecorationColor=t,a.style.textDecorationThickness="2px",a.appendChild(r.extractContents()),r.insertNode(a),g(null)},S=(e,t)=>{e.preventDefault(),e.stopPropagation();let n=window.getSelection();if(!n||0===n.rangeCount){let e=document.activeElement;if(e&&e.isContentEditable){let r=Array.from(e.childNodes);if(1===r.length&&r[0].nodeType===Node.ELEMENT_NODE){let n=r[0];if("SPAN"===n.tagName&&n.style.color){n.style.color=t,e.dispatchEvent(new Event("input",{bubbles:!0})),g(null);return}}let a=document.createElement("span");for(a.style.color=t;e.firstChild;)a.appendChild(e.firstChild);e.appendChild(a);let o=document.createRange();o.selectNodeContents(a),o.collapse(!1),n&&(n.removeAllRanges(),n.addRange(o)),e.dispatchEvent(new Event("input",{bubbles:!0}))}g(null);return}if(n.isCollapsed){let e=n.getRangeAt(0).commonAncestorContainer,r=e.nodeType===Node.TEXT_NODE?e.parentElement:e;if(r&&r.isContentEditable){let e=Array.from(r.childNodes);if(1===e.length&&e[0].nodeType===Node.ELEMENT_NODE){let n=e[0];if("SPAN"===n.tagName&&n.style.color){n.style.color=t,r.dispatchEvent(new Event("input",{bubbles:!0})),g(null);return}}let a=document.createElement("span");for(a.style.color=t;r.firstChild;)a.appendChild(r.firstChild);r.appendChild(a);let o=document.createRange();o.selectNodeContents(a),o.collapse(!1),n.removeAllRanges(),n.addRange(o),r.dispatchEvent(new Event("input",{bubbles:!0}))}g(null);return}let r=n.getRangeAt(0),a=document.createElement("span");a.style.color=t;try{a.appendChild(r.extractContents()),r.insertNode(a),r.setStartAfter(a),r.collapse(!0),n.removeAllRanges(),n.addRange(r);let e=document.activeElement;e&&e.dispatchEvent(new Event("input",{bubbles:!0}))}catch(e){console.error("Error aplicando color:",e)}g(null)};if(!n)return null;let D=(0,y.cn)("bg-black text-white py-1.5 px-2.5","flex items-center justify-center w-full min-h-[38px] gap-0.5","text-sm"),I=(0,y.cn)("bg-white border-none rounded-md px-2.5 py-1.5","cursor-pointer flex items-center justify-center","min-w-[29px] h-7 transition-colors","hover:bg-gray-100"),P="w-[14px] h-[14px] text-black",R=(0,y.cn)("bg-[#2a2a2a] border-none rounded","cursor-pointer flex items-center justify-center","w-7 h-7 p-1.5 transition-colors","hover:bg-[#3a3a3a]"),F=c.length>0&&(null===(t=c[0])||void 0===t?void 0:t.type)==="comment"?c[0]:null,A=(0,r.jsxs)("div",{className:D,children:[F&&l&&(0,r.jsx)("button",{className:I,onClick:e=>{e.preventDefault(),e.stopPropagation(),l(F)},title:"Fijar posici\xf3n en el tablero / Editar Etiqueta",children:(0,r.jsx)(tt.Z,{className:P})}),(0,r.jsxs)(ex,{children:[(0,r.jsx)(ev,{asChild:!0,children:(0,r.jsx)("button",{className:R,title:"M\xe1s opciones",onClick:e=>{e.preventDefault(),e.stopPropagation()},children:(0,r.jsx)(ec.Z,{className:"w-[14px] h-[14px] text-white"})})}),(0,r.jsx)(ej,{children:(0,r.jsx)(eN,{onClick:e=>{e.preventDefault(),e.stopPropagation()},children:(0,r.jsx)("span",{children:"Opciones"})})})]}),(0,r.jsx)("button",{className:I,onClick:e=>{e.preventDefault(),e.stopPropagation(),s?s():p&&p("comment",{content:{title:"Nuevo Localizador",label:"Localizador",text:""},properties:{position:{x:window.innerWidth/2,y:window.innerHeight/2},size:{width:48,height:48}}}).catch(e=>{console.error("Error al crear localizador:",e)})},title:"Crear etiqueta de posici\xf3n / Localizador",children:(0,r.jsx)(e4.Z,{className:P})}),(0,r.jsxs)(eH,{open:"fontSize"===h,onOpenChange:e=>g(e?"fontSize":null),children:[(0,r.jsx)(e_,{asChild:!0,children:(0,r.jsx)("button",{className:I,title:"Tama\xf1o de Texto",onMouseDown:e=>e.preventDefault(),children:(0,r.jsx)(t$.Z,{className:P})})}),(0,r.jsx)(eW,{className:"w-auto p-2 bg-white",onMouseDown:e=>e.preventDefault(),children:(0,r.jsx)("div",{className:"space-y-1",children:["12px","14px","16px","18px","20px","24px","32px"].map(e=>(0,r.jsx)("button",{className:"w-full text-left px-2 py-1 text-sm hover:bg-gray-100 rounded",onClick:t=>{t.preventDefault(),t.stopPropagation(),x(e);let n=window.getSelection();if(n&&n.rangeCount>0){let t=n.getRangeAt(0),r=document.createElement("span");r.style.fontSize=e;try{t.surroundContents(r)}catch(e){r.appendChild(t.extractContents()),t.insertNode(r)}}g(null)},children:e},e))})})]}),(0,r.jsx)("div",{className:"w-px h-6 bg-white/30 mx-1"}),(0,r.jsx)("button",{className:I,onClick:e=>{e.preventDefault(),e.stopPropagation();let t=window.getSelection(),n=prompt("Ingresa la URL del enlace:");if(n){if(t&&t.rangeCount>0&&!t.isCollapsed){let e=t.getRangeAt(0),r=document.createElement("a");r.href=n,r.target="_blank",r.rel="noopener noreferrer",r.appendChild(e.extractContents()),e.insertNode(r)}else{let e=document.createElement("a");e.href=n,e.target="_blank",e.rel="noopener noreferrer",e.textContent=n,document.execCommand("insertHTML",!1,e.outerHTML)}}},title:"Insertar Enlace",children:(0,r.jsx)(e9.Z,{className:P})}),(0,r.jsx)("div",{className:"w-px h-6 bg-white/30 mx-1"}),(0,r.jsxs)(eH,{open:"textColor"===h,onOpenChange:e=>g(e?"textColor":null),children:[(0,r.jsx)(e_,{asChild:!0,children:(0,r.jsx)("button",{className:I,title:"Color de Texto",onMouseDown:e=>e.preventDefault(),children:(0,r.jsx)(eq.Z,{className:P})})}),(0,r.jsxs)(eW,{className:"w-auto p-2 bg-white",onMouseDown:e=>e.preventDefault(),children:[(0,r.jsx)("div",{className:"text-xs text-gray-600 mb-2 px-1",children:"Color de texto"}),(0,r.jsx)("div",{className:"grid grid-cols-4 gap-2",children:[{value:"#14b8a6"},{value:"#f97316"},{value:"#84cc16"},{value:"#eab308"},{value:"#f59e0b"},{value:"#3b82f6"},{value:"#1f2937"},{value:"#475569"}].map((e,t)=>(0,r.jsx)("button",{className:"w-8 h-8 rounded border border-gray-300 hover:scale-110 transition-transform",style:{backgroundColor:e.value},onMouseDown:t=>S(t,e.value),title:"Color ".concat(t+1)},t))})]})]}),(0,r.jsx)("div",{className:"w-px h-6 bg-white/30 mx-1"}),(()=>{let e=window.getSelection();return e&&e.rangeCount>0&&!e.isCollapsed?(0,r.jsxs)(eH,{open:"highlight"===h,onOpenChange:e=>g(e?"highlight":null),children:[(0,r.jsx)(e_,{asChild:!0,children:(0,r.jsx)("button",{className:I,title:"Resaltar Texto",onMouseDown:e=>e.preventDefault(),children:(0,r.jsx)(eq.Z,{className:P})})}),(0,r.jsxs)(eW,{className:"w-auto p-2 bg-white",onMouseDown:e=>e.preventDefault(),children:[(0,r.jsx)("div",{className:"text-xs text-gray-600 mb-2 px-1",children:"Color de fondo"}),(0,r.jsx)("div",{className:"grid grid-cols-4 gap-2",children:[{value:"#fef08a"},{value:"#fde68a"},{value:"#fed7aa"},{value:"#fecaca"},{value:"#fbcfe8"},{value:"#e9d5ff"},{value:"#ddd6fe"},{value:"#c7d2fe"}].map((e,t)=>(0,r.jsx)("button",{className:"w-8 h-8 rounded border border-gray-300 hover:scale-110 transition-transform",style:{backgroundColor:e.value},onMouseDown:t=>{t.preventDefault();let n=window.getSelection();if(n&&n.rangeCount>0&&!n.isCollapsed){let t=n.getRangeAt(0),r=document.createElement("span");r.style.backgroundColor=e.value;try{r.appendChild(t.extractContents()),t.insertNode(r),t.setStartAfter(r),t.collapse(!0),n.removeAllRanges(),n.addRange(t);let e=document.activeElement;e&&e.dispatchEvent(new Event("input",{bubbles:!0}))}catch(e){console.error("Error aplicando resaltado:",e)}}g(null)},title:"Resaltado ".concat(t+1)},t))})]})]}):null})(),(0,r.jsx)("div",{className:"w-px h-6 bg-white/30 mx-1"}),(0,r.jsxs)(eH,{open:"underlineColor"===h,onOpenChange:e=>g(e?"underlineColor":null),children:[(0,r.jsx)(e_,{asChild:!0,children:(0,r.jsx)("button",{className:I,title:"Subrayado",onMouseDown:e=>e.preventDefault(),children:(0,r.jsx)(t0.Z,{className:P})})}),(0,r.jsxs)(eW,{className:"w-auto p-2 bg-white",onMouseDown:e=>e.preventDefault(),children:[(0,r.jsx)("div",{className:"text-xs text-gray-600 mb-2 px-1",children:"Subrayado de"}),(0,r.jsx)("div",{className:"grid grid-cols-4 gap-2",children:[{value:"#14b8a6"},{value:"#f97316"},{value:"#84cc16"},{value:"#eab308"},{value:"#f59e0b"},{value:"#3b82f6"},{value:"#1f2937"},{value:"#475569"}].map((e,t)=>(0,r.jsx)("button",{className:"w-8 h-8 rounded border border-gray-300 hover:scale-110 transition-transform",style:{backgroundColor:e.value},onMouseDown:t=>z(t,e.value),title:"Color ".concat(t+1)},t))})]})]}),(0,r.jsx)("button",{className:I,onMouseDown:e=>k(e,"bold"),title:"Negrita",children:(0,r.jsx)(t1.Z,{className:P})}),(0,r.jsx)("button",{className:I,onMouseDown:e=>k(e,"italic"),title:"Cursiva",children:(0,r.jsx)(t2.Z,{className:P})}),(0,r.jsx)("button",{className:I,onMouseDown:e=>k(e,"strikeThrough"),title:"Tachado",children:(0,r.jsx)(t4.Z,{className:P})}),(0,r.jsx)("div",{className:"w-px h-6 bg-white/30 mx-1"}),(0,r.jsxs)(ex,{children:[(0,r.jsx)(ev,{asChild:!0,children:(0,r.jsxs)("button",{className:I,title:"Alinear Texto",children:[(0,r.jsx)(t5.Z,{className:P}),(0,r.jsx)(T.Z,{className:"h-3 w-3 ml-0.5"})]})}),(0,r.jsxs)(ej,{children:[(0,r.jsxs)(eN,{onMouseDown:e=>k(e,"justifyLeft"),children:[(0,r.jsx)(t5.Z,{className:"h-4 w-4 mr-2"}),"Alinear Izquierda"]}),(0,r.jsxs)(eN,{onMouseDown:e=>k(e,"justifyCenter"),children:[(0,r.jsx)(t3.Z,{className:"h-4 w-4 mr-2"}),"Centrar"]}),(0,r.jsxs)(eN,{onMouseDown:e=>k(e,"justifyRight"),children:[(0,r.jsx)(t8.Z,{className:"h-4 w-4 mr-2"}),"Alinear Derecha"]}),(0,r.jsxs)(eN,{onMouseDown:e=>k(e,"justifyFull"),children:[(0,r.jsx)(t7.Z,{className:"h-4 w-4 mr-2"}),"Justificar"]})]})]}),(0,r.jsx)("div",{className:"w-px h-6 bg-white/30 mx-1"}),(0,r.jsx)("button",{className:I,onClick:e=>{e.preventDefault();let t=document.createElement("span");t.style.color="#a0a1a6",t.textContent="-- ".concat((0,eE.WU)(new Date,"dd/MM/yy")," "),document.execCommand("insertHTML",!1,t.outerHTML)},title:"Insertar Fecha",children:(0,r.jsx)(ta.Z,{className:P})}),(0,r.jsx)("div",{className:"w-px h-6 bg-white/30 mx-1"}),(0,r.jsx)("button",{className:I,onMouseDown:e=>{e.preventDefault(),document.execCommand("removeFormat",!1);let t=window.getSelection();if(t&&t.rangeCount>0){let e=t.getRangeAt(0).commonAncestorContainer;e.nodeType===Node.ELEMENT_NODE&&e.querySelectorAll('span[style*="text-decoration"]').forEach(e=>{let t=e.parentNode;t&&(t.replaceChild(document.createTextNode(e.textContent||""),e),t.normalize())})}},title:"Limpiar Formato",children:(0,r.jsx)(es.Z,{className:P})}),(0,r.jsx)("button",{className:(0,y.cn)(I,m&&"bg-gray-200"),onClick:u,title:"Mover",children:(0,r.jsx)(t6.Z,{className:P})}),(0,r.jsx)("button",{className:I,onClick:E,title:"Lienzo",children:(0,r.jsx)(t9.Z,{className:P})}),(0,r.jsx)("button",{className:R,onClick:o,title:"Cerrar",children:(0,r.jsx)(em.Z,{className:"w-[14px] h-[14px] text-white"})})]});return i?A:(0,r.jsxs)(M.s,{size:{width:"auto",height:"auto"},position:v,onDragStop:(e,t)=>{let n={x:t.x,y:t.y};b(n);try{localStorage.setItem("formattingToolbarPosition",JSON.stringify(n))}catch(e){console.error("Failed to save formatting toolbar position",e)}},dragHandleClassName:"drag-handle",bounds:"window",enableResizing:!1,className:"z-[60000] pointer-events-auto",children:[(0,r.jsx)("div",{className:"drag-handle cursor-grab active:cursor-grabbing py-1 text-slate-800 flex justify-center mb-1",children:(0,r.jsx)(et.Z,{className:"size-4"})}),A]})};function nt(e){let{isOpen:t,onOpenChange:n,onAddImage:o}=e,[s,l]=(0,a.useState)("");return(0,r.jsx)(eR.Vq,{open:t,onOpenChange:n,children:(0,r.jsxs)(eR.cZ,{children:[(0,r.jsxs)(eR.fK,{children:[(0,r.jsx)(eR.$N,{children:"A\xf1adir Imagen desde URL"}),(0,r.jsx)(eR.Be,{children:"Pega la URL completa de la imagen que deseas a\xf1adir al lienzo."})]}),(0,r.jsx)("div",{className:"grid gap-4 py-4",children:(0,r.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,r.jsx)(eA._,{htmlFor:"imageUrl",className:"text-right",children:"URL"}),(0,r.jsx)(eY.I,{id:"imageUrl",name:"imageUrl",value:s,onChange:e=>l(e.target.value),className:"col-span-3",placeholder:"https://..."})]})}),(0,r.jsxs)(eR.cN,{children:[(0,r.jsx)(j.z,{variant:"ghost",onClick:()=>n(!1),children:"Cancelar"}),(0,r.jsx)(j.z,{onClick:()=>{s&&o(s)},disabled:!s,children:"A\xf1adir Imagen"})]})]})})}var nn=n(42325);let nr=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(nn.fC,{className:(0,y.cn)("grid gap-2",n),...a,ref:t})});nr.displayName=nn.fC.displayName;let na=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(nn.ck,{ref:t,className:(0,y.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n),...a,children:(0,r.jsx)(nn.z$,{className:"flex items-center justify-center",children:(0,r.jsx)(ef.Z,{className:"h-2.5 w-2.5 fill-current text-current"})})})});na.displayName=nn.ck.displayName;let no=[{id:"letter",label:'Carta (8.5" x 11")',description:"Formato est\xe1ndar para documentos."},{id:"10x15",label:"Ficha (10cm x 15cm)",description:"Ideal para notas r\xe1pidas y fichas de estudio."}];function ns(e){let{isOpen:t,onOpenChange:n,notepad:o,onSaveFormat:s}=e,[l,i]=(0,a.useState)("letter");return(0,a.useEffect)(()=>{if(o){var e;i((null===(e=o.properties)||void 0===e?void 0:e.format)||"letter")}},[o]),(0,r.jsx)(eR.Vq,{open:t,onOpenChange:n,children:(0,r.jsxs)(eR.cZ,{children:[(0,r.jsx)(eR.fK,{children:(0,r.jsx)(eR.$N,{children:"Cambiar Formato del Cuaderno"})}),(0,r.jsx)("div",{className:"py-4",children:(0,r.jsx)(nr,{value:l,onValueChange:e=>i(e),children:no.map(e=>(0,r.jsxs)(eA._,{htmlFor:e.id,className:"flex items-start space-x-3 p-4 rounded-md border hover:bg-accent cursor-pointer",children:[(0,r.jsx)(na,{value:e.id,id:e.id}),(0,r.jsxs)("div",{className:"grid gap-1.5",children:[(0,r.jsx)("span",{className:"font-semibold",children:e.label}),(0,r.jsx)("span",{className:"text-sm text-muted-foreground",children:e.description})]})]},e.id))})}),(0,r.jsxs)(eR.cN,{children:[(0,r.jsx)(j.z,{variant:"outline",onClick:()=>n(!1),children:"Cancelar"}),(0,r.jsx)(j.z,{onClick:()=>{(null==o?void 0:o.id)&&s(o.id,l)},children:"Guardar Cambios"})]})]})})}let nl=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("textarea",{className:(0,y.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",n),ref:t,...a})});function ni(e){let{isOpen:t,onOpenChange:n,comment:o,onUpdate:s,onDelete:l}=e,[i,c]=(0,a.useState)(""),[d,u]=(0,a.useState)(""),[p,m]=(0,a.useState)(""),{toast:g}=(0,h.pm)(),f=(0,a.useRef)(null),x=(0,a.useRef)(null),v=(0,a.useRef)(null);(0,a.useEffect)(()=>{if(t&&o&&o.content){let e=o.content;c(e.title||""),u(e.label||""),m(e.text||"")}else c(""),u(""),m("")},[t,o]);let{saveStatus:b,handleBlur:w,handleChange:y}=ez({getContent:()=>{var e;return(null===(e=f.current)||void 0===e?void 0:e.value)||i},onSave:async e=>{if(e!==i&&o){let t=o.content;s(o.id,{content:{...t,title:e}})}},debounceMs:2e3,compareContent:(e,t)=>e===t,disabled:!t}),{saveStatus:N,handleBlur:C,handleChange:E}=ez({getContent:()=>{var e;return(null===(e=x.current)||void 0===e?void 0:e.value)||d},onSave:async e=>{if(e!==d&&o){let t=o.content;s(o.id,{content:{...t,label:e}})}},debounceMs:2e3,compareContent:(e,t)=>e===t,disabled:!t}),{saveStatus:k,handleBlur:z,handleChange:T}=ez({getContent:()=>{var e;return(null===(e=v.current)||void 0===e?void 0:e.value)||p},onSave:async e=>{if(e!==p&&o){let t=o.content;s(o.id,{content:{...t,text:e}})}},debounceMs:2e3,compareContent:(e,t)=>e===t,disabled:!t});return(0,r.jsx)(eR.Vq,{open:t,onOpenChange:n,children:(0,r.jsxs)(eR.cZ,{className:"sm:max-w-[425px]",children:[(0,r.jsxs)(eR.fK,{children:[(0,r.jsx)(eR.$N,{children:"Editar Comentario"}),(0,r.jsx)(eR.Be,{children:"Realiza cambios en tu comentario aqu\xed. Haz clic en guardar cuando hayas terminado."})]}),(0,r.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,r.jsx)(eA._,{htmlFor:"title",className:"text-right",children:"T\xedtulo"}),(0,r.jsxs)("div",{className:"col-span-3 relative",children:[(0,r.jsx)(eY.I,{ref:f,id:"title",value:i,onChange:e=>{c(e.target.value),y()},onBlur:w,className:"pr-8",placeholder:"T\xedtulo del comentario (opcional)"}),(0,r.jsx)("div",{className:"absolute top-2 right-2",children:(0,r.jsx)(eI,{status:b,size:"sm"})})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,r.jsx)(eA._,{htmlFor:"label",className:"text-right",children:"Etiqueta"}),(0,r.jsxs)("div",{className:"col-span-3 relative",children:[(0,r.jsx)(eY.I,{ref:x,id:"label",value:d,onChange:e=>{u(e.target.value),E()},onBlur:C,className:"pr-8",placeholder:"Etiqueta corta (opcional)"}),(0,r.jsx)("div",{className:"absolute top-2 right-2",children:(0,r.jsx)(eI,{status:N,size:"sm"})})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-4 items-start gap-4",children:[" ",(0,r.jsx)(eA._,{htmlFor:"commentText",className:"text-right mt-2",children:"Texto"}),(0,r.jsxs)("div",{className:"col-span-3 relative",children:[(0,r.jsx)(nl,{ref:v,id:"commentText",value:p,onChange:e=>{m(e.target.value),T()},onBlur:z,className:"h-24 pr-8",placeholder:"Escribe tu comentario aqu\xed..."}),(0,r.jsx)("div",{className:"absolute top-2 right-2",children:(0,r.jsx)(eI,{status:k,size:"sm"})})]})]})]}),(0,r.jsxs)(eR.cN,{children:[(0,r.jsxs)(A,{children:[(0,r.jsx)(B,{asChild:!0,children:(0,r.jsxs)(j.z,{variant:"destructive",className:"mr-auto",children:[(0,r.jsx)(R.Z,{className:"mr-2 h-4 w-4"})," Eliminar"]})}),(0,r.jsxs)(O,{children:[(0,r.jsxs)(U,{children:[(0,r.jsx)(_,{children:"\xbfEst\xe1s seguro de eliminar este comentario?"}),(0,r.jsx)(W,{children:"Esta acci\xf3n no se puede deshacer. Esto eliminar\xe1 permanentemente tu comentario."})]}),(0,r.jsxs)(H,{children:[(0,r.jsx)(q,{children:"Cancelar"}),(0,r.jsx)(K,{onClick:()=>{o&&(l(o.id),g({variant:"destructive",title:"Comentario Eliminado",description:"El comentario ha sido borrado permanentemente."}),n(!1))},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Eliminar"})]})]})]}),(0,r.jsx)(j.z,{variant:"outline",onClick:()=>n(!1),children:"Cancelar"}),(0,r.jsx)(j.z,{onClick:()=>{o&&(w(),C(),z(),s(o.id,{content:{...o.content,title:i,label:d,text:p}}),g({title:"Comentario Actualizado",description:"El comentario ha sido guardado."}),n(!1))},children:"Guardar cambios"})]})]})})}function nc(e){let{element:t,isVisible:n,onClose:o}=e,[s,l]=(0,a.useState)(!1);if(!n||!t)return null;let i=async()=>{try{await navigator.clipboard.writeText(t.id),l(!0),setTimeout(()=>l(!1),2e3)}catch(e){console.error("Error al copiar ID:",e)}},c="object"==typeof t.properties&&null!==t.properties?t.properties:{},d=c.position||{x:t.x||0,y:t.y||0},u=c.size||{width:t.width||0,height:t.height||0};return(0,r.jsxs)(V,{className:"fixed top-4 right-4 w-80 z-[9999] shadow-xl border-2 border-blue-500 bg-white",children:[(0,r.jsx)(G,{className:"pb-2",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h3",{className:"text-sm font-semibold text-gray-800 flex items-center gap-2",children:"\uD83D\uDCCB Informaci\xf3n del Elemento"}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-5 w-5",onClick:o,children:(0,r.jsx)(em.Z,{className:"h-4 w-4"})})]})}),(0,r.jsxs)(Y,{className:"space-y-3 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium text-gray-600",children:"Tipo:"}),(0,r.jsx)("span",{className:"ml-2 text-gray-800 capitalize",children:t.type})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium text-gray-600",children:"ID:"}),(0,r.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,r.jsx)("code",{className:"text-xs bg-gray-100 px-2 py-1 rounded flex-1 truncate",children:t.id}),(0,r.jsx)(j.z,{variant:"outline",size:"icon",className:"h-7 w-7 flex-shrink-0",onClick:i,title:"Copiar ID",children:s?(0,r.jsx)(eg.Z,{className:"h-3 w-3 text-green-600"}):(0,r.jsx)(eQ.Z,{className:"h-3 w-3"})})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium text-gray-600",children:"Posici\xf3n:"}),(0,r.jsxs)("div",{className:"ml-2 mt-1 text-gray-800",children:[(0,r.jsxs)("div",{children:["X: ",Math.round(d.x),"px"]}),(0,r.jsxs)("div",{children:["Y: ",Math.round(d.y),"px"]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium text-gray-600",children:"Tama\xf1o:"}),(0,r.jsxs)("div",{className:"ml-2 mt-1 text-gray-800",children:[(0,r.jsxs)("div",{children:["Ancho: ",Math.round("number"==typeof u.width?u.width:0),"px"]}),(0,r.jsxs)("div",{children:["Alto: ",Math.round("number"==typeof u.height?u.height:0),"px"]})]})]}),void 0!==t.zIndex&&(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium text-gray-600",children:"Z-Index:"}),(0,r.jsx)("span",{className:"ml-2 text-gray-800",children:t.zIndex})]}),t.parentId&&(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium text-gray-600",children:"Padre:"}),(0,r.jsxs)("code",{className:"ml-2 text-xs bg-gray-100 px-2 py-1 rounded",children:[t.parentId.substring(0,8),"..."]})]}),"container"===t.type&&(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium text-gray-600",children:"Elementos:"}),(0,r.jsx)("span",{className:"ml-2 text-gray-800",children:"object"==typeof t.content&&null!==t.content&&"elementIds"in t.content?t.content.elementIds.length:0})]}),"sticky"===t.type&&t.color&&(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium text-gray-600",children:"Color:"}),(0,r.jsxs)("div",{className:"ml-2 mt-1 flex items-center gap-2",children:[(0,r.jsx)("div",{className:"w-4 h-4 rounded border border-gray-300",style:{backgroundColor:t.color}}),(0,r.jsx)("span",{className:"text-gray-800",children:t.color})]})]})]})]})}function nd(e){let{isOpen:t,onOpenChange:n,currentBoardName:o,onSave:s}=e,[l,i]=(0,a.useState)(o);(0,a.useEffect)(()=>{t&&i(o)},[t,o]);let c=()=>{l.trim()&&s(l),n(!1)};return(0,r.jsx)(eR.Vq,{open:t,onOpenChange:e=>{e?n(!0):c()},children:(0,r.jsxs)(eR.cZ,{onInteractOutside:c,children:[(0,r.jsxs)(eR.fK,{children:[(0,r.jsx)(eR.$N,{children:"Renombrar Tablero"}),(0,r.jsx)(eR.Be,{children:"El tablero se guardar\xe1 autom\xe1ticamente cuando cierres este di\xe1logo o presiones Enter."})]}),(0,r.jsx)("div",{className:"grid gap-4 py-4",children:(0,r.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,r.jsx)(eA._,{htmlFor:"boardName",className:"text-right",children:"Nombre"}),(0,r.jsx)(eY.I,{id:"boardName",name:"boardName",value:l,onChange:e=>i(e.target.value),className:"col-span-3",onKeyDown:e=>{"Enter"===e.key&&c()},onBlur:c,autoFocus:!0})]})})]})})}nl.displayName="Textarea";let nu=["pero","sin embargo","aunque","adem\xe1s","tambi\xe9n","porque","cuando","donde","como","mientras","despu\xe9s","antes","aunque","mientras que","por lo tanto","en cambio"],np=["fin","final","terminado","listo","hecho","completado","eso es todo","eso es","termin\xe9","acab\xe9"],nm=[/\b(qué|cuál|cuándo|dónde|quién|por qué|cómo)\b/gi,/\b(es|son|está|están|tiene|tienen)\s+\w+\s*\?/gi],nh=[/\b(¡|wow|genial|excelente|perfecto|increíble)\b/gi],ng=()=>window.SpeechRecognition||window.webkitSpeechRecognition||null,nf=()=>{let[e,t]=(0,a.useState)(!1),[n,r]=(0,a.useState)(""),[o,s]=(0,a.useState)(""),[l,i]=(0,a.useState)(!1),[c,d]=(0,a.useState)(null),u=(0,a.useRef)(null),p=(0,a.useRef)(""),m=(0,a.useRef)(!1),h=(0,a.useRef)(!1),g=(0,a.useRef)(null);(0,a.useEffect)(()=>{h.current=e,g.current=c},[e,c]),(0,a.useEffect)(()=>{let e=ng();if(!e){i(!1);return}i(!0);let n=new e;return n.continuous=!0,n.interimResults=!0,n.lang="es-MX",n.onstart=()=>{console.log("\uD83C\uDFA4 Dictado iniciado"),m.current=!1,h.current=!0,t(!0),d(null),g.current=null},n.onresult=e=>{let t="",n="";for(let r=e.resultIndex;r<e.results.length;r++){let a=e.results[r][0].transcript;e.results[r].isFinal?n+=a:t+=a}if(n){let e=function(e){if(!e||"string"!=typeof e||0===e.trim().length)return e;try{let t=e.trim();return(t=(t=(t=function(e){if(!e||"string"!=typeof e||0===e.trim().length)return e;let t=e.trim();try{t.length>0&&t[0]===t[0].toLowerCase()&&(t=t[0].toUpperCase()+t.slice(1));let e=nm.some(e=>e.test(t)),n=t.endsWith("?")||t.endsWith("\xbf");if(e&&!n&&t.length>5){let e=t[t.length-1];/[.!?]/.test(e)||(t+="?")}if(nh.some(e=>e.test(t))&&!t.endsWith("!")&&t.length>3){let e=t[t.length-1];/[.!?]/.test(e)||(t+="!")}let r=t[t.length-1];if(!/[.!?]/.test(r)){let e=/\b(es|está|son|están|tiene|tienen|hace|hacen|dice|dicen|va|van|viene|vienen|fue|fueron|será|serán)\b/i.test(t),n=np.some(e=>t.toLowerCase().endsWith(e)||t.toLowerCase().includes(" ".concat(e," ")));(t.length>10||e||n)&&(t+=".")}nu.forEach(e=>{let n=RegExp("\\b".concat(e,"\\b"),"gi");t=t.replace(n,(e,n)=>{if(n>0){let r=t.substring(0,n).trim(),a=r[r.length-1];if(!/[.,;:!?]/.test(a)&&r.length>0)return", ".concat(e)}return e})}),t=(t=(t=(t=(t=t.replace(/([.!?])\s+([a-záéíóúñ])/g,(e,t,n)=>t+" "+n.toUpperCase())).replace(/:\s+([a-záéíóúñ])/g,(e,t)=>": "+t.toUpperCase())).replace(/,([^\s])/g,", $1")).replace(/\s+/g," ")).replace(/([.!?])([a-zA-ZáéíóúñÁÉÍÓÚÑ])/g,"$1 $2")}catch(t){return console.warn("Error en procesamiento de texto, retornando texto original:",t),e.trim()}return t.trim()}(t)).replace(/([.!?])\s*([a-záéíóúñ])/g,(e,t,n)=>t+" "+n.toUpperCase())).replace(/:\s+([a-záéíóúñ])/g,(e,t)=>": "+t.toUpperCase())).length>0&&t[0]===t[0].toLowerCase()&&(t=t[0].toUpperCase()+t.slice(1)),t=t.replace(/\s+/g," ").trim()}catch(t){return console.warn("Error en formatFinalText, retornando texto original:",t),e.trim()}}(n);p.current+=(p.current?" ":"")+e,r(p.current)}t&&s(function(e){if(!e||"string"!=typeof e||0===e.trim().length)return e;try{let t=e.trim();return t.length>0&&t[0]===t[0].toLowerCase()&&(t=t[0].toUpperCase()+t.slice(1)),(t=t.replace(/\s+/g," ")).trim()}catch(t){return e.trim()}}(t))},n.onerror=e=>{if(console.error("Error en reconocimiento de voz:",e.error),"no-speech"!==e.error&&"aborted"!==e.error){if("not-allowed"===e.error){h.current=!1,t(!1),m.current=!1;let e="Permiso de micr\xf3fono denegado. Por favor, permite el acceso al micr\xf3fono en la configuraci\xf3n de tu navegador.";d(e),g.current=e;return}if("network"===e.error){h.current=!1,t(!1),m.current=!1;let e="Error de red. Verifica tu conexi\xf3n a internet.";d(e),g.current=e;return}if("audio-capture"===e.error){h.current=!1,t(!1);let e="No se detect\xf3 ning\xfan micr\xf3fono. Verifica que tu micr\xf3fono est\xe9 conectado y funcionando.";d(e),g.current=e;return}}},n.onend=()=>{if(console.log("\uD83C\uDFA4 Dictado finalizado"),m.current){h.current=!1,t(!1);return}h.current&&!g.current?setTimeout(()=>{if(!m.current&&u.current&&h.current&&!g.current)try{u.current.start()}catch(e){console.error("Error al reiniciar reconocimiento:",e),h.current=!1,t(!1)}},100):(h.current=!1,t(!1))},u.current=n,()=>{if(u.current){try{u.current.stop()}catch(e){}u.current=null}}},[]);let f=(0,a.useCallback)(async()=>{if(!l||!u.current){console.warn("Reconocimiento de voz no disponible");return}if(h.current){console.warn("Ya est\xe1 escuchando");return}try{m.current=!1,p.current="",r(""),s(""),d(null),u.current.start()}catch(r){var e,n,a;if(console.error("Error al iniciar reconocimiento:",r),"NotAllowedError"===r.name||(null===(e=r.message)||void 0===e?void 0:e.includes("not-allowed"))){d("Permiso de micr\xf3fono denegado. Por favor, permite el acceso al micr\xf3fono en la configuraci\xf3n de tu navegador."),h.current=!1,t(!1);return}if((null===(n=r.message)||void 0===n?void 0:n.includes("already started"))||"InvalidStateError"===r.name)try{null===(a=u.current)||void 0===a||a.stop(),setTimeout(()=>{u.current&&!m.current&&u.current.start()},100)}catch(e){console.error("Error al reiniciar:",e),h.current=!1,t(!1)}else h.current=!1,t(!1)}},[l]),x=(0,a.useCallback)(()=>{if(u.current){m.current=!0;try{u.current.stop(),t(!1),console.log("\uD83C\uDFA4 Dictado detenido por el usuario")}catch(e){console.error("Error al detener reconocimiento:",e),t(!1)}}},[]),v=(0,a.useCallback)(async()=>{h.current?x():await f()},[f,x]);return{isSupported:l,isListening:e,transcript:n+(o?" "+o:""),finalTranscript:n,interimTranscript:o,permissionError:c,start:f,stop:x,toggle:v,resetTranscript:(0,a.useCallback)(()=>{p.current="",r(""),s("")},[])}};function nx(e){var t;let{params:n}=e,{boardId:i}=n;(0,o.useRouter)();let{user:d,isUserLoading:u,userError:p}=(0,l.aF)(),f=(0,l.y$)(),{toast:x}=(0,h.pm)(),b=g("(max-width: 768px)");console.log("\uD83C\uDFAF [BoardPage] Componente iniciado",{boardId:i,hasUser:!!d,userId:null==d?void 0:d.uid,isAnonymous:null==d?void 0:d.isAnonymous,authLoading:u,pathname:window.location.pathname});let y=(0,a.useRef)(null),j=(0,a.useRef)(null),N=(0,a.useRef)(null),C=(0,a.useRef)(x);(0,a.useEffect)(()=>{C.current=x},[x]),a.useEffect(()=>{console.log("\uD83D\uDE80 [BoardPage] Componente montado",{boardId:i})},[i]),a.useEffect(()=>{console.log("\uD83D\uDD0D [BoardPage] Estado del usuario:",{hasUser:!!d,userId:null==d?void 0:d.uid,isUserLoading:u,userError:null==p?void 0:p.message,userEmail:null==d?void 0:d.email,isAnonymous:null==d?void 0:d.isAnonymous,sessionStorage:{hasRecentLogin:sessionStorage.getItem("hasRecentLogin"),loginTimestamp:sessionStorage.getItem("loginTimestamp"),redirectingToBoard:sessionStorage.getItem("redirectingToBoard")}})},[d,u,p]);let{elements:E,board:k,loadBoard:z,createBoard:T,updateElement:S,deleteElement:D,selectedElementIds:I,setSelectedElementIds:P,isLoading:R,error:M,cleanup:F}=m();(0,a.useEffect)(()=>{y.current=z,j.current=T,N.current=F},[z,T,F]);let{boards:A,handleRenameBoard:B,handleDeleteBoard:L,clearCanvas:Z}=function(e){let t=(0,l.CU)(),{user:n}=(0,l.aF)(),{toast:r}=(0,h.pm)(),s=(0,o.useRouter)(),i=(0,a.useRef)(s),d=(0,a.useRef)(r);(0,a.useEffect)(()=>{i.current=s,d.current=r},[s,r]);let[u,p]=(0,a.useState)(null),[m,g]=(0,a.useState)([]),[f,x]=(0,a.useState)([]),[v,b]=(0,a.useState)(!0);(0,a.useEffect)(()=>{if(!t||!n)return;let e=(0,c.IO)((0,c.hJ)(t,"users",n.uid,"canvasBoards"),(0,c.Xo)("updatedAt","desc")),r=(0,c.cf)(e,e=>{g(e.docs.map(e=>({...e.data(),id:e.id})))},e=>{console.error("Error fetching boards list:",e)});return()=>r()},[t,n]),(0,a.useEffect)(()=>{if(!t||!n||!e)return;b(!0);let r=(0,c.JU)(t,"users",n.uid,"canvasBoards",e),a=(0,c.cf)(r,e=>{e.exists()?p({...e.data(),id:e.id}):(d.current({variant:"destructive",title:"Error",description:"Este tablero no existe o no tienes permiso para verlo."}),i.current.push("/")),b(!1)},e=>{console.error("Error fetching board:",e),b(!1),d.current({variant:"destructive",title:"Error de Carga",description:"No se pudo cargar el tablero."}),i.current.push("/")});return()=>{a()}},[t,n,e]);let w=(0,a.useCallback)(async a=>{if(!t||!n||!e||!u||!a.trim()){r({variant:"destructive",title:"Error",description:"No se puede renombrar el tablero. Verifica que est\xe9s autenticado."});return}if(a.trim()!==u.name)try{let o=(0,c.JU)(t,"users",n.uid,"canvasBoards",e);await (0,c.r7)(o,{name:a.trim(),updatedAt:(0,c.Bt)()}),r({title:"Tablero renombrado",description:'El tablero ahora se llama "'.concat(a.trim(),'".')})}catch(e){console.error("Error renombrando tablero:",e),r({variant:"destructive",title:"Error",description:e.message||"No se pudo renombrar el tablero. Verifica tus permisos."})}},[t,n,u,e,r]);return{board:u,boards:m,elements:f,isLoading:v,handleRenameBoard:w,handleDeleteBoard:(0,a.useCallback)(async()=>{if(t&&n&&e){r({title:"Eliminando tablero..."});try{let a=(0,c.JU)(t,"users",n.uid,"canvasBoards",e);await (0,c.oe)(a),r({title:"Tablero eliminado",description:"El tablero y todo su contenido han sido eliminados."}),s.push("/")}catch(e){console.error("Error deleting board:",e),r({variant:"destructive",title:"Error",description:"No se pudo eliminar el tablero."})}}},[t,n,e,s,r]),clearCanvas:(0,a.useCallback)(async a=>{if(!t||!n||!e||!a){r({variant:"destructive",title:"Error",description:"No se puede limpiar el tablero. Verifica que est\xe9s autenticado."});return}if(0===a.length){r({title:"Tablero vac\xedo",description:"El tablero ya est\xe1 vac\xedo."});return}try{let o=(0,c.hJ)(t,"users",n.uid,"canvasBoards",e,"canvasElements"),s=(0,c.qs)(t);a.forEach(e=>s.delete((0,c.JU)(o,e.id)));let l=(0,c.JU)(t,"users",n.uid,"canvasBoards",e);s.update(l,{updatedAt:(0,c.Bt)()}),await s.commit(),r({title:"Tablero Limpio",description:"Se eliminaron ".concat(a.length," elemento(s) del tablero.")})}catch(e){console.error("Error limpiando tablero:",e),r({variant:"destructive",title:"Error",description:e.message||"No se pudo limpiar el tablero. Verifica tus permisos."})}},[t,n,e,r])}}(i),O=(0,a.useRef)(null),U=(0,a.useCallback)(()=>{$(!0)},[]),H=(0,a.useCallback)(e=>{B(e),$(!1)},[B]),_=(0,a.useCallback)(()=>{Z(E)},[E,Z]),[W,K]=(0,a.useState)(!0),[q,J]=(0,a.useState)(!1),[V,G]=(0,a.useState)(!1),[Y,X]=(0,a.useState)(!1),[Q,$]=(0,a.useState)(!1),[ee,et]=(0,a.useState)(null),[en,er]=(0,a.useState)(null),[ea,eo]=(0,a.useState)(null),[es,el]=(0,a.useState)(!1),[ei,ec]=(0,a.useState)(!1),[ed,eu]=(0,a.useState)(null),ep=(0,a.useRef)(new Map),[em,eh]=(0,a.useState)(!1),{isSupported:eg,isListening:ef,transcript:ex,finalTranscript:ev,interimTranscript:eb,permissionError:ew,toggle:ey}=nf(),ej=(0,a.useMemo)(()=>{let e=ev||"",t=eb||"";return t.trim()?e+(e?" ":"")+t:e},[ev,eb]),eN=(0,a.useCallback)(async()=>{try{await ey()}catch(e){console.error("Error al alternar dictado:",e)}},[ey]);(0,a.useEffect)(()=>{ew&&x({variant:"destructive",title:"Error de Permisos",description:ew,duration:5e3})},[ew,x]);let eC=(0,a.useCallback)(()=>O.current?O.current.getViewportCenter():{x:window.innerWidth/2,y:window.innerHeight/2},[]),eE=(0,a.useRef)(E);(0,a.useEffect)(()=>{eE.current=E},[E]);let ek=(0,a.useCallback)(()=>{let e=eE.current;if(!e||0===e.length)return 1;let t=e.filter(e=>"number"==typeof e.zIndex).map(e=>e.zIndex);return t.length>0?Math.max(...t)+1:2},[]),{addElement:ez}=function(e,t,n){let r=(0,l.CU)(),{user:o}=(0,l.aF)(),{toast:s}=(0,h.pm)(),i=(0,a.useRef)(t),d=(0,a.useRef)(n);(0,a.useEffect)(()=>{i.current=t,d.current=n},[t,n]);let u=(0,a.useCallback)(async(t,n)=>{var a,s,l,u;let p,m;if(!r||!o||!e)return Promise.reject(Error(r?o?"Board ID no v\xe1lido":"Usuario no autenticado":"Firestore no est\xe1 disponible"));let h=(0,c.hJ)(r,"users",o.uid,"canvasBoards",e,"canvasElements");if("connector"===t)return(await (0,c.ET)(h,{type:"connector",userId:o.uid,properties:{},content:null==n?void 0:n.content,createdAt:(0,c.Bt)(),updatedAt:(0,c.Bt)()})).id;let g=i.current();p="container"===t?0:d.current();let f=n&&n.properties&&n.properties.position?n.properties.position:g,x=n&&n.properties&&n.properties.size?n.properties.size:{width:200,height:150},v="number"==typeof x.width?x.width:200,b="number"==typeof x.height?x.height:150,w=(e,t)=>{let n=f.x,r=f.y,a=n-e/2,o=r-t/2,s=window.innerWidth,l=window.innerHeight;return{x:Math.max(0,a=e<=s?Math.max(20,Math.min(a,n+s/2-e)):Math.max(20,n-s/4)),y:Math.max(0,o=t<=l?Math.max(20,Math.min(o,r+l/2-t)):Math.max(20,r-l/4))}},y={size:x,zIndex:p,rotation:0};switch(n&&n.properties&&"object"==typeof n.properties&&Object.assign(y,n.properties),t){case"notepad":let j={width:794,height:978},N=w(j.width,j.height);m={type:t,x:N.x,y:N.y,width:j.width,height:j.height,userId:o.uid,properties:{...y,position:N,size:j,format:"letter"},content:{title:"Nuevo Cuaderno",pages:[,,,,,].fill("<div><br></div>"),currentPage:0},zIndex:p,createdAt:(0,c.Bt)(),updatedAt:(0,c.Bt)()};break;case"notepad-simple":let C={width:302,height:491},E=w(C.width,C.height);m={type:t,x:E.x,y:E.y,width:C.width,height:C.height,userId:o.uid,properties:{...y,position:E,size:C},content:{title:"Nuevo Notepad",text:"<div><br></div>"},zIndex:p,createdAt:(0,c.Bt)(),updatedAt:(0,c.Bt)()};break;case"super-notebook":let k={width:794,height:1021},z=w(k.width,k.height);m={type:t,x:z.x,y:z.y,width:k.width,height:k.height,userId:o.uid,properties:{...y,position:z,size:k},content:{title:"Super Cuaderno",pages:[,,,,,].fill("<div><br></div>"),currentPage:0},zIndex:p,createdAt:(0,c.Bt)(),updatedAt:(0,c.Bt)()};break;case"sticky":let T=(null==n?void 0:n.color)||"yellow",S={width:224,height:224},D=w(S.width,S.height);m={type:"sticky",x:D.x,y:D.y,width:S.width,height:S.height,userId:o.uid,properties:{...y,position:D,size:S,color:T},content:"string"==typeof(null==n?void 0:n.content)?n.content:"Escribe algo...",zIndex:p,createdAt:(0,c.Bt)(),updatedAt:(0,c.Bt)(),...(null==n?void 0:n.tags)&&{tags:n.tags}};break;case"todo":let I={width:300,height:150},P=w(I.width,I.height);m={type:t,x:P.x,y:P.y,width:I.width,height:I.height,userId:o.uid,properties:{...y,position:P,size:I},content:(null==n?void 0:n.content)||{title:"Lista de Tareas",items:[]},zIndex:p,createdAt:(0,c.Bt)(),updatedAt:(0,c.Bt)()};break;case"image":let R=w(v,b);m={type:t,x:R.x,y:R.y,width:v,height:b,userId:o.uid,properties:{...y,position:R,size:{width:v,height:b}},content:null==n?void 0:n.content,zIndex:p,createdAt:(0,c.Bt)(),updatedAt:(0,c.Bt)()};break;case"text":let M=w(v,b),F=(null==n?void 0:null===(a=n.properties)||void 0===a?void 0:a.backgroundColor)||"#ffffff";m={type:t,x:M.x,y:M.y,width:v,height:b,userId:o.uid,properties:{...y,position:M,size:{width:v,height:b},backgroundColor:F},content:(null==n?void 0:n.content)||'<div style="font-size: 18px;">Escribe algo...</div>',color:(null==n?void 0:n.color)||"white",zIndex:p,createdAt:(0,c.Bt)(),updatedAt:(0,c.Bt)()};break;case"container":let A=(null==n?void 0:null===(s=n.properties)||void 0===s?void 0:s.size)?n.properties.size:{width:378,height:567},B=(null==n?void 0:n.content)&&"object"==typeof n.content&&"title"in n.content?n.content:null,L=(null==B?void 0:B.title)==="Lienzo"||(null==B?void 0:B.title)==="lienzo",Z=L?{width:Math.round(("number"==typeof A.width?A.width:378)*.5),height:"number"==typeof A.height?A.height:567}:A,O=w("number"==typeof Z.width?Z.width:378,"number"==typeof Z.height?Z.height:567),U=L?"#daf4c5":(null==n?void 0:null===(l=n.properties)||void 0===l?void 0:l.backgroundColor)?n.properties.backgroundColor:"white",H=L?-1:p;m={type:"container",x:O.x,y:O.y,width:"number"==typeof Z.width?Z.width:378,height:"number"==typeof Z.height?Z.height:567,userId:o.uid,properties:{...y,position:O,size:Z,backgroundColor:U,zIndex:H},content:B||{title:"Nuevo Contenedor",elementIds:[],layout:"single"},zIndex:H,createdAt:(0,c.Bt)(),updatedAt:(0,c.Bt)()};break;case"comment":let _={width:32,height:32},W=w(_.width,_.height);m={type:t,x:W.x,y:W.y,width:_.width,height:_.height,userId:o.uid,properties:{...y,position:W,size:_},content:(null==n?void 0:n.content)||{title:"",label:"",comment:""},parentId:(null==n?void 0:n.parentId)||void 0,zIndex:p,createdAt:(0,c.Bt)(),updatedAt:(0,c.Bt)()};break;case"moodboard":let K={width:600,height:500},q=w(K.width,K.height);m={type:t,x:q.x,y:q.y,width:K.width,height:K.height,userId:o.uid,properties:{...y,position:q,size:K,backgroundColor:"#ffffff"},content:(null==n?void 0:n.content)||{title:"Nuevo Moodboard",images:[],annotations:[],layout:"grid"},zIndex:p,createdAt:(0,c.Bt)(),updatedAt:(0,c.Bt)()};break;case"tabbed-notepad":let J={width:500,height:400},V=w(J.width,J.height);m={type:t,x:V.x,y:V.y,width:J.width,height:J.height,userId:o.uid,properties:{...y,position:V,size:J,backgroundColor:"#ffffff"},content:(null==n?void 0:n.content)||{title:"Bloc de Notas",tabs:[{id:"tab-1",title:"Pesta\xf1a 1",content:""}],activeTabId:"tab-1"},zIndex:p,createdAt:(0,c.Bt)(),updatedAt:(0,c.Bt)()};break;case"accordion":let G={width:320,height:240},Y=w(G.width,G.height);m={type:t,x:Y.x,y:Y.y,width:G.width,height:G.height,userId:o.uid,properties:{...y,position:Y,size:G,backgroundColor:"#ffffff"},content:(null==n?void 0:n.content)||{items:[{id:"1",title:"Nuevo Item",content:""}]},zIndex:p,createdAt:(0,c.Bt)(),updatedAt:(0,c.Bt)()};break;case"stopwatch":let X={width:200,height:120},Q=w(X.width,X.height);m={type:"stopwatch",x:Q.x,y:Q.y,width:X.width,height:X.height,userId:o.uid,properties:{...y,position:Q,size:X,backgroundColor:"#000000"},content:{time:0,isRunning:!1},zIndex:p,createdAt:(0,c.Bt)(),updatedAt:(0,c.Bt)()};break;case"countdown":let $={width:200,height:180},ee=w($.width,$.height);m={type:"countdown",x:ee.x,y:ee.y,width:$.width,height:$.height,userId:o.uid,properties:{...y,position:ee,size:$,backgroundColor:"#000000"},content:{timeLeft:0,selectedMinutes:5,isRunning:!1},zIndex:p,createdAt:(0,c.Bt)(),updatedAt:(0,c.Bt)()};break;case"highlight-text":let et={width:300,height:150},en=w(et.width,et.height),er=(null==n?void 0:null===(u=n.properties)||void 0===u?void 0:u.backgroundColor)?n.properties.backgroundColor:"#fffb8b";m={type:"highlight-text",x:en.x,y:en.y,width:et.width,height:et.height,userId:o.uid,properties:{...y,position:en,size:et,backgroundColor:er},content:{text:""},zIndex:p,createdAt:(0,c.Bt)(),updatedAt:(0,c.Bt)()};break;case"yellow-notepad":let ea={width:400,height:600},eo=w(ea.width,ea.height);m={type:t,x:eo.x,y:eo.y,width:ea.width,height:ea.height,userId:o.uid,properties:{...y,position:eo,size:ea,backgroundColor:"#FFFFE0"},content:(null==n?void 0:n.content)||{text:"",searchQuery:""},zIndex:p,createdAt:(0,c.Bt)(),updatedAt:(0,c.Bt)()};break;default:return Promise.reject(Error("Tipo de elemento inv\xe1lido: ".concat(t)))}return(await (0,c.ET)(h,m)).id},[r,o,e]);return{addElement:u,updateElement:(0,a.useCallback)((t,n)=>{if(!r||!o||!e)return;let a=(0,c.JU)(r,"users",o.uid,"canvasBoards",e,"canvasElements",t),s={updatedAt:(0,c.Bt)()};Object.keys(n).forEach(e=>{let t=n[e];void 0!==t?s[e]=t:"parentId"===e&&(s[e]=null)}),(0,c.r7)(a,s);let l=(0,c.JU)(r,"users",o.uid,"canvasBoards",e);(0,c.r7)(l,{updatedAt:(0,c.Bt)()}).catch(e=>{console.error("Error actualizando tablero:",e)})},[r,o,e]),deleteElement:(0,a.useCallback)(async(t,n)=>{if(!r||!o||!e)return;let a=n.find(e=>e.id===t);if(!a)return;let s=(0,c.hJ)(r,"users",o.uid,"canvasBoards",e,"canvasElements"),l=(0,c.qs)(r),i=(0,c.JU)(s,t);if("container"===a.type){let e=a.content;e&&Array.isArray(e.elementIds)&&e.elementIds.forEach(e=>{let t=(0,c.JU)(s,e);l.delete(t)})}l.delete(i),await l.commit()},[r,o,e]),unanchorElement:(0,a.useCallback)(async t=>{var n,a,l,i,d,u;if(!r||!o||!e)return;let p=(0,c.hJ)(r,"users",o.uid,"canvasBoards",e,"canvasElements"),m=(0,c.JU)(p,t),h=await (0,c.QT)(m);if(!h.exists()){s({variant:"destructive",title:"Error",description:"El elemento no existe."});return}let g=h.data();if(!(null==g?void 0:g.parentId)){s({variant:"destructive",title:"Error",description:"El elemento no est\xe1 anclado a ning\xfan contenedor."});return}let f=g.parentId,x=(0,c.JU)(p,f),v=await (0,c.QT)(x);if(!v.exists()){s({variant:"destructive",title:"Error",description:"No se encontr\xf3 el contenedor padre."});return}let b=v.data();if(!b){s({variant:"destructive",title:"Error",description:"No se pudo obtener datos del contenedor padre."});return}let w=null==b?void 0:b.content,y=null==b?void 0:b.properties,j=((null==w?void 0:w.elementIds)||[]).filter(e=>e!==t),N=null!==(d=null==y?void 0:null===(n=y.position)||void 0===n?void 0:n.x)&&void 0!==d?d:0,C="number"==typeof(null==y?void 0:null===(a=y.size)||void 0===a?void 0:a.width)?y.size.width:((null==y?void 0:null===(l=y.size)||void 0===l?void 0:l.width)?parseFloat(String(y.size.width)):300)||300,E=null!==(u=null==y?void 0:null===(i=y.position)||void 0===i?void 0:i.y)&&void 0!==u?u:0,k=g.properties,z=(null==k?void 0:k.position)||{x:g.x||0,y:g.y||0},T=z.x>0&&z.y>0?z:{x:N+C+20,y:E+50},S=(0,c.qs)(r);S.update(x,{content:{...w,elementIds:j},updatedAt:(0,c.Bt)()});let D=k||{},I="number"==typeof g.width&&"number"==typeof g.height?{width:g.width,height:g.height}:D.size||{width:200,height:150};S.update(m,{parentId:null,hidden:!1,x:T.x,y:T.y,properties:{...D,position:T,size:I},updatedAt:(0,c.Bt)()});try{await S.commit(),s({title:"Elemento desanclado",description:"El elemento ha sido devuelto al lienzo."})}catch(e){console.error("Error al desanclar elemento:",e),s({variant:"destructive",title:"Error",description:"No se pudo desanclar el elemento."})}},[r,o,e,s])}}(i,eC,ek),eT=1===I.length?I[0]:null,eS=(0,a.useMemo)(()=>eT&&E&&0!==E.length&&E.find(e=>e.id===eT)||null,[eT,E.length,eT?null===(t=E.find(e=>e.id===eT))||void 0===t?void 0:t.updatedAt:null]);(0,a.useEffect)(()=>{var e,t;(null!==(e=null==eS?void 0:eS.id)&&void 0!==e?e:null)!==(null!==(t=null==ee?void 0:ee.id)&&void 0!==t?t:null)&&et(eS)},[null==eS?void 0:eS.id,null==ee?void 0:ee.id]),(0,a.useEffect)(()=>{ee?eh(!0):eh(!1)},[ee]),(0,a.useEffect)(()=>{let e=e=>{(e.ctrlKey||e.metaKey)&&e.shiftKey&&"D"===e.key&&(e.preventDefault(),eh(e=>!e))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]);let eD=(0,a.useRef)(!1),eI=(0,a.useRef)(!1),eP=(0,a.useRef)(null),eR=(0,a.useRef)(null);(0,a.useEffect)(()=>{if(console.log("\uD83D\uDD04 [BoardPage] useEffect ejecutado",{boardId:i,hasUser:!!d,userId:null==d?void 0:d.uid,isAnonymous:null==d?void 0:d.isAnonymous,authLoading:u,isLoading:eI.current,hasLoaded:eD.current,currentBoardId:eR.current}),eR.current!==i&&(console.log("\uD83D\uDD04 [BoardPage] BoardId cambi\xf3, reseteando flags",{old:eR.current,new:i}),eD.current=!1,eI.current=!1,eR.current=i),eI.current||u){console.log("⏸️ [BoardPage] Saltando ejecuci\xf3n (ya cargando o auth cargando)",{isLoading:eI.current,authLoading:u});return}eP.current&&(clearTimeout(eP.current),eP.current=null);let e="true"===sessionStorage.getItem("hasRecentLogin"),t=sessionStorage.getItem("loginTimestamp"),n=sessionStorage.getItem("redirectingToBoard"),r=sessionStorage.getItem("anonymousUserId"),a=e&&t&&Date.now()-parseInt(t)<12e4;if(console.log("\uD83D\uDD0D [BoardPage] Estado de autenticaci\xf3n:",{hasUser:!!d,userId:null==d?void 0:d.uid,hasRecentLogin:e,loginTimestamp:t,redirectingToBoard:n,boardId:i,isLoginRecent:a,anonymousUserId:r,timeSinceLogin:t?Date.now()-parseInt(t):null}),!d&&!a){console.log("⚠️ [BoardPage] No hay usuario ni login reciente, redirigiendo a inicio..."),sessionStorage.clear(),localStorage.clear(),window.location.replace("/");return}if(a&&!d){let a=n===i?6e4:3e4;console.log("⏳ [BoardPage] Esperando usuario despu\xe9s de login reciente...",{waitTime:a,redirectingToBoard:n,boardId:i,hasRecentLogin:e,loginTimestamp:t,anonymousUserId:r,timeSinceLogin:t?Date.now()-parseInt(t):null}),eP.current=setTimeout(()=>{d||(console.log("⚠️ [BoardPage] Timeout: Usuario no disponible despu\xe9s de esperar, redirigiendo..."),sessionStorage.removeItem("hasRecentLogin"),sessionStorage.removeItem("loginTimestamp"),sessionStorage.removeItem("redirectingToBoard"),window.location.replace("/"))},a);return}if((null==d?void 0:d.uid)&&!eD.current&&y.current&&j.current){console.log("✅ [BoardPage] Usuario disponible, cargando/creando tablero",{userId:d.uid,boardId:i,isAnonymous:d.isAnonymous}),eD.current=!0,eI.current=!0;let e=d.uid;"new"===i?j.current(e).then(e=>{eI.current=!1,e?(sessionStorage.setItem("hasRecentLogin","true"),sessionStorage.setItem("loginTimestamp",Date.now().toString()),window.location.href="/board/".concat(e)):eD.current=!1}).catch(e=>{eI.current=!1,eD.current=!1,console.error("❌ Error al crear tablero:",e)}):y.current(i,e).then(e=>{eI.current=!1,e?setTimeout(()=>{sessionStorage.removeItem("hasRecentLogin"),sessionStorage.removeItem("loginTimestamp"),sessionStorage.removeItem("redirectingToBoard")},5e3):eD.current=!1}).catch(e=>{eI.current=!1,eD.current=!1,console.error("❌ Error al cargar tablero:",e)})}return()=>{eP.current&&(clearTimeout(eP.current),eP.current=null),N.current&&N.current()}},[i,d,u]);let eM=(e,t)=>{null===e?P([]):P([e])},eF=(0,a.useCallback)(async()=>{if(!(null==d?void 0:d.uid)){x({title:"Error",description:"Debes iniciar sesi\xf3n"});return}let e=d.uid,t=document.createElement("input");t.type="file",t.accept="image/*",t.onchange=async t=>{var n;let r=null===(n=t.target.files)||void 0===n?void 0:n[0];if(r)try{let t=await v(r,e,f);t.url&&(await ez("image",{content:{url:t.url},properties:{size:{width:300,height:200}}}),x({title:"Imagen subida"}))}catch(e){x({variant:"destructive",title:"Error al subir imagen"})}},t.click()},[d,f,ez,x]),eA=(0,a.useCallback)(()=>K(e=>!e),[]),eB=(0,a.useCallback)(async()=>{let e=eC();try{await ez("comment",{content:{title:"Nuevo Localizador",label:"Localizador",text:""},properties:{position:e,size:{width:48,height:48}}}),x({title:"Localizador creado",description:"Se ha marcado una nueva ubicaci\xf3n en el tablero. Edita el nombre para identificarlo."})}catch(e){x({variant:"destructive",title:"Error",description:e.message||"No se pudo crear el localizador."})}},[eC,ez,x]),eL=(0,a.useCallback)(e=>{let t=E.find(t=>t.id===e);t&&O.current&&(eM(e,!1),O.current.centerOnElement(t))},[E]),eZ=(0,a.useCallback)(async e=>{let t=E.find(t=>t.id===e);t&&(S(e,{hidden:!1}),eM(e,!1),O.current&&O.current.centerOnElement(t))},[E,S]),eO=(0,a.useCallback)(e=>{let t=E.find(t=>t.id===e);t&&(eo(t),G(!0))},[E]),eU=(0,a.useCallback)((e,t)=>{let n="letter"===t?{width:794,height:1021}:{width:378,height:567};S(e,{width:n.width,height:n.height,properties:{...null==ea?void 0:ea.properties,format:t,size:n}}),G(!1)},[ea,S]),eH=(0,a.useCallback)(e=>{eu(e),ec(!0)},[]),e_=(0,a.useCallback)(e=>{var t,n;let r=E.find(t=>t.id===e);if(!r)return;let a=["notepad","notepad-simple","test-notepad","tabbed-notepad","yellow-notepad"].includes(r.type),o="object"==typeof r.properties&&null!==r.properties?r.properties:{},s=null!==(n=null!==(t=o.zIndex)&&void 0!==t?t:r.zIndex)&&void 0!==n?n:1;ep.current.has(e)||ep.current.set(e,s);let l=ek();S(e,{properties:{...o,zIndex:a?Math.max(l-100,1e3):l}}),er(e),O.current&&O.current.centerOnElement(r)},[E,ek,S]);(0,a.useEffect)(()=>{!en&&ep.current.size>0&&(ep.current.forEach((e,t)=>{let n=E.find(e=>e.id===t);if(n){var r,a;let o="object"==typeof n.properties&&null!==n.properties?n.properties:{};(null!==(a=null!==(r=o.zIndex)&&void 0!==r?r:n.zIndex)&&void 0!==a?a:1)!==e&&S(t,{properties:{...o,zIndex:e}})}}),ep.current.clear())},[en,E,S]);let eW=(0,a.useCallback)(async()=>{try{if(!O.current){x({variant:"destructive",title:"Error",description:"No se pudo acceder al lienzo."});return}let e=O.current.getCanvasContainer();if(!e){x({variant:"destructive",title:"Error",description:"No se pudo encontrar el contenedor del lienzo."});return}x({title:"Exportando...",description:"Generando imagen PNG de alta resoluci\xf3n del tablero completo. Esto puede tardar unos segundos..."}),document.body.classList.add("exporting-to-png");let t=e.scrollLeft,n=e.scrollTop,r=e.clientWidth,a=e.clientHeight,o=e.getBoundingClientRect(),s=await w()(e,{backgroundColor:"#96e4e6",scale:3,useCORS:!0,logging:!1,allowTaint:!1,scrollX:-t,scrollY:-n,width:r,height:a,windowWidth:r,windowHeight:a,x:o.left+t,y:o.top+n});document.body.classList.remove("exporting-to-png"),s.toBlob(e=>{if(!e){x({variant:"destructive",title:"Error",description:"No se pudo generar la imagen."});return}let t=URL.createObjectURL(e),n=document.createElement("a");n.href=t;let r=(null==k?void 0:k.name)||"tablero";n.download="".concat(r,"_").concat(Date.now(),".png"),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t),x({title:"Exportado",description:"El tablero se ha exportado como PNG de alta resoluci\xf3n."})},"image/png",1)}catch(e){document.body.classList.remove("exporting-to-png"),console.error("Error al exportar tablero:",e),x({variant:"destructive",title:"Error",description:e.message||"No se pudo exportar el tablero."})}},[O,k,x]);if(console.log("\uD83C\uDFA8 [BoardPage] Render:",{boardId:i,hasUser:!!d,userId:null==d?void 0:d.uid,isAnonymous:null==d?void 0:d.isAnonymous,authLoading:u,isBoardLoading:R,hasBoard:!!k,sessionStorage:{hasRecentLogin:sessionStorage.getItem("hasRecentLogin"),loginTimestamp:sessionStorage.getItem("loginTimestamp"),redirectingToBoard:sessionStorage.getItem("redirectingToBoard")}}),u)return(0,r.jsxs)("div",{className:"flex h-screen w-full flex-col items-center justify-center",style:{backgroundColor:"#96e4e6"},children:[(0,r.jsx)(s.Z,{className:"h-8 w-8 animate-spin text-slate-900"}),(0,r.jsx)("p",{className:"mt-4 text-lg font-semibold text-slate-900",children:"Verificando autenticaci\xf3n..."})]});if(!d){{let e="true"===sessionStorage.getItem("hasRecentLogin"),t=sessionStorage.getItem("loginTimestamp"),n=sessionStorage.getItem("redirectingToBoard");if(e&&t&&Date.now()-parseInt(t)<6e4)return console.log("⏳ [BoardPage] Render: Login reciente detectado, esperando usuario...",{hasRecentLogin:e,loginTimestamp:t,redirectingToBoard:n,boardId:i}),(0,r.jsxs)("div",{className:"flex h-screen w-full flex-col items-center justify-center",style:{backgroundColor:"#96e4e6"},children:[(0,r.jsx)(s.Z,{className:"h-8 w-8 animate-spin text-slate-900"}),(0,r.jsx)("p",{className:"mt-4 text-lg font-semibold text-slate-900",children:"Cargando tu tablero..."})]})}return console.log("⚠️ [BoardPage] Render: No hay usuario y no hay login reciente, redirigiendo..."),sessionStorage.clear(),localStorage.clear(),window.location.replace("/"),(0,r.jsxs)("div",{className:"flex h-screen w-full flex-col items-center justify-center",style:{backgroundColor:"#cae3e1"},children:[(0,r.jsx)(s.Z,{className:"h-8 w-8 animate-spin text-slate-900"}),(0,r.jsx)("p",{className:"mt-4 text-lg font-semibold text-slate-900",children:"Redirigiendo..."})]})}return R||"new"===i?(0,r.jsxs)("div",{className:"flex h-screen w-full flex-col items-center justify-center",style:{backgroundColor:"#75e8ce"},children:[(0,r.jsx)(s.Z,{className:"h-8 w-8 animate-spin text-slate-900"}),(0,r.jsx)("p",{className:"mt-4 text-lg font-semibold text-slate-900",children:"Cargando tu lienzo..."})]}):M?(0,r.jsxs)("div",{className:"p-10 text-red-500",children:["Error: ",M]}):!k&&d?(0,r.jsxs)("div",{className:"flex h-screen w-full flex-col items-center justify-center",style:{backgroundColor:"#cae3e1"},children:[(0,r.jsx)(s.Z,{className:"h-8 w-8 animate-spin text-slate-900"}),(0,r.jsx)("p",{className:"mt-4 text-lg font-semibold text-slate-900",children:"Cargando tu tablero..."})]}):k?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(nd,{isOpen:Q,onOpenChange:$,currentBoardName:(null==k?void 0:k.name)||"Sin nombre",onSave:H}),(0,r.jsxs)("div",{className:"h-screen w-screen relative bg-[#3b3b3b] overflow-hidden",children:[(0,r.jsx)(tD,{ref:O,elements:E,board:k,selectedElementIds:I,onSelectElement:eM,updateElement:S,deleteElement:D,unanchorElement:e=>{let t=E.find(t=>t.id===e);t&&t.parentId&&S(e,{parentId:void 0})},addElement:ez,onLocateElement:eL,onFormatToggle:eA,onChangeNotepadFormat:eO,onEditElement:e_,selectedElement:ee,activatedElementId:en,isMobile:b,setIsDirty:el,isListening:ef,liveTranscript:ej,finalTranscript:ev,interimTranscript:eb,onBringToFront:()=>{},onSendToBack:()=>{},onMoveBackward:()=>{},onGoToHome:()=>{var e;return null===(e=O.current)||void 0===e?void 0:e.goToHome()},onCenterView:()=>{},onGroupElements:()=>{},saveLastView:()=>{},onActivateDrag:()=>{},onEditComment:eH,onDuplicateElement:()=>{},onUngroup:()=>{}}),(0,r.jsx)(tQ,{elements:E||[],boards:A||[],onUploadImage:eF,onAddImageFromUrl:()=>J(!0),onPanToggle:()=>{var e;return null===(e=O.current)||void 0===e?void 0:e.activatePanMode()},onRenameBoard:U,onDeleteBoard:L,isListening:ef,onToggleDictation:eN,onOpenNotepad:eZ,onLocateElement:eL,addElement:ez,clearCanvas:_,onExportBoardToPng:eW,onFormatToggle:eA,isFormatToolbarOpen:W}),(0,r.jsx)(ne,{isOpen:W,onClose:()=>K(!1),elements:ee?[ee]:[],onAddComment:eB,onEditComment:eH,isMobileSheet:b,onLocateElement:eL,onPanToggle:()=>{var e;X(e=>!e),null===(e=O.current)||void 0===e||e.activatePanMode()},addElement:ez,isPanningActive:Y}),(0,r.jsx)(ns,{isOpen:V,onOpenChange:G,notepad:ea,onSaveFormat:eU}),(0,r.jsx)(nt,{isOpen:q,onOpenChange:J,onAddImage:async e=>{await ez("image",{content:{url:e},properties:{size:{width:300,height:200}}}),J(!1)}}),ed&&(0,r.jsx)(ni,{isOpen:ei,onOpenChange:ec,comment:ed,onUpdate:S,onDelete:D}),(0,r.jsx)(nc,{element:ee,isVisible:em&&!!ee,onClose:()=>eh(!1)})]})]}):null}},12381:function(e,t,n){"use strict";n.d(t,{d:function(){return i},z:function(){return c}});var r=n(57437),a=n(2265),o=n(37053),s=n(90535),l=n(93448);let i=(0,s.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=a.forwardRef((e,t)=>{let{className:n,variant:a,size:s,asChild:c=!1,...d}=e,u=c?o.g7:"button";return(0,r.jsx)(u,{className:(0,l.cn)(i({variant:a,size:s,className:n})),ref:t,...d})});c.displayName="Button"},74291:function(e,t,n){"use strict";n.d(t,{$N:function(){return h},Be:function(){return g},Vq:function(){return i},cN:function(){return m},cZ:function(){return u},fK:function(){return p}});var r=n(57437),a=n(2265),o=n(70001),s=n(44986),l=n(93448);let i=o.fC;o.xz;let c=o.h_;o.x8;let d=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(o.aV,{ref:t,className:(0,l.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",n),...a})});d.displayName=o.aV.displayName;let u=a.forwardRef((e,t)=>{let{className:n,children:a,...i}=e;return(0,r.jsxs)(c,{children:[(0,r.jsx)(d,{}),(0,r.jsxs)(o.VY,{ref:t,className:(0,l.cn)("fixed left-[50%] top-[50%] z-[50000] grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",n),...i,children:[a,(0,r.jsxs)(o.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,r.jsx)(s.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});u.displayName=o.VY.displayName;let p=e=>{let{className:t,...n}=e;return(0,r.jsx)("div",{className:(0,l.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...n})};p.displayName="DialogHeader";let m=e=>{let{className:t,...n}=e;return(0,r.jsx)("div",{className:(0,l.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...n})};m.displayName="DialogFooter";let h=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(o.Dx,{ref:t,className:(0,l.cn)("text-lg font-semibold leading-none tracking-tight",n),...a})});h.displayName=o.Dx.displayName;let g=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(o.dk,{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",n),...a})});g.displayName=o.dk.displayName},40279:function(e,t,n){"use strict";n.d(t,{I:function(){return s}});var r=n(57437),a=n(2265),o=n(93448);let s=a.forwardRef((e,t)=>{let{className:n,type:a,...s}=e;return(0,r.jsx)("input",{type:a,className:(0,o.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n),ref:t,...s})});s.displayName="Input"},75060:function(e,t,n){"use strict";n.d(t,{_:function(){return c}});var r=n(57437),a=n(2265),o=n(370),s=n(90535),l=n(93448);let i=(0,s.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(o.f,{ref:t,className:(0,l.cn)(i(),n),...a})});c.displayName=o.f.displayName},33931:function(e,t,n){"use strict";n.d(t,{I2:function(){return o},Ry:function(){return s},ol:function(){return l},qj:function(){return a},w7:function(){return i}});var r=n(44752);async function a(e){let t=new r.hJ;t.setCustomParameters({prompt:"select_account",client_id:"917199598510-14h0c930cobfvnig8kdfj5i42untd7rg.apps.googleusercontent.com"});try{console.log("\uD83D\uDD04 Iniciando sesi\xf3n con Google (popup)..."),console.log("\uD83D\uDD04 Llamando a signInWithPopup...");let n=await (0,r.rh)(e,t);return console.log("✅ signInWithPopup exitoso:",n.user.email),n}catch(e){if(console.error("❌ Error during Google sign-in popup:",e),console.error("❌ Error code:",e.code),console.error("❌ Error message:",e.message),e.code&&e.code.startsWith("auth/"))throw e;if("auth/popup-blocked"===e.code)throw Error("El popup fue bloqueado. Por favor, permite popups para este sitio e intenta de nuevo.");if("auth/popup-closed-by-user"===e.code)throw Error("El popup fue cerrado antes de completar el login. Por favor, intenta de nuevo.");throw Error(e.message||"No se pudo completar el inicio de sesi\xf3n con Google. Por favor, intenta de nuevo.")}}let o=async e=>{try{return await (0,r.XB)(e)}catch(e){throw console.error("Error signing in as guest:",e),e}},s=async(e,t,n)=>{try{return await (0,r.e5)(e,t,n)}catch(e){throw console.error("Error signing in with email:",e),e}},l=async(e,t,n)=>{try{return await (0,r.Xb)(e,t,n)}catch(e){throw console.error("Error creating user with email:",e),e}},i=async e=>{try{await (0,r.w7)(e)}catch(e){throw console.error("Error signing out:",e),e}}},89799:function(e,t,n){"use strict";n.d(t,{q:function(){return r}});let r={apiKey:"AIzaSyDnDsbb2jVLZmgpfkrpdzA6yTFRpPo2f9c",authDomain:"canvasmind-app.firebaseapp.com",projectId:"canvasmind-app",storageBucket:"canvasmind-app.firebasestorage.app",messagingSenderId:"917199598510",appId:"1:917199598510:web:73840729e1333a07804e3f"}},71077:function(e,t,n){"use strict";n.d(t,{s:function(){return r}});let r=function(){let e={};return{on(t,n){var r;e[t]||(e[t]=[]),null===(r=e[t])||void 0===r||r.push(n)},off(t,n){var r;e[t]&&(e[t]=null===(r=e[t])||void 0===r?void 0:r.filter(e=>e!==n))},emit(t,n){var r;e[t]&&(null===(r=e[t])||void 0===r||r.forEach(e=>e(n)))}}}()},63996:function(e,t,n){"use strict";n.d(t,{CU:function(){return i},aC:function(){return l},aF:function(){return d},fE:function(){return o},y$:function(){return c}}),n(57437);var r=n(2265);let a={firebaseApp:null,firestore:null,auth:null,storage:null,user:null,isUserLoading:!0,userError:null},o=(0,r.createContext)(a),s=()=>{let e=(0,r.useContext)(o);return void 0===e?(console.error("useFirebaseContext must be used within a FirebaseProvider."),a):e},l=()=>{var e,t;return null!==(t=null===(e=s())||void 0===e?void 0:e.auth)&&void 0!==t?t:null},i=()=>{var e,t;return null!==(t=null===(e=s())||void 0===e?void 0:e.firestore)&&void 0!==t?t:null},c=()=>{var e,t;return null!==(t=null===(e=s())||void 0===e?void 0:e.storage)&&void 0!==t?t:null},d=()=>{let{user:e,isUserLoading:t,userError:n}=s();return{user:e,isUserLoading:t,userError:n}}},23340:function(e,t,n){"use strict";n.d(t,{pm:function(){return p}});var r=n(2265);let a=0,o=new Map,s=e=>{if(o.has(e))return;let t=setTimeout(()=>{o.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);o.set(e,t)},l=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:n}=t;return n?s(n):e.toasts.forEach(e=>{s(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===n||void 0===n?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},i=[],c={toasts:[]};function d(e){c=l(c,e),i.forEach(e=>{e(c)})}function u(e){let{...t}=e,n=(a=(a+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>d({type:"DISMISS_TOAST",toastId:n});return d({type:"ADD_TOAST",toast:{...t,id:n,open:!0,onOpenChange:e=>{e||r()}}}),{id:n,dismiss:r,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:n}})}}function p(){let[e,t]=r.useState(c);return r.useEffect(()=>(i.push(t),()=>{let e=i.indexOf(t);e>-1&&i.splice(e,1)}),[]),{...e,toast:u,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},5690:function(e,t,n){"use strict";function r(e){let t=window.getSelection();if(!t||0===t.rangeCount)return null;let n=t.getRangeAt(0),r=n.cloneRange();r.selectNodeContents(e),r.setEnd(n.endContainer,n.endOffset);let a=r.toString().length,o=a+n.toString().length;return{start:a,end:o,node:n.endContainer}}function a(e,t){if(!t)return!1;let n=window.getSelection();if(!n)return!1;try{var r,a,o,s;let l=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null),i=0,c=null,d=0;for(;l.nextNode();){let e=l.currentNode,n=(null===(a=e.textContent)||void 0===a?void 0:a.length)||0;if(i+n>=t.start){c=e,d=t.start-i;break}i+=n}if(!c){let t=function(e){let t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null),n=null;for(;t.nextNode();)n=t.currentNode;return n}(e);if(t)c=t,d=(null===(o=t.textContent)||void 0===o?void 0:o.length)||0;else{let t=document.createRange();return t.selectNodeContents(e),t.collapse(!1),n.removeAllRanges(),n.addRange(t),!0}}let u=document.createRange();if(u.setStart(c,Math.min(d,(null===(r=c.textContent)||void 0===r?void 0:r.length)||0)),t.end!==t.start){let n=0,r=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null);for(;r.nextNode();){let e=r.currentNode,a=(null===(s=e.textContent)||void 0===s?void 0:s.length)||0;if(n+a>=t.end){u.setEnd(e,t.end-n);break}n+=a}}else u.collapse(!0);return n.removeAllRanges(),n.addRange(u),!0}catch(r){console.error("Error restaurando cursor:",r);let t=document.createRange();return t.selectNodeContents(e),t.collapse(!1),n.removeAllRanges(),n.addRange(t),!1}}function o(e,t){if(e.innerHTML===t)return;let n=r(e);e.innerHTML=t,n&&setTimeout(()=>{a(e,n)},0)}n.r(t),n.d(t,{restoreCursorPosition:function(){return a},saveCursorPosition:function(){return r},updateInnerHTMLPreservingCursor:function(){return o}})},36692:function(e,t,n){"use strict";function r(e,t,n,r,a){if(!e||!e.isContentEditable||!t)return;let o=a||{lastInsertedText:"",lastFinalText:""},s=window.getSelection();if(!s||0===s.rangeCount)return;let l=s.getRangeAt(0);t.length<o.lastInsertedText.length&&(o.lastInsertedText="",o.lastFinalText="");let i=(e.textContent||"").trim(),c=t.trim();if(i.includes(c)&&c.length>0&&i.slice(-c.length)===c){o.lastInsertedText=t,n&&(o.lastFinalText=n);return}let d="";if(o.lastInsertedText?t.startsWith(o.lastInsertedText)?d=t.slice(o.lastInsertedText.length):(o.lastInsertedText="",d=t):d=t,d){t.length>n.length&&t.slice(n.length);let e=r||(t.length>n.length?t.slice(n.length):"");if(n&&t===n||!e){let e=document.createTextNode(d);l.insertNode(e),l.setStartAfter(e),l.collapse(!0),s.removeAllRanges(),s.addRange(l),o.lastInsertedText=t,n&&(o.lastFinalText=n)}else{let e=document.createElement("span");e.className="dictation-interim",e.style.color="#888888",e.textContent=d,l.insertNode(e),l.setStartAfter(e),l.collapse(!0),s.removeAllRanges(),s.addRange(l),o.lastInsertedText=t}}let u=new Event("input",{bubbles:!0});e.dispatchEvent(u)}function a(e,t,n,r){if(!e||!t)return;let a=r||{lastInsertedText:"",lastFinalText:""},o=e.value,s=e.selectionStart||o.length,l=e.selectionEnd||s;t.length<a.lastInsertedText.length&&(a.lastInsertedText="",a.lastFinalText="");let i="";if(a.lastInsertedText?t.startsWith(a.lastInsertedText)?i=t.slice(a.lastInsertedText.length):(a.lastInsertedText="",i=t):i=t,i){let r=o.slice(0,s),c=o.slice(l);if(!r.endsWith(t)){e.value=r+i+c;let o=r.length+i.length;e.setSelectionRange(o,o),a.lastInsertedText=t,n&&(a.lastFinalText=n)}}let c=new Event("input",{bubbles:!0});e.dispatchEvent(c)}function o(e){e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement||e.querySelectorAll(".dictation-interim").forEach(e=>{var t;let n=e.textContent||"",r=document.createTextNode(n);r.textContent=n,null===(t=e.parentNode)||void 0===t||t.replaceChild(r,e)})}n.r(t),n.d(t,{finalizeInterimText:function(){return o},insertDictationTextToContentEditable:function(){return r},insertDictationTextToInput:function(){return a}})},93448:function(e,t,n){"use strict";n.d(t,{cn:function(){return o}});var r=n(61994),a=n(53335);function o(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,a.m6)((0,r.W)(t))}},55392:function(){}},function(e){e.O(0,[35,358,637,125,505,337,338,279,343,311,656,634,971,117,744],function(){return e(e.s=58781)}),_N_E=e.O()}]);